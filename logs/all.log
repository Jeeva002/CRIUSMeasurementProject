2025-07-11 19:55:33 - root - INFO - Program started from command line
2025-07-11 19:55:33 - root - INFO - === Starting DICOM Ultrasound Processing Session ===
2025-07-11 19:55:33 - root - INFO - Processing DICOM directory: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037
2025-07-11 19:55:33 - root - INFO - Reading DICOM files from directory
2025-07-11 19:55:33 - root - INFO - Starting to read DICOM directory: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037
2025-07-11 19:55:33 - root - DEBUG - Listing files in directory
2025-07-11 19:55:33 - root - INFO - Found 11 files in directory to process
2025-07-11 19:55:33 - root - DEBUG - Processing file 1/11: I0000010_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Checking if file is valid DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000010_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-11 19:55:33 - root - DEBUG - File successfully validated as DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000010_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Added valid DICOM file to list: I0000010_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Processing file 2/11: I0000020_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Checking if file is valid DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000020_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-11 19:55:33 - root - DEBUG - File successfully validated as DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000020_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Added valid DICOM file to list: I0000020_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Processing file 3/11: I0000030_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Checking if file is valid DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000030_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-11 19:55:33 - root - DEBUG - File successfully validated as DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000030_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Added valid DICOM file to list: I0000030_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Processing file 4/11: I0000040_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Checking if file is valid DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000040_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-11 19:55:33 - root - DEBUG - File successfully validated as DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000040_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Added valid DICOM file to list: I0000040_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Processing file 5/11: I0000060_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Checking if file is valid DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000060_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-11 19:55:33 - root - DEBUG - File successfully validated as DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000060_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Added valid DICOM file to list: I0000060_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Processing file 6/11: I0000070_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Checking if file is valid DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000070_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-11 19:55:33 - root - DEBUG - File successfully validated as DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000070_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Added valid DICOM file to list: I0000070_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Processing file 7/11: I0000080_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Checking if file is valid DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000080_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-11 19:55:33 - root - DEBUG - File successfully validated as DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000080_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Added valid DICOM file to list: I0000080_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Processing file 8/11: I0000090_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Checking if file is valid DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000090_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-11 19:55:33 - root - DEBUG - File successfully validated as DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000090_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Added valid DICOM file to list: I0000090_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Processing file 9/11: I0000100_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Checking if file is valid DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000100_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-11 19:55:33 - root - DEBUG - File successfully validated as DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000100_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Added valid DICOM file to list: I0000100_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Processing file 10/11: I0000110_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Checking if file is valid DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000110_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-11 19:55:33 - root - DEBUG - File successfully validated as DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000110_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Added valid DICOM file to list: I0000110_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Processing file 11/11: I0000120_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Checking if file is valid DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000120_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-11 19:55:33 - root - DEBUG - File successfully validated as DICOM: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000120_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Added valid DICOM file to list: I0000120_20250417_103454
2025-07-11 19:55:33 - root - INFO - DICOM file validation completed. Found 11 valid DICOM files
2025-07-11 19:55:33 - root - INFO - Extracting scan type from first DICOM file
2025-07-11 19:55:33 - root - DEBUG - Extracting scan type from DICOM file: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000010_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Reading DICOM metadata for scan type extraction
2025-07-11 19:55:33 - root - WARNING - Scan type not available in DICOM file: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000010_20250417_103454 - Error: 'scanType'
2025-07-11 19:55:33 - root - WARNING - Could not extract scan type from DICOM files
2025-07-11 19:55:33 - root - INFO - Directory processing completed successfully
2025-07-11 19:55:33 - root - DEBUG - Final results - DICOM files: 11, Scan type: None
2025-07-11 19:55:33 - root - INFO - Found 11 DICOM files to process
2025-07-11 19:55:33 - root - DEBUG - metaData: None
2025-07-11 19:55:33 - root - INFO - Processing DICOM file 1/11: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000010_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Converting DICOM to PNG format
2025-07-11 19:55:33 - root - INFO - Starting DICOM to PNG conversion: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000010_20250417_103454
2025-07-11 19:55:33 - root - DEBUG - Reading DICOM file with pydicom
2025-07-11 19:55:33 - root - INFO - DICOM file loaded successfully
2025-07-11 19:55:33 - root - DEBUG - Original photometric interpretation: RGB
2025-07-11 19:55:33 - root - INFO - Processing RGB format DICOM
2025-07-11 19:55:33 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-11 19:55:33 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-11 19:55:33 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-11 19:55:33 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-11 19:55:33 - root - DEBUG - Cropping ultrasound image area
2025-07-11 19:55:33 - root - DEBUG - Initializing USRegionLocation detector
2025-07-11 19:55:33 - root - INFO - Getting ultrasound region coordinates
2025-07-11 19:55:33 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-11 19:55:33 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:55:33 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-11 19:55:33 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-11 19:55:33 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-11 19:55:33 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-11 19:55:33 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:55:33 - root - INFO - Analyzing cropped image for measurement tables
2025-07-11 19:55:33 - root - INFO - Starting table detection in ultrasound image
2025-07-11 19:55:33 - root - INFO - Initializing UltrasoundTableDetector
2025-07-11 19:55:33 - root - INFO - Initializing OCRHandler
2025-07-11 19:55:33 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-11 19:55:33 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-11 19:55:33 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-11 19:55:33 - root - DEBUG - - lang: 'en' (English language)
2025-07-11 19:55:33 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-11 19:55:33 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-11 19:55:33 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-11 19:55:34 - root - INFO - OCRHandler initialized successfully
2025-07-11 19:55:34 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-11 19:55:34 - root - INFO - Initializing TableDetector
2025-07-11 19:55:34 - root - DEBUG - TableDetector instance created successfully
2025-07-11 19:55:34 - root - DEBUG - Default detection parameters:
2025-07-11 19:55:34 - root - DEBUG - - Image upscale factor: 3x
2025-07-11 19:55:34 - root - DEBUG - - Edge threshold: 50
2025-07-11 19:55:34 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-11 19:55:34 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-11 19:55:34 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-11 19:55:34 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-11 19:55:34 - root - INFO - TableDetector initialization completed
2025-07-11 19:55:34 - root - INFO - Initializing TextAnalyzer
2025-07-11 19:55:34 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-11 19:55:34 - root - DEBUG - Text analysis configuration:
2025-07-11 19:55:34 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-11 19:55:34 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-11 19:55:34 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-11 19:55:34 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-11 19:55:34 - root - INFO - TextAnalyzer initialization completed
2025-07-11 19:55:34 - root - INFO - Initializing ContentExtractor
2025-07-11 19:55:34 - root - INFO - ContentExtractor initialized successfully
2025-07-11 19:55:34 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-11 19:55:34 - root - INFO - Detecting measurement tables in the image
2025-07-11 19:55:34 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-11 19:55:34 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-11 19:55:34 - root - DEBUG - Converting upscaled image to grayscale
2025-07-11 19:55:34 - root - DEBUG - Grayscale conversion completed
2025-07-11 19:55:34 - root - INFO - Applying edge detection to grayscale image
2025-07-11 19:55:34 - root - DEBUG - Edge detection completed
2025-07-11 19:55:34 - root - DEBUG - Applying threshold to create binary image
2025-07-11 19:55:34 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 466792
2025-07-11 19:55:34 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-11 19:55:34 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-11 19:55:34 - root - INFO - Enhancing horizontal and vertical lines
2025-07-11 19:55:34 - root - DEBUG - Line enhancement completed
2025-07-11 19:55:34 - root - DEBUG - Applying dilation to make lines thicker
2025-07-11 19:55:34 - root - DEBUG - Line thickening completed
2025-07-11 19:55:34 - root - DEBUG - Combining horizontal and vertical lines
2025-07-11 19:55:34 - root - DEBUG - Line combination completed
2025-07-11 19:55:34 - root - DEBUG - Created copy for contour visualization
2025-07-11 19:55:34 - root - INFO - Finding contours in enhanced lines
2025-07-11 19:55:34 - root - INFO - Found 830 contours
2025-07-11 19:55:34 - root - DEBUG - Drawing contours for visualization
2025-07-11 19:55:34 - root - DEBUG - Contours drawn successfully
2025-07-11 19:55:34 - root - INFO - Processing contours to find rectangular regions
2025-07-11 19:55:34 - root - INFO - Rectangular region detection completed
2025-07-11 19:55:34 - root - INFO - Total candidate regions found: 179
2025-07-11 19:55:34 - root - DEBUG - Found 179 candidate regions
2025-07-11 19:55:34 - root - INFO - Processing candidate regions for measurement content
2025-07-11 19:55:35 - root - DEBUG - Line 1: 'E2' (conf: 0.914)
2025-07-11 19:55:35 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:55:35 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:55:35 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:55:35 - root - DEBUG - Combined text: 'e2'
2025-07-11 19:55:35 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:55:35 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:55:35 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:55:35 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:55:35 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:55:35 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:55:35 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:55:35 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:55:35 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:55:35 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:55:35 - root - INFO - Final measurement score: 0
2025-07-11 19:55:36 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-11 19:55:36 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-11 19:55:36 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-11 19:55:36 - root - DEBUG - Rank 1: Index 0, Score 0.000000
2025-07-11 19:55:36 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-11 19:55:36 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-11 19:55:36 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-11 19:55:36 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-11 19:55:36 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-11 19:55:36 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-11 19:55:36 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-11 19:55:36 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-11 19:55:36 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-11 19:55:36 - root - WARNING - No candidates meet the minimum threshold of 4. Best score: 0.000000
2025-07-11 19:55:36 - root - INFO - Measurement table detection completed - no valid tables found
2025-07-11 19:55:36 - root - DEBUG - Table detection completed. Candidates found: 179
2025-07-11 19:55:36 - root - INFO - Identifying organ name from the image
2025-07-11 19:55:36 - root - INFO - Starting organ name identification
2025-07-11 19:55:36 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:55:36 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-11 19:55:36 - root - INFO - Starting organ label identification
2025-07-11 19:55:36 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-11 19:55:36 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-11 19:55:37 - root - DEBUG - Line 1: '64% 22Hz' (conf: 0.917)
2025-07-11 19:55:37 - root - DEBUG - Line 2: 'Valuson' (conf: 0.927)
2025-07-11 19:55:37 - root - DEBUG - Line 3: 'Voluson' (conf: 0.994)
2025-07-11 19:55:37 - root - DEBUG - Line 4: 'Abdomen' (conf: 0.996)
2025-07-11 19:55:37 - root - DEBUG - Line 5: '58' (conf: 0.910)
2025-07-11 19:55:37 - root - DEBUG - Line 6: '58' (conf: 0.985)
2025-07-11 19:55:37 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.993)
2025-07-11 19:55:37 - root - DEBUG - Line 8: 'A0 100%' (conf: 0.984)
2025-07-11 19:55:37 - root - DEBUG - Line 9: 'Gn -20' (conf: 0.994)
2025-07-11 19:55:37 - root - DEBUG - Line 10: 'C6M4' (conf: 0.996)
2025-07-11 19:55:37 - root - DEBUG - Line 11: 'FF1 / E2' (conf: 0.998)
2025-07-11 19:55:37 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.962)
2025-07-11 19:55:37 - root - DEBUG - Line 13: 'UTERUS' (conf: 1.000)
2025-07-11 19:55:37 - root - DEBUG - OCR completed. Processing 13 text lines for organ keywords
2025-07-11 19:55:37 - root - DEBUG - Line 0 text: '64% 22Hz'
2025-07-11 19:55:37 - root - DEBUG - Line 1 text: 'Valuson'
2025-07-11 19:55:37 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-11 19:55:37 - root - DEBUG - Line 3 text: 'Abdomen'
2025-07-11 19:55:37 - root - DEBUG - Line 4 text: '58'
2025-07-11 19:55:37 - root - DEBUG - Line 5 text: '58'
2025-07-11 19:55:37 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-11 19:55:37 - root - DEBUG - Line 7 text: 'A0 100%'
2025-07-11 19:55:37 - root - DEBUG - Line 8 text: 'Gn -20'
2025-07-11 19:55:37 - root - DEBUG - Line 9 text: 'C6M4'
2025-07-11 19:55:37 - root - DEBUG - Line 10 text: 'FF1 / E2'
2025-07-11 19:55:37 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-11 19:55:37 - root - DEBUG - Line 12 text: 'UTERUS'
2025-07-11 19:55:37 - root - DEBUG - Combined text for keyword search: '64% 22hz valuson voluson abdomen 58 58 hm pi 7.70 - 2.10 a0 100% gn -20 c6m4 ff1 / e2 sri ii 2 / cri 2 uterus'
2025-07-11 19:55:37 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-11 19:55:37 - root - DEBUG - Found organ keyword: 'uterus'
2025-07-11 19:55:37 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-11 19:55:37 - root - INFO - Identified organs: ['uterus']
2025-07-11 19:55:37 - root - INFO - Organ identification completed successfully: ['uterus']
2025-07-11 19:55:37 - root - DEBUG - Organ identified: ['uterus']
2025-07-11 19:55:37 - root - WARNING - No measurement tables detected in the ultrasound image
2025-07-11 19:55:37 - root - WARNING - No structured data extracted from file: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000010_20250417_103454
2025-07-11 19:55:37 - root - DEBUG - Displaying cropped image
2025-07-11 19:55:37 - root - INFO - Displaying image in OpenCV window: DICOM Image
2025-07-11 19:55:37 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:55:37 - root - DEBUG - Image data type: uint8
2025-07-11 19:55:37 - root - DEBUG - Creating OpenCV window and displaying image
2025-07-11 19:55:37 - root - INFO - Image displayed successfully
2025-07-11 19:55:37 - root - DEBUG - Waiting for user input (key press)
2025-07-11 19:55:39 - root - DEBUG - Destroying OpenCV windows
2025-07-11 19:55:39 - root - INFO - Image display completed and windows closed
2025-07-11 19:55:39 - root - INFO - Processing DICOM file 2/11: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000020_20250417_103454
2025-07-11 19:55:39 - root - DEBUG - Converting DICOM to PNG format
2025-07-11 19:55:39 - root - INFO - Starting DICOM to PNG conversion: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000020_20250417_103454
2025-07-11 19:55:39 - root - DEBUG - Reading DICOM file with pydicom
2025-07-11 19:55:39 - root - INFO - DICOM file loaded successfully
2025-07-11 19:55:39 - root - DEBUG - Original photometric interpretation: RGB
2025-07-11 19:55:39 - root - INFO - Processing RGB format DICOM
2025-07-11 19:55:39 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-11 19:55:39 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-11 19:55:39 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-11 19:55:39 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-11 19:55:39 - root - DEBUG - Cropping ultrasound image area
2025-07-11 19:55:39 - root - DEBUG - Initializing USRegionLocation detector
2025-07-11 19:55:39 - root - INFO - Getting ultrasound region coordinates
2025-07-11 19:55:39 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-11 19:55:39 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:55:39 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-11 19:55:39 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-11 19:55:39 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-11 19:55:39 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-11 19:55:39 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:55:39 - root - INFO - Analyzing cropped image for measurement tables
2025-07-11 19:55:39 - root - INFO - Starting table detection in ultrasound image
2025-07-11 19:55:39 - root - INFO - Initializing UltrasoundTableDetector
2025-07-11 19:55:39 - root - INFO - Initializing OCRHandler
2025-07-11 19:55:39 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-11 19:55:39 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-11 19:55:39 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-11 19:55:39 - root - DEBUG - - lang: 'en' (English language)
2025-07-11 19:55:39 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-11 19:55:39 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-11 19:55:39 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-11 19:55:39 - root - INFO - OCRHandler initialized successfully
2025-07-11 19:55:39 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-11 19:55:39 - root - INFO - Initializing TableDetector
2025-07-11 19:55:39 - root - DEBUG - TableDetector instance created successfully
2025-07-11 19:55:39 - root - DEBUG - Default detection parameters:
2025-07-11 19:55:39 - root - DEBUG - - Image upscale factor: 3x
2025-07-11 19:55:39 - root - DEBUG - - Edge threshold: 50
2025-07-11 19:55:39 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-11 19:55:39 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-11 19:55:39 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-11 19:55:39 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-11 19:55:39 - root - INFO - TableDetector initialization completed
2025-07-11 19:55:39 - root - INFO - Initializing TextAnalyzer
2025-07-11 19:55:39 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-11 19:55:39 - root - DEBUG - Text analysis configuration:
2025-07-11 19:55:39 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-11 19:55:39 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-11 19:55:39 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-11 19:55:39 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-11 19:55:39 - root - INFO - TextAnalyzer initialization completed
2025-07-11 19:55:39 - root - INFO - Initializing ContentExtractor
2025-07-11 19:55:39 - root - INFO - ContentExtractor initialized successfully
2025-07-11 19:55:39 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-11 19:55:39 - root - INFO - Detecting measurement tables in the image
2025-07-11 19:55:39 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-11 19:55:39 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-11 19:55:39 - root - DEBUG - Converting upscaled image to grayscale
2025-07-11 19:55:39 - root - DEBUG - Grayscale conversion completed
2025-07-11 19:55:39 - root - INFO - Applying edge detection to grayscale image
2025-07-11 19:55:39 - root - DEBUG - Edge detection completed
2025-07-11 19:55:39 - root - DEBUG - Applying threshold to create binary image
2025-07-11 19:55:39 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 410383
2025-07-11 19:55:39 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-11 19:55:39 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-11 19:55:39 - root - INFO - Enhancing horizontal and vertical lines
2025-07-11 19:55:39 - root - DEBUG - Line enhancement completed
2025-07-11 19:55:39 - root - DEBUG - Applying dilation to make lines thicker
2025-07-11 19:55:39 - root - DEBUG - Line thickening completed
2025-07-11 19:55:39 - root - DEBUG - Combining horizontal and vertical lines
2025-07-11 19:55:39 - root - DEBUG - Line combination completed
2025-07-11 19:55:39 - root - DEBUG - Created copy for contour visualization
2025-07-11 19:55:39 - root - INFO - Finding contours in enhanced lines
2025-07-11 19:55:39 - root - INFO - Found 1006 contours
2025-07-11 19:55:39 - root - DEBUG - Drawing contours for visualization
2025-07-11 19:55:39 - root - DEBUG - Contours drawn successfully
2025-07-11 19:55:39 - root - INFO - Processing contours to find rectangular regions
2025-07-11 19:55:39 - root - INFO - Rectangular region detection completed
2025-07-11 19:55:39 - root - INFO - Total candidate regions found: 172
2025-07-11 19:55:39 - root - DEBUG - Found 172 candidate regions
2025-07-11 19:55:39 - root - INFO - Processing candidate regions for measurement content
2025-07-11 19:55:40 - root - DEBUG - Line 1: '1 D 8.60cm' (conf: 0.988)
2025-07-11 19:55:40 - root - DEBUG - Line 2: '2 D 4.17cm' (conf: 0.999)
2025-07-11 19:55:40 - root - DEBUG - Line 3: '3 ' (conf: 0.994)
2025-07-11 19:55:40 - root - DEBUG - Line 4: 'D 3.63cm' (conf: 0.998)
2025-07-11 19:55:40 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:55:40 - root - DEBUG - Number of text lines detected: 4
2025-07-11 19:55:40 - root - DEBUG - Text extraction completed - Lines processed: 4
2025-07-11 19:55:40 - root - DEBUG - Combined text: '1 d 8.60cm 2 d 4.17cm 3  d 3.63cm'
2025-07-11 19:55:40 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:55:40 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:55:40 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:55:40 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:55:40 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:55:40 - root - DEBUG - Pattern 1 matches: 3
2025-07-11 19:55:40 - root - DEBUG - Pattern 1 found matches: ['8.60cm', '4.17cm', '3.63cm']
2025-07-11 19:55:40 - root - DEBUG - Pattern 2 matches: 3
2025-07-11 19:55:40 - root - DEBUG - Pattern 2 found matches: ['d', 'd', 'd']
2025-07-11 19:55:40 - root - DEBUG - Base score from pattern matching: 6
2025-07-11 19:55:40 - root - DEBUG - 'cm' occurrences: 3, bonus added: 6
2025-07-11 19:55:40 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:55:40 - root - INFO - Final measurement score: 12
2025-07-11 19:55:40 - root - DEBUG - Line 1: '1' (conf: 0.843)
2025-07-11 19:55:40 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:55:40 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:55:40 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:55:40 - root - DEBUG - Combined text: '1'
2025-07-11 19:55:40 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:55:40 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:55:40 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:55:40 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:55:40 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:55:40 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:55:40 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:55:40 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:55:40 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:55:40 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:55:40 - root - INFO - Final measurement score: 0
2025-07-11 19:55:41 - root - DEBUG - Line 1: 'E2' (conf: 0.914)
2025-07-11 19:55:41 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:55:41 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:55:41 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:55:41 - root - DEBUG - Combined text: 'e2'
2025-07-11 19:55:41 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:55:41 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:55:41 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:55:41 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:55:41 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:55:41 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:55:41 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:55:41 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:55:41 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:55:41 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:55:41 - root - INFO - Final measurement score: 0
2025-07-11 19:55:41 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-11 19:55:41 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-11 19:55:41 - root - DEBUG - Top 10 score indices: [4, 0, 1, 2, 3, 5, 6, 7, 8, 9]
2025-07-11 19:55:41 - root - DEBUG - Rank 1: Index 4, Score 12.000000
2025-07-11 19:55:41 - root - DEBUG - Rank 2: Index 0, Score 0.000000
2025-07-11 19:55:41 - root - DEBUG - Rank 3: Index 1, Score 0.000000
2025-07-11 19:55:41 - root - DEBUG - Rank 4: Index 2, Score 0.000000
2025-07-11 19:55:41 - root - DEBUG - Rank 5: Index 3, Score 0.000000
2025-07-11 19:55:41 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-11 19:55:41 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-11 19:55:41 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-11 19:55:41 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-11 19:55:41 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-11 19:55:41 - root - INFO - Best candidate meets threshold (>= 4). Score: 12.000000
2025-07-11 19:55:41 - root - DEBUG - All top 10 scores:
2025-07-11 19:55:41 - root - DEBUG - Score index 4: 12.000000
2025-07-11 19:55:41 - root - DEBUG - Score index 0: 0.000000
2025-07-11 19:55:41 - root - DEBUG - Score index 1: 0.000000
2025-07-11 19:55:41 - root - DEBUG - Score index 2: 0.000000
2025-07-11 19:55:41 - root - DEBUG - Score index 3: 0.000000
2025-07-11 19:55:41 - root - DEBUG - Score index 5: 0.000000
2025-07-11 19:55:41 - root - DEBUG - Score index 6: 0.000000
2025-07-11 19:55:41 - root - DEBUG - Score index 7: 0.000000
2025-07-11 19:55:41 - root - DEBUG - Score index 8: 0.000000
2025-07-11 19:55:41 - root - DEBUG - Score index 9: 0.000000
2025-07-11 19:55:41 - root - INFO - Measurement table detection completed successfully
2025-07-11 19:55:41 - root - DEBUG - Table detection completed. Candidates found: 172
2025-07-11 19:55:41 - root - INFO - Identifying organ name from the image
2025-07-11 19:55:41 - root - INFO - Starting organ name identification
2025-07-11 19:55:41 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:55:41 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-11 19:55:41 - root - INFO - Starting organ label identification
2025-07-11 19:55:41 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-11 19:55:41 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-11 19:55:43 - root - DEBUG - Line 1: '64% 22Hz' (conf: 0.974)
2025-07-11 19:55:43 - root - DEBUG - Line 2: 'Voluson' (conf: 0.993)
2025-07-11 19:55:43 - root - DEBUG - Line 3: 'Voluson' (conf: 0.988)
2025-07-11 19:55:43 - root - DEBUG - Line 4: 'Abdomen' (conf: 0.996)
2025-07-11 19:55:43 - root - DEBUG - Line 5: '58' (conf: 0.910)
2025-07-11 19:55:43 - root - DEBUG - Line 6: '58' (conf: 0.985)
2025-07-11 19:55:43 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.993)
2025-07-11 19:55:43 - root - DEBUG - Line 8: 'A0 100%' (conf: 0.984)
2025-07-11 19:55:43 - root - DEBUG - Line 9: 'Gn -20' (conf: 0.991)
2025-07-11 19:55:43 - root - DEBUG - Line 10: 'C6M4' (conf: 0.996)
2025-07-11 19:55:43 - root - DEBUG - Line 11: 'FF1 / E2' (conf: 0.998)
2025-07-11 19:55:43 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.971)
2025-07-11 19:55:43 - root - DEBUG - Line 13: 'UTERUS' (conf: 1.000)
2025-07-11 19:55:43 - root - DEBUG - Line 14: 'D 8.60cm' (conf: 1.000)
2025-07-11 19:55:43 - root - DEBUG - Line 15: 'D 4.17cm' (conf: 0.994)
2025-07-11 19:55:43 - root - DEBUG - Line 16: '3 D 3.63cm' (conf: 0.955)
2025-07-11 19:55:43 - root - DEBUG - OCR completed. Processing 16 text lines for organ keywords
2025-07-11 19:55:43 - root - DEBUG - Line 0 text: '64% 22Hz'
2025-07-11 19:55:43 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-11 19:55:43 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-11 19:55:43 - root - DEBUG - Line 3 text: 'Abdomen'
2025-07-11 19:55:43 - root - DEBUG - Line 4 text: '58'
2025-07-11 19:55:43 - root - DEBUG - Line 5 text: '58'
2025-07-11 19:55:43 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-11 19:55:43 - root - DEBUG - Line 7 text: 'A0 100%'
2025-07-11 19:55:43 - root - DEBUG - Line 8 text: 'Gn -20'
2025-07-11 19:55:43 - root - DEBUG - Line 9 text: 'C6M4'
2025-07-11 19:55:43 - root - DEBUG - Line 10 text: 'FF1 / E2'
2025-07-11 19:55:43 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-11 19:55:43 - root - DEBUG - Line 12 text: 'UTERUS'
2025-07-11 19:55:43 - root - DEBUG - Line 13 text: 'D 8.60cm'
2025-07-11 19:55:43 - root - DEBUG - Line 14 text: 'D 4.17cm'
2025-07-11 19:55:43 - root - DEBUG - Line 15 text: '3 D 3.63cm'
2025-07-11 19:55:43 - root - DEBUG - Combined text for keyword search: '64% 22hz voluson voluson abdomen 58 58 hm pi 7.70 - 2.10 a0 100% gn -20 c6m4 ff1 / e2 sri ii 2 / cri 2 uterus d 8.60cm d 4.17cm 3 d 3.63cm'
2025-07-11 19:55:43 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-11 19:55:43 - root - DEBUG - Found organ keyword: 'uterus'
2025-07-11 19:55:43 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-11 19:55:43 - root - INFO - Identified organs: ['uterus']
2025-07-11 19:55:43 - root - INFO - Organ identification completed successfully: ['uterus']
2025-07-11 19:55:43 - root - DEBUG - Organ identified: ['uterus']
2025-07-11 19:55:43 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-11 19:55:43 - root - DEBUG - Number of scored candidates: 10
2025-07-11 19:55:43 - root - DEBUG - Best score index: 4
2025-07-11 19:55:43 - root - INFO - Extracting structured data from detected table
2025-07-11 19:55:43 - root - INFO - Starting table content extraction
2025-07-11 19:55:43 - root - DEBUG - Bounding box coordinates: (3110, 2056, 294, 247)
2025-07-11 19:55:43 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-11 19:55:43 - root - DEBUG - Delegating to content extractor for table processing
2025-07-11 19:55:43 - root - INFO - Starting table content extraction
2025-07-11 19:55:43 - root - DEBUG - Bounding box coordinates: (3110, 2056, 294, 247)
2025-07-11 19:55:43 - root - INFO - Performing OCR on extracted table region
2025-07-11 19:55:44 - root - DEBUG - Line 1: '1 D 8.60cm' (conf: 0.988)
2025-07-11 19:55:44 - root - DEBUG - Line 2: '2 D 4.17cm' (conf: 0.999)
2025-07-11 19:55:44 - root - DEBUG - Line 3: '3 ' (conf: 0.994)
2025-07-11 19:55:44 - root - DEBUG - Line 4: 'D 3.63cm' (conf: 0.998)
2025-07-11 19:55:44 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-11 19:55:44 - root - INFO - Extracted 4 text elements from table region
2025-07-11 19:55:44 - root - INFO - Structuring extracted text data
2025-07-11 19:55:44 - root - INFO - Starting table data structuring
2025-07-11 19:55:44 - root - DEBUG - Element 1: text='1 D 8.60cm', x=154.00, y=43.50, conf=0.988
2025-07-11 19:55:44 - root - DEBUG - Element 2: text='2 D 4.17cm', x=151.50, y=128.00, conf=0.999
2025-07-11 19:55:44 - root - DEBUG - Element 3: text='3 ', x=55.50, y=214.00, conf=0.994
2025-07-11 19:55:44 - root - DEBUG - Element 4: text='D 3.63cm', x=179.50, y=211.00, conf=0.998
2025-07-11 19:55:44 - root - DEBUG - Processing element 1/4: '1 D 8.60cm' at (154.00, 43.50)
2025-07-11 19:55:44 - root - DEBUG - Processing element 2/4: '2 D 4.17cm' at (151.50, 128.00)
2025-07-11 19:55:44 - root - DEBUG - Processing element 3/4: 'D 3.63cm' at (179.50, 211.00)
2025-07-11 19:55:44 - root - DEBUG - Processing element 4/4: '3 ' at (55.50, 214.00)
2025-07-11 19:55:44 - root - INFO - Line grouping completed - Total lines: 3
2025-07-11 19:55:44 - root - DEBUG - Processing line 1/3 with 1 elements
2025-07-11 19:55:44 - root - DEBUG - Processing word 1/1: '1 D 8.60cm'
2025-07-11 19:55:44 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:55:44 - root - DEBUG - Input text: '1 D 8.60cm'
2025-07-11 19:55:44 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:55:44 - root - DEBUG - Pattern 1 matched successfully
2025-07-11 19:55:44 - root - DEBUG - Pattern 1 groups: ('1', 'D', '8.60cm')
2025-07-11 19:55:44 - root - DEBUG - Pattern 1 result: ('1', 'D', '8.60cm')
2025-07-11 19:55:44 - root - INFO - Text split successful using pattern 1: ('1', 'D', '8.60cm')
2025-07-11 19:55:44 - root - DEBUG - Split measurement result: ('1', 'D', '8.60cm')
2025-07-11 19:55:44 - root - DEBUG - Processing line 2/3 with 1 elements
2025-07-11 19:55:44 - root - DEBUG - Processing word 1/1: '2 D 4.17cm'
2025-07-11 19:55:44 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:55:44 - root - DEBUG - Input text: '2 D 4.17cm'
2025-07-11 19:55:44 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:55:44 - root - DEBUG - Pattern 1 matched successfully
2025-07-11 19:55:44 - root - DEBUG - Pattern 1 groups: ('2', 'D', '4.17cm')
2025-07-11 19:55:44 - root - DEBUG - Pattern 1 result: ('2', 'D', '4.17cm')
2025-07-11 19:55:44 - root - INFO - Text split successful using pattern 1: ('2', 'D', '4.17cm')
2025-07-11 19:55:44 - root - DEBUG - Split measurement result: ('2', 'D', '4.17cm')
2025-07-11 19:55:44 - root - DEBUG - Processing line 3/3 with 2 elements
2025-07-11 19:55:44 - root - DEBUG - Processing word 1/2: '3 '
2025-07-11 19:55:44 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:55:44 - root - DEBUG - Input text: '3 '
2025-07-11 19:55:44 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:55:44 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:55:44 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:55:44 - root - DEBUG - Pattern 2 did not match
2025-07-11 19:55:44 - root - DEBUG - No patterns matched for text: '3 '
2025-07-11 19:55:44 - root - INFO - Text split failed - no matching patterns found
2025-07-11 19:55:44 - root - DEBUG - Split measurement result: None
2025-07-11 19:55:44 - root - DEBUG - Processing word 2/2: 'D 3.63cm'
2025-07-11 19:55:44 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:55:44 - root - DEBUG - Input text: 'D 3.63cm'
2025-07-11 19:55:44 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:55:44 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:55:44 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:55:44 - root - DEBUG - Pattern 2 matched successfully
2025-07-11 19:55:44 - root - DEBUG - Pattern 2 groups: ('D', '3.63cm')
2025-07-11 19:55:44 - root - DEBUG - Pattern 2 result: ('D', '3.63cm')
2025-07-11 19:55:44 - root - INFO - Text split successful using pattern 2: ('D', '3.63cm')
2025-07-11 19:55:44 - root - DEBUG - Split measurement result: ('D', '3.63cm')
2025-07-11 19:55:44 - root - DEBUG - Final structured data:
2025-07-11 19:55:44 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D', '8.60cm']}'
2025-07-11 19:55:44 - root - DEBUG - Item 2 (text): '{'Value2': ['2', 'D', '4.17cm']}'
2025-07-11 19:55:44 - root - DEBUG - Item 3 (text): '{'Value3': ['3 ', 'D', '3.63cm']}'
2025-07-11 19:55:44 - root - INFO - Table content extraction completed successfully
2025-07-11 19:55:44 - root - DEBUG - Structured data keys: [{'organLabel': ['uterus']}, {'Value1': ['1', 'D', '8.60cm']}, {'Value2': ['2', 'D', '4.17cm']}, {'Value3': ['3 ', 'D', '3.63cm']}]
2025-07-11 19:55:44 - root - DEBUG - Organ identified: ['uterus']
2025-07-11 19:55:44 - root - INFO - Table extraction successful for file: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000020_20250417_103454
2025-07-11 19:55:44 - root - INFO - Organ identified: ['uterus']
2025-07-11 19:55:44 - root - DEBUG - Structured data extracted: [{'organLabel': ['uterus']}, {'Value1': ['1', 'D', '8.60cm']}, {'Value2': ['2', 'D', '4.17cm']}, {'Value3': ['3 ', 'D', '3.63cm']}]
2025-07-11 19:55:44 - root - DEBUG - Displaying cropped image
2025-07-11 19:55:44 - root - INFO - Displaying image in OpenCV window: DICOM Image
2025-07-11 19:55:44 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:55:44 - root - DEBUG - Image data type: uint8
2025-07-11 19:55:44 - root - DEBUG - Creating OpenCV window and displaying image
2025-07-11 19:55:44 - root - INFO - Image displayed successfully
2025-07-11 19:55:44 - root - DEBUG - Waiting for user input (key press)
2025-07-11 19:55:45 - root - DEBUG - Destroying OpenCV windows
2025-07-11 19:55:45 - root - INFO - Image display completed and windows closed
2025-07-11 19:55:45 - root - INFO - Processing DICOM file 3/11: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000030_20250417_103454
2025-07-11 19:55:45 - root - DEBUG - Converting DICOM to PNG format
2025-07-11 19:55:45 - root - INFO - Starting DICOM to PNG conversion: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000030_20250417_103454
2025-07-11 19:55:45 - root - DEBUG - Reading DICOM file with pydicom
2025-07-11 19:55:45 - root - INFO - DICOM file loaded successfully
2025-07-11 19:55:45 - root - DEBUG - Original photometric interpretation: RGB
2025-07-11 19:55:45 - root - INFO - Processing RGB format DICOM
2025-07-11 19:55:45 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-11 19:55:45 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-11 19:55:45 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-11 19:55:45 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-11 19:55:45 - root - DEBUG - Cropping ultrasound image area
2025-07-11 19:55:45 - root - DEBUG - Initializing USRegionLocation detector
2025-07-11 19:55:45 - root - INFO - Getting ultrasound region coordinates
2025-07-11 19:55:45 - root - DEBUG - Raw coordinates - minx0: [0], miny0: [66], maxx1: [1136], maxy1: [852]
2025-07-11 19:55:45 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:55:45 - root - INFO - Single region detected, using direct coordinates
2025-07-11 19:55:45 - root - DEBUG - Single region bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-11 19:55:45 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-11 19:55:45 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-11 19:55:45 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:55:45 - root - INFO - Analyzing cropped image for measurement tables
2025-07-11 19:55:45 - root - INFO - Starting table detection in ultrasound image
2025-07-11 19:55:45 - root - INFO - Initializing UltrasoundTableDetector
2025-07-11 19:55:45 - root - INFO - Initializing OCRHandler
2025-07-11 19:55:45 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-11 19:55:45 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-11 19:55:45 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-11 19:55:45 - root - DEBUG - - lang: 'en' (English language)
2025-07-11 19:55:45 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-11 19:55:45 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-11 19:55:45 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-11 19:55:45 - root - INFO - OCRHandler initialized successfully
2025-07-11 19:55:45 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-11 19:55:45 - root - INFO - Initializing TableDetector
2025-07-11 19:55:45 - root - DEBUG - TableDetector instance created successfully
2025-07-11 19:55:45 - root - DEBUG - Default detection parameters:
2025-07-11 19:55:45 - root - DEBUG - - Image upscale factor: 3x
2025-07-11 19:55:45 - root - DEBUG - - Edge threshold: 50
2025-07-11 19:55:45 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-11 19:55:45 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-11 19:55:45 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-11 19:55:45 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-11 19:55:45 - root - INFO - TableDetector initialization completed
2025-07-11 19:55:45 - root - INFO - Initializing TextAnalyzer
2025-07-11 19:55:45 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-11 19:55:45 - root - DEBUG - Text analysis configuration:
2025-07-11 19:55:45 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-11 19:55:45 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-11 19:55:45 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-11 19:55:45 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-11 19:55:45 - root - INFO - TextAnalyzer initialization completed
2025-07-11 19:55:45 - root - INFO - Initializing ContentExtractor
2025-07-11 19:55:45 - root - INFO - ContentExtractor initialized successfully
2025-07-11 19:55:45 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-11 19:55:45 - root - INFO - Detecting measurement tables in the image
2025-07-11 19:55:45 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-11 19:55:45 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-11 19:55:45 - root - DEBUG - Converting upscaled image to grayscale
2025-07-11 19:55:45 - root - DEBUG - Grayscale conversion completed
2025-07-11 19:55:45 - root - INFO - Applying edge detection to grayscale image
2025-07-11 19:55:46 - root - DEBUG - Edge detection completed
2025-07-11 19:55:46 - root - DEBUG - Applying threshold to create binary image
2025-07-11 19:55:46 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 325111
2025-07-11 19:55:46 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-11 19:55:46 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-11 19:55:46 - root - INFO - Enhancing horizontal and vertical lines
2025-07-11 19:55:46 - root - DEBUG - Line enhancement completed
2025-07-11 19:55:46 - root - DEBUG - Applying dilation to make lines thicker
2025-07-11 19:55:46 - root - DEBUG - Line thickening completed
2025-07-11 19:55:46 - root - DEBUG - Combining horizontal and vertical lines
2025-07-11 19:55:46 - root - DEBUG - Line combination completed
2025-07-11 19:55:46 - root - DEBUG - Created copy for contour visualization
2025-07-11 19:55:46 - root - INFO - Finding contours in enhanced lines
2025-07-11 19:55:46 - root - INFO - Found 606 contours
2025-07-11 19:55:46 - root - DEBUG - Drawing contours for visualization
2025-07-11 19:55:46 - root - DEBUG - Contours drawn successfully
2025-07-11 19:55:46 - root - INFO - Processing contours to find rectangular regions
2025-07-11 19:55:46 - root - INFO - Rectangular region detection completed
2025-07-11 19:55:46 - root - INFO - Total candidate regions found: 98
2025-07-11 19:55:46 - root - DEBUG - Found 98 candidate regions
2025-07-11 19:55:46 - root - INFO - Processing candidate regions for measurement content
2025-07-11 19:55:46 - root - DEBUG - Line 1: '1 D 0.65cm' (conf: 0.992)
2025-07-11 19:55:46 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:55:46 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:55:46 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:55:46 - root - DEBUG - Combined text: '1 d 0.65cm'
2025-07-11 19:55:46 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:55:46 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:55:46 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:55:46 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:55:46 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:55:46 - root - DEBUG - Pattern 1 matches: 1
2025-07-11 19:55:46 - root - DEBUG - Pattern 1 found matches: ['0.65cm']
2025-07-11 19:55:46 - root - DEBUG - Pattern 2 matches: 1
2025-07-11 19:55:46 - root - DEBUG - Pattern 2 found matches: ['d']
2025-07-11 19:55:46 - root - DEBUG - Base score from pattern matching: 2
2025-07-11 19:55:46 - root - DEBUG - 'cm' occurrences: 1, bonus added: 2
2025-07-11 19:55:46 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:55:46 - root - INFO - Final measurement score: 4
2025-07-11 19:55:46 - root - DEBUG - Line 1: 'E2' (conf: 0.914)
2025-07-11 19:55:46 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:55:46 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:55:46 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:55:46 - root - DEBUG - Combined text: 'e2'
2025-07-11 19:55:46 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:55:46 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:55:46 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:55:46 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:55:46 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:55:46 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:55:46 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:55:46 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:55:46 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:55:46 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:55:46 - root - INFO - Final measurement score: 0
2025-07-11 19:55:47 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-11 19:55:47 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-11 19:55:47 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-11 19:55:47 - root - DEBUG - Rank 1: Index 0, Score 4.000000
2025-07-11 19:55:47 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-11 19:55:47 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-11 19:55:47 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-11 19:55:47 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-11 19:55:47 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-11 19:55:47 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-11 19:55:47 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-11 19:55:47 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-11 19:55:47 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-11 19:55:47 - root - INFO - Best candidate meets threshold (>= 4). Score: 4.000000
2025-07-11 19:55:47 - root - DEBUG - All top 10 scores:
2025-07-11 19:55:47 - root - DEBUG - Score index 0: 4.000000
2025-07-11 19:55:47 - root - DEBUG - Score index 1: 0.000000
2025-07-11 19:55:47 - root - DEBUG - Score index 2: 0.000000
2025-07-11 19:55:47 - root - DEBUG - Score index 3: 0.000000
2025-07-11 19:55:47 - root - DEBUG - Score index 4: 0.000000
2025-07-11 19:55:47 - root - DEBUG - Score index 5: 0.000000
2025-07-11 19:55:47 - root - DEBUG - Score index 6: 0.000000
2025-07-11 19:55:47 - root - DEBUG - Score index 7: 0.000000
2025-07-11 19:55:47 - root - DEBUG - Score index 8: 0.000000
2025-07-11 19:55:47 - root - DEBUG - Score index 9: 0.000000
2025-07-11 19:55:47 - root - INFO - Measurement table detection completed successfully
2025-07-11 19:55:47 - root - DEBUG - Table detection completed. Candidates found: 98
2025-07-11 19:55:47 - root - INFO - Identifying organ name from the image
2025-07-11 19:55:47 - root - INFO - Starting organ name identification
2025-07-11 19:55:47 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:55:47 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-11 19:55:47 - root - INFO - Starting organ label identification
2025-07-11 19:55:47 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-11 19:55:47 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-11 19:55:48 - root - DEBUG - Line 1: '64% 22Hz' (conf: 0.974)
2025-07-11 19:55:48 - root - DEBUG - Line 2: 'Voluson' (conf: 0.999)
2025-07-11 19:55:48 - root - DEBUG - Line 3: 'Abdomen' (conf: 0.996)
2025-07-11 19:55:48 - root - DEBUG - Line 4: '58' (conf: 0.962)
2025-07-11 19:55:48 - root - DEBUG - Line 5: 'HM PI 7.70 - 2.10' (conf: 0.993)
2025-07-11 19:55:48 - root - DEBUG - Line 6: 'A0 100%' (conf: 0.984)
2025-07-11 19:55:48 - root - DEBUG - Line 7: 'Gn -20' (conf: 0.993)
2025-07-11 19:55:48 - root - DEBUG - Line 8: 'C6/ M4' (conf: 0.950)
2025-07-11 19:55:48 - root - DEBUG - Line 9: 'FF1 / E2' (conf: 0.998)
2025-07-11 19:55:48 - root - DEBUG - Line 10: 'SRI II 2 / CRI 2' (conf: 0.991)
2025-07-11 19:55:48 - root - DEBUG - Line 11: '1 D 0.65cm' (conf: 0.998)
2025-07-11 19:55:48 - root - DEBUG - OCR completed. Processing 11 text lines for organ keywords
2025-07-11 19:55:48 - root - DEBUG - Line 0 text: '64% 22Hz'
2025-07-11 19:55:48 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-11 19:55:48 - root - DEBUG - Line 2 text: 'Abdomen'
2025-07-11 19:55:48 - root - DEBUG - Line 3 text: '58'
2025-07-11 19:55:48 - root - DEBUG - Line 4 text: 'HM PI 7.70 - 2.10'
2025-07-11 19:55:48 - root - DEBUG - Line 5 text: 'A0 100%'
2025-07-11 19:55:48 - root - DEBUG - Line 6 text: 'Gn -20'
2025-07-11 19:55:48 - root - DEBUG - Line 7 text: 'C6/ M4'
2025-07-11 19:55:48 - root - DEBUG - Line 8 text: 'FF1 / E2'
2025-07-11 19:55:48 - root - DEBUG - Line 9 text: 'SRI II 2 / CRI 2'
2025-07-11 19:55:48 - root - DEBUG - Line 10 text: '1 D 0.65cm'
2025-07-11 19:55:48 - root - DEBUG - Combined text for keyword search: '64% 22hz voluson abdomen 58 hm pi 7.70 - 2.10 a0 100% gn -20 c6/ m4 ff1 / e2 sri ii 2 / cri 2 1 d 0.65cm'
2025-07-11 19:55:48 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-11 19:55:48 - root - INFO - Organ identification completed. Found 0 organ keywords
2025-07-11 19:55:48 - root - INFO - Identified organs: []
2025-07-11 19:55:48 - root - WARNING - No organ name identified from the image
2025-07-11 19:55:48 - root - DEBUG - Organ identified: []
2025-07-11 19:55:48 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-11 19:55:48 - root - DEBUG - Number of scored candidates: 10
2025-07-11 19:55:48 - root - DEBUG - Best score index: 0
2025-07-11 19:55:48 - root - INFO - Extracting structured data from detected table
2025-07-11 19:55:48 - root - INFO - Starting table content extraction
2025-07-11 19:55:48 - root - DEBUG - Bounding box coordinates: (3110, 2225, 294, 79)
2025-07-11 19:55:48 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-11 19:55:48 - root - DEBUG - Delegating to content extractor for table processing
2025-07-11 19:55:48 - root - INFO - Starting table content extraction
2025-07-11 19:55:48 - root - DEBUG - Bounding box coordinates: (3110, 2225, 294, 79)
2025-07-11 19:55:48 - root - INFO - Performing OCR on extracted table region
2025-07-11 19:55:48 - root - DEBUG - Line 1: '1 D 0.65cm' (conf: 0.992)
2025-07-11 19:55:48 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-11 19:55:48 - root - INFO - Extracted 1 text elements from table region
2025-07-11 19:55:48 - root - INFO - Structuring extracted text data
2025-07-11 19:55:48 - root - INFO - Starting table data structuring
2025-07-11 19:55:48 - root - DEBUG - Element 1: text='1 D 0.65cm', x=154.00, y=42.00, conf=0.992
2025-07-11 19:55:48 - root - DEBUG - Processing element 1/1: '1 D 0.65cm' at (154.00, 42.00)
2025-07-11 19:55:48 - root - INFO - Line grouping completed - Total lines: 1
2025-07-11 19:55:48 - root - DEBUG - Processing line 1/1 with 1 elements
2025-07-11 19:55:48 - root - DEBUG - Processing word 1/1: '1 D 0.65cm'
2025-07-11 19:55:48 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:55:48 - root - DEBUG - Input text: '1 D 0.65cm'
2025-07-11 19:55:48 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:55:48 - root - DEBUG - Pattern 1 matched successfully
2025-07-11 19:55:48 - root - DEBUG - Pattern 1 groups: ('1', 'D', '0.65cm')
2025-07-11 19:55:48 - root - DEBUG - Pattern 1 result: ('1', 'D', '0.65cm')
2025-07-11 19:55:48 - root - INFO - Text split successful using pattern 1: ('1', 'D', '0.65cm')
2025-07-11 19:55:48 - root - DEBUG - Split measurement result: ('1', 'D', '0.65cm')
2025-07-11 19:55:48 - root - DEBUG - Final structured data:
2025-07-11 19:55:48 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D', '0.65cm']}'
2025-07-11 19:55:48 - root - INFO - Table content extraction completed successfully
2025-07-11 19:55:48 - root - DEBUG - Structured data keys: [{'organLabel': []}, {'Value1': ['1', 'D', '0.65cm']}]
2025-07-11 19:55:48 - root - DEBUG - Organ identified: []
2025-07-11 19:55:49 - root - INFO - Table extraction successful for file: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000030_20250417_103454
2025-07-11 19:55:49 - root - INFO - Organ identified: []
2025-07-11 19:55:49 - root - DEBUG - Structured data extracted: [{'organLabel': []}, {'Value1': ['1', 'D', '0.65cm']}]
2025-07-11 19:55:49 - root - DEBUG - Displaying cropped image
2025-07-11 19:55:49 - root - INFO - Displaying image in OpenCV window: DICOM Image
2025-07-11 19:55:49 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:55:49 - root - DEBUG - Image data type: uint8
2025-07-11 19:55:49 - root - DEBUG - Creating OpenCV window and displaying image
2025-07-11 19:55:49 - root - INFO - Image displayed successfully
2025-07-11 19:55:49 - root - DEBUG - Waiting for user input (key press)
2025-07-11 19:55:49 - root - DEBUG - Destroying OpenCV windows
2025-07-11 19:55:49 - root - INFO - Image display completed and windows closed
2025-07-11 19:55:49 - root - INFO - Processing DICOM file 4/11: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000040_20250417_103454
2025-07-11 19:55:49 - root - DEBUG - Converting DICOM to PNG format
2025-07-11 19:55:49 - root - INFO - Starting DICOM to PNG conversion: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000040_20250417_103454
2025-07-11 19:55:49 - root - DEBUG - Reading DICOM file with pydicom
2025-07-11 19:55:49 - root - INFO - DICOM file loaded successfully
2025-07-11 19:55:49 - root - DEBUG - Original photometric interpretation: RGB
2025-07-11 19:55:49 - root - INFO - Processing RGB format DICOM
2025-07-11 19:55:49 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-11 19:55:49 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-11 19:55:49 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-11 19:55:49 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-11 19:55:49 - root - DEBUG - Cropping ultrasound image area
2025-07-11 19:55:49 - root - DEBUG - Initializing USRegionLocation detector
2025-07-11 19:55:49 - root - INFO - Getting ultrasound region coordinates
2025-07-11 19:55:49 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-11 19:55:49 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:55:49 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-11 19:55:49 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-11 19:55:49 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-11 19:55:49 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-11 19:55:49 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:55:49 - root - INFO - Analyzing cropped image for measurement tables
2025-07-11 19:55:49 - root - INFO - Starting table detection in ultrasound image
2025-07-11 19:55:49 - root - INFO - Initializing UltrasoundTableDetector
2025-07-11 19:55:49 - root - INFO - Initializing OCRHandler
2025-07-11 19:55:49 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-11 19:55:49 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-11 19:55:49 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-11 19:55:49 - root - DEBUG - - lang: 'en' (English language)
2025-07-11 19:55:49 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-11 19:55:49 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-11 19:55:49 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-11 19:55:50 - root - INFO - OCRHandler initialized successfully
2025-07-11 19:55:50 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-11 19:55:50 - root - INFO - Initializing TableDetector
2025-07-11 19:55:50 - root - DEBUG - TableDetector instance created successfully
2025-07-11 19:55:50 - root - DEBUG - Default detection parameters:
2025-07-11 19:55:50 - root - DEBUG - - Image upscale factor: 3x
2025-07-11 19:55:50 - root - DEBUG - - Edge threshold: 50
2025-07-11 19:55:50 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-11 19:55:50 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-11 19:55:50 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-11 19:55:50 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-11 19:55:50 - root - INFO - TableDetector initialization completed
2025-07-11 19:55:50 - root - INFO - Initializing TextAnalyzer
2025-07-11 19:55:50 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-11 19:55:50 - root - DEBUG - Text analysis configuration:
2025-07-11 19:55:50 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-11 19:55:50 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-11 19:55:50 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-11 19:55:50 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-11 19:55:50 - root - INFO - TextAnalyzer initialization completed
2025-07-11 19:55:50 - root - INFO - Initializing ContentExtractor
2025-07-11 19:55:50 - root - INFO - ContentExtractor initialized successfully
2025-07-11 19:55:50 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-11 19:55:50 - root - INFO - Detecting measurement tables in the image
2025-07-11 19:55:50 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-11 19:55:50 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-11 19:55:50 - root - DEBUG - Converting upscaled image to grayscale
2025-07-11 19:55:50 - root - DEBUG - Grayscale conversion completed
2025-07-11 19:55:50 - root - INFO - Applying edge detection to grayscale image
2025-07-11 19:55:50 - root - DEBUG - Edge detection completed
2025-07-11 19:55:50 - root - DEBUG - Applying threshold to create binary image
2025-07-11 19:55:50 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 573974
2025-07-11 19:55:50 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-11 19:55:50 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-11 19:55:50 - root - INFO - Enhancing horizontal and vertical lines
2025-07-11 19:55:50 - root - DEBUG - Line enhancement completed
2025-07-11 19:55:50 - root - DEBUG - Applying dilation to make lines thicker
2025-07-11 19:55:50 - root - DEBUG - Line thickening completed
2025-07-11 19:55:50 - root - DEBUG - Combining horizontal and vertical lines
2025-07-11 19:55:50 - root - DEBUG - Line combination completed
2025-07-11 19:55:50 - root - DEBUG - Created copy for contour visualization
2025-07-11 19:55:50 - root - INFO - Finding contours in enhanced lines
2025-07-11 19:55:50 - root - INFO - Found 1070 contours
2025-07-11 19:55:50 - root - DEBUG - Drawing contours for visualization
2025-07-11 19:55:50 - root - DEBUG - Contours drawn successfully
2025-07-11 19:55:50 - root - INFO - Processing contours to find rectangular regions
2025-07-11 19:55:50 - root - INFO - Rectangular region detection completed
2025-07-11 19:55:50 - root - INFO - Total candidate regions found: 329
2025-07-11 19:55:50 - root - DEBUG - Found 329 candidate regions
2025-07-11 19:55:50 - root - INFO - Processing candidate regions for measurement content
2025-07-11 19:55:52 - root - DEBUG - Line 1: 'E2' (conf: 0.914)
2025-07-11 19:55:52 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:55:52 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:55:52 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:55:52 - root - DEBUG - Combined text: 'e2'
2025-07-11 19:55:52 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:55:52 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:55:52 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:55:52 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:55:52 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:55:52 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:55:52 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:55:52 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:55:52 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:55:52 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:55:52 - root - INFO - Final measurement score: 0
2025-07-11 19:55:52 - root - DEBUG - Line 1: 'M' (conf: 0.996)
2025-07-11 19:55:52 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:55:52 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:55:52 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:55:52 - root - DEBUG - Combined text: 'm'
2025-07-11 19:55:52 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:55:52 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:55:52 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:55:52 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:55:52 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:55:52 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:55:52 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:55:52 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:55:52 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:55:52 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:55:52 - root - INFO - Final measurement score: 0
2025-07-11 19:55:52 - root - DEBUG - Line 1: 'HM' (conf: 0.996)
2025-07-11 19:55:52 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:55:52 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:55:52 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:55:52 - root - DEBUG - Combined text: 'hm'
2025-07-11 19:55:52 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:55:52 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:55:52 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:55:52 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:55:52 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:55:52 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:55:52 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:55:52 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:55:52 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:55:52 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:55:52 - root - INFO - Final measurement score: 0
2025-07-11 19:55:52 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-11 19:55:52 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-11 19:55:52 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-11 19:55:52 - root - DEBUG - Rank 1: Index 0, Score 0.000000
2025-07-11 19:55:52 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-11 19:55:52 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-11 19:55:52 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-11 19:55:52 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-11 19:55:52 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-11 19:55:52 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-11 19:55:52 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-11 19:55:52 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-11 19:55:52 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-11 19:55:52 - root - WARNING - No candidates meet the minimum threshold of 4. Best score: 0.000000
2025-07-11 19:55:52 - root - INFO - Measurement table detection completed - no valid tables found
2025-07-11 19:55:52 - root - DEBUG - Table detection completed. Candidates found: 329
2025-07-11 19:55:52 - root - INFO - Identifying organ name from the image
2025-07-11 19:55:52 - root - INFO - Starting organ name identification
2025-07-11 19:55:52 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:55:52 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-11 19:55:52 - root - INFO - Starting organ label identification
2025-07-11 19:55:52 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-11 19:55:52 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-11 19:55:54 - root - DEBUG - Line 1: '64%21Hz' (conf: 0.946)
2025-07-11 19:55:54 - root - DEBUG - Line 2: 'Abdomen' (conf: 0.993)
2025-07-11 19:55:54 - root - DEBUG - Line 3: 'Voluson' (conf: 1.000)
2025-07-11 19:55:54 - root - DEBUG - Line 4: 'Voluson' (conf: 0.999)
2025-07-11 19:55:54 - root - DEBUG - Line 5: '58' (conf: 0.967)
2025-07-11 19:55:54 - root - DEBUG - Line 6: '58' (conf: 0.988)
2025-07-11 19:55:54 - root - DEBUG - Line 7: 'HM PI 7.70 = 2.10' (conf: 0.946)
2025-07-11 19:55:54 - root - DEBUG - Line 8: 'A0 100%' (conf: 0.993)
2025-07-11 19:55:54 - root - DEBUG - Line 9: 'Gn -19' (conf: 0.985)
2025-07-11 19:55:54 - root - DEBUG - Line 10: 'C6/M4' (conf: 0.991)
2025-07-11 19:55:54 - root - DEBUG - Line 11: 'FF1 / E2' (conf: 0.987)
2025-07-11 19:55:54 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.972)
2025-07-11 19:55:54 - root - DEBUG - Line 13: 'RT OVARY' (conf: 0.999)
2025-07-11 19:55:54 - root - DEBUG - OCR completed. Processing 13 text lines for organ keywords
2025-07-11 19:55:54 - root - DEBUG - Line 0 text: '64%21Hz'
2025-07-11 19:55:54 - root - DEBUG - Line 1 text: 'Abdomen'
2025-07-11 19:55:54 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-11 19:55:54 - root - DEBUG - Line 3 text: 'Voluson'
2025-07-11 19:55:54 - root - DEBUG - Line 4 text: '58'
2025-07-11 19:55:54 - root - DEBUG - Line 5 text: '58'
2025-07-11 19:55:54 - root - DEBUG - Line 6 text: 'HM PI 7.70 = 2.10'
2025-07-11 19:55:54 - root - DEBUG - Line 7 text: 'A0 100%'
2025-07-11 19:55:54 - root - DEBUG - Line 8 text: 'Gn -19'
2025-07-11 19:55:54 - root - DEBUG - Line 9 text: 'C6/M4'
2025-07-11 19:55:54 - root - DEBUG - Line 10 text: 'FF1 / E2'
2025-07-11 19:55:54 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-11 19:55:54 - root - DEBUG - Line 12 text: 'RT OVARY'
2025-07-11 19:55:54 - root - DEBUG - Combined text for keyword search: '64%21hz abdomen voluson voluson 58 58 hm pi 7.70 = 2.10 a0 100% gn -19 c6/m4 ff1 / e2 sri ii 2 / cri 2 rt ovary'
2025-07-11 19:55:54 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-11 19:55:54 - root - DEBUG - Found organ keyword: 'rt ovary'
2025-07-11 19:55:54 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-11 19:55:54 - root - INFO - Identified organs: ['rt ovary']
2025-07-11 19:55:54 - root - INFO - Organ identification completed successfully: ['rt ovary']
2025-07-11 19:55:54 - root - DEBUG - Organ identified: ['rt ovary']
2025-07-11 19:55:54 - root - WARNING - No measurement tables detected in the ultrasound image
2025-07-11 19:55:54 - root - WARNING - No structured data extracted from file: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000040_20250417_103454
2025-07-11 19:55:54 - root - DEBUG - Displaying cropped image
2025-07-11 19:55:54 - root - INFO - Displaying image in OpenCV window: DICOM Image
2025-07-11 19:55:54 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:55:54 - root - DEBUG - Image data type: uint8
2025-07-11 19:55:54 - root - DEBUG - Creating OpenCV window and displaying image
2025-07-11 19:55:54 - root - INFO - Image displayed successfully
2025-07-11 19:55:54 - root - DEBUG - Waiting for user input (key press)
2025-07-11 19:55:55 - root - DEBUG - Destroying OpenCV windows
2025-07-11 19:55:55 - root - INFO - Image display completed and windows closed
2025-07-11 19:55:55 - root - INFO - Processing DICOM file 5/11: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000060_20250417_103454
2025-07-11 19:55:55 - root - DEBUG - Converting DICOM to PNG format
2025-07-11 19:55:55 - root - INFO - Starting DICOM to PNG conversion: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000060_20250417_103454
2025-07-11 19:55:55 - root - DEBUG - Reading DICOM file with pydicom
2025-07-11 19:55:55 - root - INFO - DICOM file loaded successfully
2025-07-11 19:55:55 - root - DEBUG - Original photometric interpretation: RGB
2025-07-11 19:55:55 - root - INFO - Processing RGB format DICOM
2025-07-11 19:55:55 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-11 19:55:55 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-11 19:55:55 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-11 19:55:55 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-11 19:55:55 - root - DEBUG - Cropping ultrasound image area
2025-07-11 19:55:55 - root - DEBUG - Initializing USRegionLocation detector
2025-07-11 19:55:55 - root - INFO - Getting ultrasound region coordinates
2025-07-11 19:55:55 - root - DEBUG - Raw coordinates - minx0: [0], miny0: [66], maxx1: [1136], maxy1: [852]
2025-07-11 19:55:55 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:55:55 - root - INFO - Single region detected, using direct coordinates
2025-07-11 19:55:55 - root - DEBUG - Single region bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-11 19:55:55 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-11 19:55:55 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-11 19:55:55 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:55:55 - root - INFO - Analyzing cropped image for measurement tables
2025-07-11 19:55:55 - root - INFO - Starting table detection in ultrasound image
2025-07-11 19:55:55 - root - INFO - Initializing UltrasoundTableDetector
2025-07-11 19:55:55 - root - INFO - Initializing OCRHandler
2025-07-11 19:55:55 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-11 19:55:55 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-11 19:55:55 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-11 19:55:55 - root - DEBUG - - lang: 'en' (English language)
2025-07-11 19:55:55 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-11 19:55:55 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-11 19:55:55 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-11 19:55:55 - root - INFO - OCRHandler initialized successfully
2025-07-11 19:55:55 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-11 19:55:55 - root - INFO - Initializing TableDetector
2025-07-11 19:55:55 - root - DEBUG - TableDetector instance created successfully
2025-07-11 19:55:55 - root - DEBUG - Default detection parameters:
2025-07-11 19:55:55 - root - DEBUG - - Image upscale factor: 3x
2025-07-11 19:55:55 - root - DEBUG - - Edge threshold: 50
2025-07-11 19:55:55 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-11 19:55:55 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-11 19:55:55 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-11 19:55:55 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-11 19:55:55 - root - INFO - TableDetector initialization completed
2025-07-11 19:55:55 - root - INFO - Initializing TextAnalyzer
2025-07-11 19:55:55 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-11 19:55:55 - root - DEBUG - Text analysis configuration:
2025-07-11 19:55:55 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-11 19:55:55 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-11 19:55:55 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-11 19:55:55 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-11 19:55:55 - root - INFO - TextAnalyzer initialization completed
2025-07-11 19:55:55 - root - INFO - Initializing ContentExtractor
2025-07-11 19:55:55 - root - INFO - ContentExtractor initialized successfully
2025-07-11 19:55:55 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-11 19:55:55 - root - INFO - Detecting measurement tables in the image
2025-07-11 19:55:55 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-11 19:55:55 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-11 19:55:55 - root - DEBUG - Converting upscaled image to grayscale
2025-07-11 19:55:55 - root - DEBUG - Grayscale conversion completed
2025-07-11 19:55:55 - root - INFO - Applying edge detection to grayscale image
2025-07-11 19:55:55 - root - DEBUG - Edge detection completed
2025-07-11 19:55:55 - root - DEBUG - Applying threshold to create binary image
2025-07-11 19:55:55 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 347890
2025-07-11 19:55:55 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-11 19:55:55 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-11 19:55:55 - root - INFO - Enhancing horizontal and vertical lines
2025-07-11 19:55:55 - root - DEBUG - Line enhancement completed
2025-07-11 19:55:55 - root - DEBUG - Applying dilation to make lines thicker
2025-07-11 19:55:55 - root - DEBUG - Line thickening completed
2025-07-11 19:55:55 - root - DEBUG - Combining horizontal and vertical lines
2025-07-11 19:55:55 - root - DEBUG - Line combination completed
2025-07-11 19:55:55 - root - DEBUG - Created copy for contour visualization
2025-07-11 19:55:55 - root - INFO - Finding contours in enhanced lines
2025-07-11 19:55:56 - root - INFO - Found 755 contours
2025-07-11 19:55:56 - root - DEBUG - Drawing contours for visualization
2025-07-11 19:55:56 - root - DEBUG - Contours drawn successfully
2025-07-11 19:55:56 - root - INFO - Processing contours to find rectangular regions
2025-07-11 19:55:56 - root - INFO - Rectangular region detection completed
2025-07-11 19:55:56 - root - INFO - Total candidate regions found: 168
2025-07-11 19:55:56 - root - DEBUG - Found 168 candidate regions
2025-07-11 19:55:56 - root - INFO - Processing candidate regions for measurement content
2025-07-11 19:55:56 - root - DEBUG - Line 1: '1 D 5.87cm' (conf: 1.000)
2025-07-11 19:55:56 - root - DEBUG - Line 2: '2 ' (conf: 0.876)
2025-07-11 19:55:56 - root - DEBUG - Line 3: 'D 4.37cm' (conf: 1.000)
2025-07-11 19:55:56 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:55:56 - root - DEBUG - Number of text lines detected: 3
2025-07-11 19:55:56 - root - DEBUG - Text extraction completed - Lines processed: 3
2025-07-11 19:55:56 - root - DEBUG - Combined text: '1 d 5.87cm 2  d 4.37cm'
2025-07-11 19:55:56 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:55:56 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:55:56 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:55:56 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:55:56 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:55:56 - root - DEBUG - Pattern 1 matches: 2
2025-07-11 19:55:56 - root - DEBUG - Pattern 1 found matches: ['5.87cm', '4.37cm']
2025-07-11 19:55:56 - root - DEBUG - Pattern 2 matches: 2
2025-07-11 19:55:56 - root - DEBUG - Pattern 2 found matches: ['d', 'd']
2025-07-11 19:55:56 - root - DEBUG - Base score from pattern matching: 4
2025-07-11 19:55:56 - root - DEBUG - 'cm' occurrences: 2, bonus added: 4
2025-07-11 19:55:56 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:55:56 - root - INFO - Final measurement score: 8
2025-07-11 19:55:57 - root - DEBUG - Line 1: 'E2' (conf: 0.914)
2025-07-11 19:55:57 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:55:57 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:55:57 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:55:57 - root - DEBUG - Combined text: 'e2'
2025-07-11 19:55:57 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:55:57 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:55:57 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:55:57 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:55:57 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:55:57 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:55:57 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:55:57 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:55:57 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:55:57 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:55:57 - root - INFO - Final measurement score: 0
2025-07-11 19:55:57 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-11 19:55:57 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-11 19:55:57 - root - DEBUG - Top 10 score indices: [2, 0, 1, 3, 4, 5, 6, 7, 8, 9]
2025-07-11 19:55:57 - root - DEBUG - Rank 1: Index 2, Score 8.000000
2025-07-11 19:55:57 - root - DEBUG - Rank 2: Index 0, Score 0.000000
2025-07-11 19:55:57 - root - DEBUG - Rank 3: Index 1, Score 0.000000
2025-07-11 19:55:57 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-11 19:55:57 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-11 19:55:57 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-11 19:55:57 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-11 19:55:57 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-11 19:55:57 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-11 19:55:57 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-11 19:55:57 - root - INFO - Best candidate meets threshold (>= 4). Score: 8.000000
2025-07-11 19:55:57 - root - DEBUG - All top 10 scores:
2025-07-11 19:55:57 - root - DEBUG - Score index 2: 8.000000
2025-07-11 19:55:57 - root - DEBUG - Score index 0: 0.000000
2025-07-11 19:55:57 - root - DEBUG - Score index 1: 0.000000
2025-07-11 19:55:57 - root - DEBUG - Score index 3: 0.000000
2025-07-11 19:55:57 - root - DEBUG - Score index 4: 0.000000
2025-07-11 19:55:57 - root - DEBUG - Score index 5: 0.000000
2025-07-11 19:55:57 - root - DEBUG - Score index 6: 0.000000
2025-07-11 19:55:57 - root - DEBUG - Score index 7: 0.000000
2025-07-11 19:55:57 - root - DEBUG - Score index 8: 0.000000
2025-07-11 19:55:57 - root - DEBUG - Score index 9: 0.000000
2025-07-11 19:55:57 - root - INFO - Measurement table detection completed successfully
2025-07-11 19:55:57 - root - DEBUG - Table detection completed. Candidates found: 168
2025-07-11 19:55:57 - root - INFO - Identifying organ name from the image
2025-07-11 19:55:57 - root - INFO - Starting organ name identification
2025-07-11 19:55:57 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:55:57 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-11 19:55:57 - root - INFO - Starting organ label identification
2025-07-11 19:55:57 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-11 19:55:57 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-11 19:55:58 - root - DEBUG - Line 1: '64% 21Hz' (conf: 0.959)
2025-07-11 19:55:58 - root - DEBUG - Line 2: 'Voluson' (conf: 0.999)
2025-07-11 19:55:58 - root - DEBUG - Line 3: 'Abdomen' (conf: 0.996)
2025-07-11 19:55:58 - root - DEBUG - Line 4: '58' (conf: 0.988)
2025-07-11 19:55:58 - root - DEBUG - Line 5: 'HM PI 7.70 - 2.10' (conf: 0.993)
2025-07-11 19:55:58 - root - DEBUG - Line 6: 'A0 100%' (conf: 0.984)
2025-07-11 19:55:58 - root - DEBUG - Line 7: 'Gn -19' (conf: 0.983)
2025-07-11 19:55:58 - root - DEBUG - Line 8: 'C6/ M4' (conf: 0.950)
2025-07-11 19:55:58 - root - DEBUG - Line 9: 'FF1 / E2' (conf: 0.998)
2025-07-11 19:55:58 - root - DEBUG - Line 10: 'SRI II 2 / CRI 2' (conf: 0.991)
2025-07-11 19:55:58 - root - DEBUG - Line 11: '1 D 5.87cm' (conf: 0.993)
2025-07-11 19:55:58 - root - DEBUG - Line 12: '2 D 4.37cm' (conf: 0.986)
2025-07-11 19:55:58 - root - DEBUG - OCR completed. Processing 12 text lines for organ keywords
2025-07-11 19:55:58 - root - DEBUG - Line 0 text: '64% 21Hz'
2025-07-11 19:55:58 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-11 19:55:58 - root - DEBUG - Line 2 text: 'Abdomen'
2025-07-11 19:55:58 - root - DEBUG - Line 3 text: '58'
2025-07-11 19:55:58 - root - DEBUG - Line 4 text: 'HM PI 7.70 - 2.10'
2025-07-11 19:55:58 - root - DEBUG - Line 5 text: 'A0 100%'
2025-07-11 19:55:58 - root - DEBUG - Line 6 text: 'Gn -19'
2025-07-11 19:55:58 - root - DEBUG - Line 7 text: 'C6/ M4'
2025-07-11 19:55:58 - root - DEBUG - Line 8 text: 'FF1 / E2'
2025-07-11 19:55:58 - root - DEBUG - Line 9 text: 'SRI II 2 / CRI 2'
2025-07-11 19:55:58 - root - DEBUG - Line 10 text: '1 D 5.87cm'
2025-07-11 19:55:58 - root - DEBUG - Line 11 text: '2 D 4.37cm'
2025-07-11 19:55:58 - root - DEBUG - Combined text for keyword search: '64% 21hz voluson abdomen 58 hm pi 7.70 - 2.10 a0 100% gn -19 c6/ m4 ff1 / e2 sri ii 2 / cri 2 1 d 5.87cm 2 d 4.37cm'
2025-07-11 19:55:58 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-11 19:55:58 - root - INFO - Organ identification completed. Found 0 organ keywords
2025-07-11 19:55:58 - root - INFO - Identified organs: []
2025-07-11 19:55:58 - root - WARNING - No organ name identified from the image
2025-07-11 19:55:58 - root - DEBUG - Organ identified: []
2025-07-11 19:55:58 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-11 19:55:58 - root - DEBUG - Number of scored candidates: 10
2025-07-11 19:55:58 - root - DEBUG - Best score index: 2
2025-07-11 19:55:58 - root - INFO - Extracting structured data from detected table
2025-07-11 19:55:58 - root - INFO - Starting table content extraction
2025-07-11 19:55:58 - root - DEBUG - Bounding box coordinates: (3110, 2141, 294, 163)
2025-07-11 19:55:58 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-11 19:55:58 - root - DEBUG - Delegating to content extractor for table processing
2025-07-11 19:55:58 - root - INFO - Starting table content extraction
2025-07-11 19:55:58 - root - DEBUG - Bounding box coordinates: (3110, 2141, 294, 163)
2025-07-11 19:55:59 - root - INFO - Performing OCR on extracted table region
2025-07-11 19:55:59 - root - DEBUG - Line 1: '1 D 5.87cm' (conf: 1.000)
2025-07-11 19:55:59 - root - DEBUG - Line 2: '2 ' (conf: 0.876)
2025-07-11 19:55:59 - root - DEBUG - Line 3: 'D 4.37cm' (conf: 1.000)
2025-07-11 19:55:59 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-11 19:55:59 - root - INFO - Extracted 3 text elements from table region
2025-07-11 19:55:59 - root - INFO - Structuring extracted text data
2025-07-11 19:55:59 - root - INFO - Starting table data structuring
2025-07-11 19:55:59 - root - DEBUG - Element 1: text='1 D 5.87cm', x=153.00, y=43.00, conf=1.000
2025-07-11 19:55:59 - root - DEBUG - Element 2: text='2 ', x=55.00, y=130.00, conf=0.876
2025-07-11 19:55:59 - root - DEBUG - Element 3: text='D 4.37cm', x=180.00, y=126.00, conf=1.000
2025-07-11 19:55:59 - root - DEBUG - Processing element 1/3: '1 D 5.87cm' at (153.00, 43.00)
2025-07-11 19:55:59 - root - DEBUG - Processing element 2/3: 'D 4.37cm' at (180.00, 126.00)
2025-07-11 19:55:59 - root - DEBUG - Processing element 3/3: '2 ' at (55.00, 130.00)
2025-07-11 19:55:59 - root - INFO - Line grouping completed - Total lines: 2
2025-07-11 19:55:59 - root - DEBUG - Processing line 1/2 with 1 elements
2025-07-11 19:55:59 - root - DEBUG - Processing word 1/1: '1 D 5.87cm'
2025-07-11 19:55:59 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:55:59 - root - DEBUG - Input text: '1 D 5.87cm'
2025-07-11 19:55:59 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:55:59 - root - DEBUG - Pattern 1 matched successfully
2025-07-11 19:55:59 - root - DEBUG - Pattern 1 groups: ('1', 'D', '5.87cm')
2025-07-11 19:55:59 - root - DEBUG - Pattern 1 result: ('1', 'D', '5.87cm')
2025-07-11 19:55:59 - root - INFO - Text split successful using pattern 1: ('1', 'D', '5.87cm')
2025-07-11 19:55:59 - root - DEBUG - Split measurement result: ('1', 'D', '5.87cm')
2025-07-11 19:55:59 - root - DEBUG - Processing line 2/2 with 2 elements
2025-07-11 19:55:59 - root - DEBUG - Processing word 1/2: '2 '
2025-07-11 19:55:59 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:55:59 - root - DEBUG - Input text: '2 '
2025-07-11 19:55:59 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:55:59 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:55:59 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:55:59 - root - DEBUG - Pattern 2 did not match
2025-07-11 19:55:59 - root - DEBUG - No patterns matched for text: '2 '
2025-07-11 19:55:59 - root - INFO - Text split failed - no matching patterns found
2025-07-11 19:55:59 - root - DEBUG - Split measurement result: None
2025-07-11 19:55:59 - root - DEBUG - Processing word 2/2: 'D 4.37cm'
2025-07-11 19:55:59 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:55:59 - root - DEBUG - Input text: 'D 4.37cm'
2025-07-11 19:55:59 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:55:59 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:55:59 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:55:59 - root - DEBUG - Pattern 2 matched successfully
2025-07-11 19:55:59 - root - DEBUG - Pattern 2 groups: ('D', '4.37cm')
2025-07-11 19:55:59 - root - DEBUG - Pattern 2 result: ('D', '4.37cm')
2025-07-11 19:55:59 - root - INFO - Text split successful using pattern 2: ('D', '4.37cm')
2025-07-11 19:55:59 - root - DEBUG - Split measurement result: ('D', '4.37cm')
2025-07-11 19:55:59 - root - DEBUG - Final structured data:
2025-07-11 19:55:59 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D', '5.87cm']}'
2025-07-11 19:55:59 - root - DEBUG - Item 2 (text): '{'Value2': ['2 ', 'D', '4.37cm']}'
2025-07-11 19:55:59 - root - INFO - Table content extraction completed successfully
2025-07-11 19:55:59 - root - DEBUG - Structured data keys: [{'organLabel': []}, {'Value1': ['1', 'D', '5.87cm']}, {'Value2': ['2 ', 'D', '4.37cm']}]
2025-07-11 19:55:59 - root - DEBUG - Organ identified: []
2025-07-11 19:56:00 - root - INFO - Table extraction successful for file: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000060_20250417_103454
2025-07-11 19:56:00 - root - INFO - Organ identified: []
2025-07-11 19:56:00 - root - DEBUG - Structured data extracted: [{'organLabel': []}, {'Value1': ['1', 'D', '5.87cm']}, {'Value2': ['2 ', 'D', '4.37cm']}]
2025-07-11 19:56:00 - root - DEBUG - Displaying cropped image
2025-07-11 19:56:00 - root - INFO - Displaying image in OpenCV window: DICOM Image
2025-07-11 19:56:00 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:56:00 - root - DEBUG - Image data type: uint8
2025-07-11 19:56:00 - root - DEBUG - Creating OpenCV window and displaying image
2025-07-11 19:56:00 - root - INFO - Image displayed successfully
2025-07-11 19:56:00 - root - DEBUG - Waiting for user input (key press)
2025-07-11 19:56:00 - root - DEBUG - Destroying OpenCV windows
2025-07-11 19:56:00 - root - INFO - Image display completed and windows closed
2025-07-11 19:56:00 - root - INFO - Processing DICOM file 6/11: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000070_20250417_103454
2025-07-11 19:56:00 - root - DEBUG - Converting DICOM to PNG format
2025-07-11 19:56:00 - root - INFO - Starting DICOM to PNG conversion: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000070_20250417_103454
2025-07-11 19:56:00 - root - DEBUG - Reading DICOM file with pydicom
2025-07-11 19:56:00 - root - INFO - DICOM file loaded successfully
2025-07-11 19:56:00 - root - DEBUG - Original photometric interpretation: RGB
2025-07-11 19:56:00 - root - INFO - Processing RGB format DICOM
2025-07-11 19:56:00 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-11 19:56:00 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-11 19:56:00 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-11 19:56:00 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-11 19:56:00 - root - DEBUG - Cropping ultrasound image area
2025-07-11 19:56:00 - root - DEBUG - Initializing USRegionLocation detector
2025-07-11 19:56:00 - root - INFO - Getting ultrasound region coordinates
2025-07-11 19:56:00 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-11 19:56:00 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:56:00 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-11 19:56:00 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-11 19:56:00 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-11 19:56:00 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-11 19:56:00 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:56:00 - root - INFO - Analyzing cropped image for measurement tables
2025-07-11 19:56:00 - root - INFO - Starting table detection in ultrasound image
2025-07-11 19:56:00 - root - INFO - Initializing UltrasoundTableDetector
2025-07-11 19:56:00 - root - INFO - Initializing OCRHandler
2025-07-11 19:56:00 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-11 19:56:00 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-11 19:56:00 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-11 19:56:00 - root - DEBUG - - lang: 'en' (English language)
2025-07-11 19:56:00 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-11 19:56:00 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-11 19:56:00 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-11 19:56:01 - root - INFO - OCRHandler initialized successfully
2025-07-11 19:56:01 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-11 19:56:01 - root - INFO - Initializing TableDetector
2025-07-11 19:56:01 - root - DEBUG - TableDetector instance created successfully
2025-07-11 19:56:01 - root - DEBUG - Default detection parameters:
2025-07-11 19:56:01 - root - DEBUG - - Image upscale factor: 3x
2025-07-11 19:56:01 - root - DEBUG - - Edge threshold: 50
2025-07-11 19:56:01 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-11 19:56:01 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-11 19:56:01 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-11 19:56:01 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-11 19:56:01 - root - INFO - TableDetector initialization completed
2025-07-11 19:56:01 - root - INFO - Initializing TextAnalyzer
2025-07-11 19:56:01 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-11 19:56:01 - root - DEBUG - Text analysis configuration:
2025-07-11 19:56:01 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-11 19:56:01 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-11 19:56:01 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-11 19:56:01 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-11 19:56:01 - root - INFO - TextAnalyzer initialization completed
2025-07-11 19:56:01 - root - INFO - Initializing ContentExtractor
2025-07-11 19:56:01 - root - INFO - ContentExtractor initialized successfully
2025-07-11 19:56:01 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-11 19:56:01 - root - INFO - Detecting measurement tables in the image
2025-07-11 19:56:01 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-11 19:56:01 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-11 19:56:01 - root - DEBUG - Converting upscaled image to grayscale
2025-07-11 19:56:01 - root - DEBUG - Grayscale conversion completed
2025-07-11 19:56:01 - root - INFO - Applying edge detection to grayscale image
2025-07-11 19:56:01 - root - DEBUG - Edge detection completed
2025-07-11 19:56:01 - root - DEBUG - Applying threshold to create binary image
2025-07-11 19:56:01 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 539695
2025-07-11 19:56:01 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-11 19:56:01 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-11 19:56:01 - root - INFO - Enhancing horizontal and vertical lines
2025-07-11 19:56:01 - root - DEBUG - Line enhancement completed
2025-07-11 19:56:01 - root - DEBUG - Applying dilation to make lines thicker
2025-07-11 19:56:01 - root - DEBUG - Line thickening completed
2025-07-11 19:56:01 - root - DEBUG - Combining horizontal and vertical lines
2025-07-11 19:56:01 - root - DEBUG - Line combination completed
2025-07-11 19:56:01 - root - DEBUG - Created copy for contour visualization
2025-07-11 19:56:01 - root - INFO - Finding contours in enhanced lines
2025-07-11 19:56:01 - root - INFO - Found 988 contours
2025-07-11 19:56:01 - root - DEBUG - Drawing contours for visualization
2025-07-11 19:56:01 - root - DEBUG - Contours drawn successfully
2025-07-11 19:56:01 - root - INFO - Processing contours to find rectangular regions
2025-07-11 19:56:01 - root - INFO - Rectangular region detection completed
2025-07-11 19:56:01 - root - INFO - Total candidate regions found: 308
2025-07-11 19:56:01 - root - DEBUG - Found 308 candidate regions
2025-07-11 19:56:01 - root - INFO - Processing candidate regions for measurement content
2025-07-11 19:56:03 - root - DEBUG - Line 1: 'E2' (conf: 0.914)
2025-07-11 19:56:03 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:03 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:03 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:03 - root - DEBUG - Combined text: 'e2'
2025-07-11 19:56:03 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:03 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:03 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:03 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:03 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:03 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:03 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:03 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:03 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:03 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:03 - root - INFO - Final measurement score: 0
2025-07-11 19:56:03 - root - DEBUG - Line 1: 'HN' (conf: 0.872)
2025-07-11 19:56:03 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:03 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:03 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:03 - root - DEBUG - Combined text: 'hn'
2025-07-11 19:56:03 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:03 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:03 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:03 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:03 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:03 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:03 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:03 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:03 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:03 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:03 - root - INFO - Final measurement score: 0
2025-07-11 19:56:04 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-11 19:56:04 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-11 19:56:04 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-11 19:56:04 - root - DEBUG - Rank 1: Index 0, Score 0.000000
2025-07-11 19:56:04 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-11 19:56:04 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-11 19:56:04 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-11 19:56:04 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-11 19:56:04 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-11 19:56:04 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-11 19:56:04 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-11 19:56:04 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-11 19:56:04 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-11 19:56:04 - root - WARNING - No candidates meet the minimum threshold of 4. Best score: 0.000000
2025-07-11 19:56:04 - root - INFO - Measurement table detection completed - no valid tables found
2025-07-11 19:56:04 - root - DEBUG - Table detection completed. Candidates found: 308
2025-07-11 19:56:04 - root - INFO - Identifying organ name from the image
2025-07-11 19:56:04 - root - INFO - Starting organ name identification
2025-07-11 19:56:04 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:56:04 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-11 19:56:04 - root - INFO - Starting organ label identification
2025-07-11 19:56:04 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-11 19:56:04 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-11 19:56:05 - root - DEBUG - Line 1: '64%21Hz' (conf: 0.946)
2025-07-11 19:56:05 - root - DEBUG - Line 2: 'Abdomen' (conf: 0.993)
2025-07-11 19:56:05 - root - DEBUG - Line 3: 'Voluson' (conf: 1.000)
2025-07-11 19:56:05 - root - DEBUG - Line 4: 'Voluson' (conf: 0.999)
2025-07-11 19:56:05 - root - DEBUG - Line 5: '58' (conf: 0.967)
2025-07-11 19:56:05 - root - DEBUG - Line 6: '58' (conf: 0.988)
2025-07-11 19:56:05 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.963)
2025-07-11 19:56:05 - root - DEBUG - Line 8: 'A0 100%' (conf: 0.992)
2025-07-11 19:56:05 - root - DEBUG - Line 9: 'Gn -19' (conf: 0.985)
2025-07-11 19:56:05 - root - DEBUG - Line 10: 'C6/M4' (conf: 0.992)
2025-07-11 19:56:05 - root - DEBUG - Line 11: 'FF1 / E2' (conf: 0.990)
2025-07-11 19:56:05 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.928)
2025-07-11 19:56:05 - root - DEBUG - Line 13: 'LT OVARY' (conf: 0.996)
2025-07-11 19:56:05 - root - DEBUG - OCR completed. Processing 13 text lines for organ keywords
2025-07-11 19:56:05 - root - DEBUG - Line 0 text: '64%21Hz'
2025-07-11 19:56:05 - root - DEBUG - Line 1 text: 'Abdomen'
2025-07-11 19:56:05 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-11 19:56:05 - root - DEBUG - Line 3 text: 'Voluson'
2025-07-11 19:56:05 - root - DEBUG - Line 4 text: '58'
2025-07-11 19:56:05 - root - DEBUG - Line 5 text: '58'
2025-07-11 19:56:05 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-11 19:56:05 - root - DEBUG - Line 7 text: 'A0 100%'
2025-07-11 19:56:05 - root - DEBUG - Line 8 text: 'Gn -19'
2025-07-11 19:56:05 - root - DEBUG - Line 9 text: 'C6/M4'
2025-07-11 19:56:05 - root - DEBUG - Line 10 text: 'FF1 / E2'
2025-07-11 19:56:05 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-11 19:56:05 - root - DEBUG - Line 12 text: 'LT OVARY'
2025-07-11 19:56:05 - root - DEBUG - Combined text for keyword search: '64%21hz abdomen voluson voluson 58 58 hm pi 7.70 - 2.10 a0 100% gn -19 c6/m4 ff1 / e2 sri ii 2 / cri 2 lt ovary'
2025-07-11 19:56:05 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-11 19:56:05 - root - DEBUG - Found organ keyword: 'lt ovary'
2025-07-11 19:56:05 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-11 19:56:05 - root - INFO - Identified organs: ['lt ovary']
2025-07-11 19:56:05 - root - INFO - Organ identification completed successfully: ['lt ovary']
2025-07-11 19:56:05 - root - DEBUG - Organ identified: ['lt ovary']
2025-07-11 19:56:05 - root - WARNING - No measurement tables detected in the ultrasound image
2025-07-11 19:56:05 - root - WARNING - No structured data extracted from file: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000070_20250417_103454
2025-07-11 19:56:05 - root - DEBUG - Displaying cropped image
2025-07-11 19:56:05 - root - INFO - Displaying image in OpenCV window: DICOM Image
2025-07-11 19:56:05 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:56:05 - root - DEBUG - Image data type: uint8
2025-07-11 19:56:05 - root - DEBUG - Creating OpenCV window and displaying image
2025-07-11 19:56:05 - root - INFO - Image displayed successfully
2025-07-11 19:56:05 - root - DEBUG - Waiting for user input (key press)
2025-07-11 19:56:07 - root - DEBUG - Destroying OpenCV windows
2025-07-11 19:56:07 - root - INFO - Image display completed and windows closed
2025-07-11 19:56:07 - root - INFO - Processing DICOM file 7/11: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000080_20250417_103454
2025-07-11 19:56:07 - root - DEBUG - Converting DICOM to PNG format
2025-07-11 19:56:07 - root - INFO - Starting DICOM to PNG conversion: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000080_20250417_103454
2025-07-11 19:56:07 - root - DEBUG - Reading DICOM file with pydicom
2025-07-11 19:56:07 - root - INFO - DICOM file loaded successfully
2025-07-11 19:56:07 - root - DEBUG - Original photometric interpretation: RGB
2025-07-11 19:56:07 - root - INFO - Processing RGB format DICOM
2025-07-11 19:56:07 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-11 19:56:07 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-11 19:56:07 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-11 19:56:07 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-11 19:56:07 - root - DEBUG - Cropping ultrasound image area
2025-07-11 19:56:07 - root - DEBUG - Initializing USRegionLocation detector
2025-07-11 19:56:07 - root - INFO - Getting ultrasound region coordinates
2025-07-11 19:56:07 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-11 19:56:07 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:56:07 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-11 19:56:07 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-11 19:56:07 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-11 19:56:07 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-11 19:56:07 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:56:07 - root - INFO - Analyzing cropped image for measurement tables
2025-07-11 19:56:07 - root - INFO - Starting table detection in ultrasound image
2025-07-11 19:56:07 - root - INFO - Initializing UltrasoundTableDetector
2025-07-11 19:56:07 - root - INFO - Initializing OCRHandler
2025-07-11 19:56:07 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-11 19:56:07 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-11 19:56:07 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-11 19:56:07 - root - DEBUG - - lang: 'en' (English language)
2025-07-11 19:56:07 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-11 19:56:07 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-11 19:56:07 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-11 19:56:08 - root - INFO - OCRHandler initialized successfully
2025-07-11 19:56:08 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-11 19:56:08 - root - INFO - Initializing TableDetector
2025-07-11 19:56:08 - root - DEBUG - TableDetector instance created successfully
2025-07-11 19:56:08 - root - DEBUG - Default detection parameters:
2025-07-11 19:56:08 - root - DEBUG - - Image upscale factor: 3x
2025-07-11 19:56:08 - root - DEBUG - - Edge threshold: 50
2025-07-11 19:56:08 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-11 19:56:08 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-11 19:56:08 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-11 19:56:08 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-11 19:56:08 - root - INFO - TableDetector initialization completed
2025-07-11 19:56:08 - root - INFO - Initializing TextAnalyzer
2025-07-11 19:56:08 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-11 19:56:08 - root - DEBUG - Text analysis configuration:
2025-07-11 19:56:08 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-11 19:56:08 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-11 19:56:08 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-11 19:56:08 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-11 19:56:08 - root - INFO - TextAnalyzer initialization completed
2025-07-11 19:56:08 - root - INFO - Initializing ContentExtractor
2025-07-11 19:56:08 - root - INFO - ContentExtractor initialized successfully
2025-07-11 19:56:08 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-11 19:56:08 - root - INFO - Detecting measurement tables in the image
2025-07-11 19:56:08 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-11 19:56:08 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-11 19:56:08 - root - DEBUG - Converting upscaled image to grayscale
2025-07-11 19:56:08 - root - DEBUG - Grayscale conversion completed
2025-07-11 19:56:08 - root - INFO - Applying edge detection to grayscale image
2025-07-11 19:56:08 - root - DEBUG - Edge detection completed
2025-07-11 19:56:08 - root - DEBUG - Applying threshold to create binary image
2025-07-11 19:56:08 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 470717
2025-07-11 19:56:08 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-11 19:56:08 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-11 19:56:08 - root - INFO - Enhancing horizontal and vertical lines
2025-07-11 19:56:08 - root - DEBUG - Line enhancement completed
2025-07-11 19:56:08 - root - DEBUG - Applying dilation to make lines thicker
2025-07-11 19:56:08 - root - DEBUG - Line thickening completed
2025-07-11 19:56:08 - root - DEBUG - Combining horizontal and vertical lines
2025-07-11 19:56:08 - root - DEBUG - Line combination completed
2025-07-11 19:56:08 - root - DEBUG - Created copy for contour visualization
2025-07-11 19:56:08 - root - INFO - Finding contours in enhanced lines
2025-07-11 19:56:08 - root - INFO - Found 1091 contours
2025-07-11 19:56:08 - root - DEBUG - Drawing contours for visualization
2025-07-11 19:56:08 - root - DEBUG - Contours drawn successfully
2025-07-11 19:56:08 - root - INFO - Processing contours to find rectangular regions
2025-07-11 19:56:08 - root - INFO - Rectangular region detection completed
2025-07-11 19:56:08 - root - INFO - Total candidate regions found: 235
2025-07-11 19:56:08 - root - DEBUG - Found 235 candidate regions
2025-07-11 19:56:08 - root - INFO - Processing candidate regions for measurement content
2025-07-11 19:56:09 - root - DEBUG - Line 1: '2.93cm' (conf: 1.000)
2025-07-11 19:56:09 - root - DEBUG - Line 2: '1' (conf: 0.831)
2025-07-11 19:56:09 - root - DEBUG - Line 3: 'D1' (conf: 0.999)
2025-07-11 19:56:09 - root - DEBUG - Line 4: '2' (conf: 0.960)
2025-07-11 19:56:09 - root - DEBUG - Line 5: 'D2' (conf: 1.000)
2025-07-11 19:56:09 - root - DEBUG - Line 6: '1.52cm' (conf: 1.000)
2025-07-11 19:56:09 - root - DEBUG - Line 7: '3' (conf: 0.979)
2025-07-11 19:56:09 - root - DEBUG - Line 8: 'D3' (conf: 1.000)
2025-07-11 19:56:09 - root - DEBUG - Line 9: '2.54cm' (conf: 1.000)
2025-07-11 19:56:09 - root - DEBUG - Line 10: 'Vol 5.923cm' (conf: 0.998)
2025-07-11 19:56:09 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:09 - root - DEBUG - Number of text lines detected: 10
2025-07-11 19:56:09 - root - DEBUG - Text extraction completed - Lines processed: 10
2025-07-11 19:56:09 - root - DEBUG - Combined text: '2.93cm 1 d1 2 d2 1.52cm 3 d3 2.54cm vol 5.923cm'
2025-07-11 19:56:09 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:09 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:09 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:09 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:09 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:09 - root - DEBUG - Pattern 1 matches: 4
2025-07-11 19:56:09 - root - DEBUG - Pattern 1 found matches: ['2.93cm', '1.52cm', '2.54cm', '5.923cm']
2025-07-11 19:56:09 - root - DEBUG - Pattern 2 matches: 3
2025-07-11 19:56:09 - root - DEBUG - Pattern 2 found matches: ['d1', 'd2', 'vol']
2025-07-11 19:56:09 - root - DEBUG - Base score from pattern matching: 7
2025-07-11 19:56:09 - root - DEBUG - 'cm' occurrences: 4, bonus added: 8
2025-07-11 19:56:09 - root - DEBUG - 'vol' occurrences: 1, bonus added: 2
2025-07-11 19:56:09 - root - INFO - Final measurement score: 17
2025-07-11 19:56:09 - root - DEBUG - Line 1: '2' (conf: 0.765)
2025-07-11 19:56:09 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:09 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:09 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:09 - root - DEBUG - Combined text: '2'
2025-07-11 19:56:09 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:09 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:09 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:09 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:09 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:09 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:09 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:09 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:09 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:09 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:09 - root - INFO - Final measurement score: 0
2025-07-11 19:56:10 - root - DEBUG - Line 1: 'E2' (conf: 0.914)
2025-07-11 19:56:10 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:10 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:10 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:10 - root - DEBUG - Combined text: 'e2'
2025-07-11 19:56:10 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:10 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:10 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:10 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:10 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:10 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:10 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:10 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:10 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:10 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:10 - root - INFO - Final measurement score: 0
2025-07-11 19:56:11 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-11 19:56:11 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-11 19:56:11 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-11 19:56:11 - root - DEBUG - Rank 1: Index 0, Score 17.000000
2025-07-11 19:56:11 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-11 19:56:11 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-11 19:56:11 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-11 19:56:11 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-11 19:56:11 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-11 19:56:11 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-11 19:56:11 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-11 19:56:11 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-11 19:56:11 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-11 19:56:11 - root - INFO - Best candidate meets threshold (>= 4). Score: 17.000000
2025-07-11 19:56:11 - root - DEBUG - All top 10 scores:
2025-07-11 19:56:11 - root - DEBUG - Score index 0: 17.000000
2025-07-11 19:56:11 - root - DEBUG - Score index 1: 0.000000
2025-07-11 19:56:11 - root - DEBUG - Score index 2: 0.000000
2025-07-11 19:56:11 - root - DEBUG - Score index 3: 0.000000
2025-07-11 19:56:11 - root - DEBUG - Score index 4: 0.000000
2025-07-11 19:56:11 - root - DEBUG - Score index 5: 0.000000
2025-07-11 19:56:11 - root - DEBUG - Score index 6: 0.000000
2025-07-11 19:56:11 - root - DEBUG - Score index 7: 0.000000
2025-07-11 19:56:11 - root - DEBUG - Score index 8: 0.000000
2025-07-11 19:56:11 - root - DEBUG - Score index 9: 0.000000
2025-07-11 19:56:11 - root - INFO - Measurement table detection completed successfully
2025-07-11 19:56:11 - root - DEBUG - Table detection completed. Candidates found: 235
2025-07-11 19:56:11 - root - INFO - Identifying organ name from the image
2025-07-11 19:56:11 - root - INFO - Starting organ name identification
2025-07-11 19:56:11 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:56:11 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-11 19:56:11 - root - INFO - Starting organ label identification
2025-07-11 19:56:11 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-11 19:56:11 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-11 19:56:13 - root - DEBUG - Line 1: '64%21Hz' (conf: 0.946)
2025-07-11 19:56:13 - root - DEBUG - Line 2: 'Abdomen' (conf: 0.993)
2025-07-11 19:56:13 - root - DEBUG - Line 3: 'Voluson' (conf: 1.000)
2025-07-11 19:56:13 - root - DEBUG - Line 4: 'Voluson' (conf: 0.999)
2025-07-11 19:56:13 - root - DEBUG - Line 5: '58' (conf: 0.967)
2025-07-11 19:56:13 - root - DEBUG - Line 6: '58' (conf: 0.988)
2025-07-11 19:56:13 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.963)
2025-07-11 19:56:13 - root - DEBUG - Line 8: 'A0 100%' (conf: 0.993)
2025-07-11 19:56:13 - root - DEBUG - Line 9: 'Gn -19' (conf: 0.995)
2025-07-11 19:56:13 - root - DEBUG - Line 10: 'C6/M4' (conf: 0.992)
2025-07-11 19:56:13 - root - DEBUG - Line 11: 'FF1 / E2' (conf: 0.990)
2025-07-11 19:56:13 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.928)
2025-07-11 19:56:13 - root - DEBUG - Line 13: 'LT OVARY' (conf: 0.996)
2025-07-11 19:56:13 - root - DEBUG - Line 14: '1' (conf: 0.745)
2025-07-11 19:56:13 - root - DEBUG - Line 15: 'D1' (conf: 0.996)
2025-07-11 19:56:13 - root - DEBUG - Line 16: '2.93cm' (conf: 1.000)
2025-07-11 19:56:13 - root - DEBUG - Line 17: '7' (conf: 0.630)
2025-07-11 19:56:13 - root - DEBUG - Line 18: 'D2' (conf: 0.999)
2025-07-11 19:56:13 - root - DEBUG - Line 19: '1.52cm' (conf: 1.000)
2025-07-11 19:56:13 - root - DEBUG - Line 20: 'D3' (conf: 1.000)
2025-07-11 19:56:13 - root - DEBUG - Line 21: '2.54cm' (conf: 0.925)
2025-07-11 19:56:13 - root - DEBUG - Line 22: '3' (conf: 0.996)
2025-07-11 19:56:13 - root - DEBUG - Line 23: 'Vol 5.923cm3' (conf: 0.961)
2025-07-11 19:56:13 - root - DEBUG - OCR completed. Processing 23 text lines for organ keywords
2025-07-11 19:56:13 - root - DEBUG - Line 0 text: '64%21Hz'
2025-07-11 19:56:13 - root - DEBUG - Line 1 text: 'Abdomen'
2025-07-11 19:56:13 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-11 19:56:13 - root - DEBUG - Line 3 text: 'Voluson'
2025-07-11 19:56:13 - root - DEBUG - Line 4 text: '58'
2025-07-11 19:56:13 - root - DEBUG - Line 5 text: '58'
2025-07-11 19:56:13 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-11 19:56:13 - root - DEBUG - Line 7 text: 'A0 100%'
2025-07-11 19:56:13 - root - DEBUG - Line 8 text: 'Gn -19'
2025-07-11 19:56:13 - root - DEBUG - Line 9 text: 'C6/M4'
2025-07-11 19:56:13 - root - DEBUG - Line 10 text: 'FF1 / E2'
2025-07-11 19:56:13 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-11 19:56:13 - root - DEBUG - Line 12 text: 'LT OVARY'
2025-07-11 19:56:13 - root - DEBUG - Line 13 text: '1'
2025-07-11 19:56:13 - root - DEBUG - Line 14 text: 'D1'
2025-07-11 19:56:13 - root - DEBUG - Line 15 text: '2.93cm'
2025-07-11 19:56:13 - root - DEBUG - Line 16 text: '7'
2025-07-11 19:56:13 - root - DEBUG - Line 17 text: 'D2'
2025-07-11 19:56:13 - root - DEBUG - Line 18 text: '1.52cm'
2025-07-11 19:56:13 - root - DEBUG - Line 19 text: 'D3'
2025-07-11 19:56:13 - root - DEBUG - Line 20 text: '2.54cm'
2025-07-11 19:56:13 - root - DEBUG - Line 21 text: '3'
2025-07-11 19:56:13 - root - DEBUG - Line 22 text: 'Vol 5.923cm3'
2025-07-11 19:56:13 - root - DEBUG - Combined text for keyword search: '64%21hz abdomen voluson voluson 58 58 hm pi 7.70 - 2.10 a0 100% gn -19 c6/m4 ff1 / e2 sri ii 2 / cri 2 lt ovary 1 d1 2.93cm 7 d2 1.52cm d3 2.54cm 3 vol 5.923cm3'
2025-07-11 19:56:13 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-11 19:56:13 - root - DEBUG - Found organ keyword: 'lt ovary'
2025-07-11 19:56:13 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-11 19:56:13 - root - INFO - Identified organs: ['lt ovary']
2025-07-11 19:56:13 - root - INFO - Organ identification completed successfully: ['lt ovary']
2025-07-11 19:56:13 - root - DEBUG - Organ identified: ['lt ovary']
2025-07-11 19:56:13 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-11 19:56:13 - root - DEBUG - Number of scored candidates: 10
2025-07-11 19:56:13 - root - DEBUG - Best score index: 0
2025-07-11 19:56:13 - root - INFO - Extracting structured data from detected table
2025-07-11 19:56:13 - root - INFO - Starting table content extraction
2025-07-11 19:56:13 - root - DEBUG - Bounding box coordinates: (3019, 2008, 385, 296)
2025-07-11 19:56:13 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-11 19:56:13 - root - DEBUG - Delegating to content extractor for table processing
2025-07-11 19:56:13 - root - INFO - Starting table content extraction
2025-07-11 19:56:13 - root - DEBUG - Bounding box coordinates: (3019, 2008, 385, 296)
2025-07-11 19:56:24 - root - INFO - Performing OCR on extracted table region
2025-07-11 19:56:25 - root - DEBUG - Line 1: '2.93cm' (conf: 1.000)
2025-07-11 19:56:25 - root - DEBUG - Line 2: '1' (conf: 0.831)
2025-07-11 19:56:25 - root - DEBUG - Line 3: 'D1' (conf: 0.999)
2025-07-11 19:56:25 - root - DEBUG - Line 4: '2' (conf: 0.960)
2025-07-11 19:56:25 - root - DEBUG - Line 5: 'D2' (conf: 1.000)
2025-07-11 19:56:25 - root - DEBUG - Line 6: '1.52cm' (conf: 1.000)
2025-07-11 19:56:25 - root - DEBUG - Line 7: '3' (conf: 0.979)
2025-07-11 19:56:25 - root - DEBUG - Line 8: 'D3' (conf: 1.000)
2025-07-11 19:56:25 - root - DEBUG - Line 9: '2.54cm' (conf: 1.000)
2025-07-11 19:56:25 - root - DEBUG - Line 10: 'Vol 5.923cm' (conf: 0.998)
2025-07-11 19:56:25 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-11 19:56:25 - root - INFO - Extracted 10 text elements from table region
2025-07-11 19:56:25 - root - INFO - Structuring extracted text data
2025-07-11 19:56:25 - root - INFO - Starting table data structuring
2025-07-11 19:56:25 - root - DEBUG - Element 1: text='2.93cm', x=301.00, y=42.00, conf=1.000
2025-07-11 19:56:25 - root - DEBUG - Element 2: text='1', x=36.00, y=49.00, conf=0.831
2025-07-11 19:56:25 - root - DEBUG - Element 3: text='D1', x=110.00, y=41.50, conf=0.999
2025-07-11 19:56:25 - root - DEBUG - Element 4: text='2', x=37.00, y=116.00, conf=0.960
2025-07-11 19:56:25 - root - DEBUG - Element 5: text='D2', x=110.50, y=111.50, conf=1.000
2025-07-11 19:56:25 - root - DEBUG - Element 6: text='1.52cm', x=301.50, y=111.50, conf=1.000
2025-07-11 19:56:25 - root - DEBUG - Element 7: text='3', x=36.00, y=182.50, conf=0.979
2025-07-11 19:56:25 - root - DEBUG - Element 8: text='D3', x=110.00, y=181.50, conf=1.000
2025-07-11 19:56:25 - root - DEBUG - Element 9: text='2.54cm', x=301.50, y=182.00, conf=1.000
2025-07-11 19:56:25 - root - DEBUG - Element 10: text='Vol 5.923cm', x=228.50, y=247.50, conf=0.998
2025-07-11 19:56:25 - root - DEBUG - Processing element 1/10: 'D1' at (110.00, 41.50)
2025-07-11 19:56:25 - root - DEBUG - Processing element 2/10: '2.93cm' at (301.00, 42.00)
2025-07-11 19:56:25 - root - DEBUG - Processing element 3/10: '1' at (36.00, 49.00)
2025-07-11 19:56:25 - root - DEBUG - Processing element 4/10: 'D2' at (110.50, 111.50)
2025-07-11 19:56:25 - root - DEBUG - Processing element 5/10: '1.52cm' at (301.50, 111.50)
2025-07-11 19:56:25 - root - DEBUG - Processing element 6/10: '2' at (37.00, 116.00)
2025-07-11 19:56:25 - root - DEBUG - Processing element 7/10: 'D3' at (110.00, 181.50)
2025-07-11 19:56:25 - root - DEBUG - Processing element 8/10: '2.54cm' at (301.50, 182.00)
2025-07-11 19:56:25 - root - DEBUG - Processing element 9/10: '3' at (36.00, 182.50)
2025-07-11 19:56:25 - root - DEBUG - Processing element 10/10: 'Vol 5.923cm' at (228.50, 247.50)
2025-07-11 19:56:25 - root - INFO - Line grouping completed - Total lines: 4
2025-07-11 19:56:25 - root - DEBUG - Processing line 1/4 with 3 elements
2025-07-11 19:56:25 - root - DEBUG - Processing word 1/3: '1'
2025-07-11 19:56:25 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:25 - root - DEBUG - Input text: '1'
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 2 did not match
2025-07-11 19:56:25 - root - DEBUG - No patterns matched for text: '1'
2025-07-11 19:56:25 - root - INFO - Text split failed - no matching patterns found
2025-07-11 19:56:25 - root - DEBUG - Split measurement result: None
2025-07-11 19:56:25 - root - DEBUG - Processing word 2/3: 'D1'
2025-07-11 19:56:25 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:25 - root - DEBUG - Input text: 'D1'
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 2 did not match
2025-07-11 19:56:25 - root - DEBUG - No patterns matched for text: 'D1'
2025-07-11 19:56:25 - root - INFO - Text split failed - no matching patterns found
2025-07-11 19:56:25 - root - DEBUG - Split measurement result: None
2025-07-11 19:56:25 - root - DEBUG - Processing word 3/3: '2.93cm'
2025-07-11 19:56:25 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:25 - root - DEBUG - Input text: '2.93cm'
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 2 did not match
2025-07-11 19:56:25 - root - DEBUG - No patterns matched for text: '2.93cm'
2025-07-11 19:56:25 - root - INFO - Text split failed - no matching patterns found
2025-07-11 19:56:25 - root - DEBUG - Split measurement result: None
2025-07-11 19:56:25 - root - DEBUG - Processing line 2/4 with 3 elements
2025-07-11 19:56:25 - root - DEBUG - Processing word 1/3: '2'
2025-07-11 19:56:25 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:25 - root - DEBUG - Input text: '2'
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 2 did not match
2025-07-11 19:56:25 - root - DEBUG - No patterns matched for text: '2'
2025-07-11 19:56:25 - root - INFO - Text split failed - no matching patterns found
2025-07-11 19:56:25 - root - DEBUG - Split measurement result: None
2025-07-11 19:56:25 - root - DEBUG - Processing word 2/3: 'D2'
2025-07-11 19:56:25 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:25 - root - DEBUG - Input text: 'D2'
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 2 did not match
2025-07-11 19:56:25 - root - DEBUG - No patterns matched for text: 'D2'
2025-07-11 19:56:25 - root - INFO - Text split failed - no matching patterns found
2025-07-11 19:56:25 - root - DEBUG - Split measurement result: None
2025-07-11 19:56:25 - root - DEBUG - Processing word 3/3: '1.52cm'
2025-07-11 19:56:25 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:25 - root - DEBUG - Input text: '1.52cm'
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 2 did not match
2025-07-11 19:56:25 - root - DEBUG - No patterns matched for text: '1.52cm'
2025-07-11 19:56:25 - root - INFO - Text split failed - no matching patterns found
2025-07-11 19:56:25 - root - DEBUG - Split measurement result: None
2025-07-11 19:56:25 - root - DEBUG - Processing line 3/4 with 3 elements
2025-07-11 19:56:25 - root - DEBUG - Processing word 1/3: '3'
2025-07-11 19:56:25 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:25 - root - DEBUG - Input text: '3'
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 2 did not match
2025-07-11 19:56:25 - root - DEBUG - No patterns matched for text: '3'
2025-07-11 19:56:25 - root - INFO - Text split failed - no matching patterns found
2025-07-11 19:56:25 - root - DEBUG - Split measurement result: None
2025-07-11 19:56:25 - root - DEBUG - Processing word 2/3: 'D3'
2025-07-11 19:56:25 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:25 - root - DEBUG - Input text: 'D3'
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 2 did not match
2025-07-11 19:56:25 - root - DEBUG - No patterns matched for text: 'D3'
2025-07-11 19:56:25 - root - INFO - Text split failed - no matching patterns found
2025-07-11 19:56:25 - root - DEBUG - Split measurement result: None
2025-07-11 19:56:25 - root - DEBUG - Processing word 3/3: '2.54cm'
2025-07-11 19:56:25 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:25 - root - DEBUG - Input text: '2.54cm'
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 2 did not match
2025-07-11 19:56:25 - root - DEBUG - No patterns matched for text: '2.54cm'
2025-07-11 19:56:25 - root - INFO - Text split failed - no matching patterns found
2025-07-11 19:56:25 - root - DEBUG - Split measurement result: None
2025-07-11 19:56:25 - root - DEBUG - Processing line 4/4 with 1 elements
2025-07-11 19:56:25 - root - DEBUG - Processing word 1/1: 'Vol 5.923cm'
2025-07-11 19:56:25 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:25 - root - DEBUG - Input text: 'Vol 5.923cm'
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:56:25 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:25 - root - DEBUG - Pattern 2 matched successfully
2025-07-11 19:56:25 - root - DEBUG - Pattern 2 groups: ('Vol', '5.923cm')
2025-07-11 19:56:25 - root - DEBUG - Pattern 2 result: ('Vol', '5.923cm')
2025-07-11 19:56:25 - root - INFO - Text split successful using pattern 2: ('Vol', '5.923cm')
2025-07-11 19:56:25 - root - DEBUG - Split measurement result: ('Vol', '5.923cm')
2025-07-11 19:56:25 - root - DEBUG - Final structured data:
2025-07-11 19:56:25 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D1', '2.93cm']}'
2025-07-11 19:56:25 - root - DEBUG - Item 2 (text): '{'Value2': ['2', 'D2', '1.52cm']}'
2025-07-11 19:56:25 - root - DEBUG - Item 3 (text): '{'Value3': ['3', 'D3', '2.54cm']}'
2025-07-11 19:56:25 - root - DEBUG - Item 4 (text): '{'Value4': ['Vol', '5.923cm']}'
2025-07-11 19:56:25 - root - INFO - Table content extraction completed successfully
2025-07-11 19:56:25 - root - DEBUG - Structured data keys: [{'organLabel': ['lt ovary']}, {'Value1': ['1', 'D1', '2.93cm']}, {'Value2': ['2', 'D2', '1.52cm']}, {'Value3': ['3', 'D3', '2.54cm']}, {'Value4': ['Vol', '5.923cm']}]
2025-07-11 19:56:25 - root - DEBUG - Organ identified: ['lt ovary']
2025-07-11 19:56:25 - root - INFO - Table extraction successful for file: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000080_20250417_103454
2025-07-11 19:56:25 - root - INFO - Organ identified: ['lt ovary']
2025-07-11 19:56:25 - root - DEBUG - Structured data extracted: [{'organLabel': ['lt ovary']}, {'Value1': ['1', 'D1', '2.93cm']}, {'Value2': ['2', 'D2', '1.52cm']}, {'Value3': ['3', 'D3', '2.54cm']}, {'Value4': ['Vol', '5.923cm']}]
2025-07-11 19:56:25 - root - DEBUG - Displaying cropped image
2025-07-11 19:56:25 - root - INFO - Displaying image in OpenCV window: DICOM Image
2025-07-11 19:56:25 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:56:25 - root - DEBUG - Image data type: uint8
2025-07-11 19:56:25 - root - DEBUG - Creating OpenCV window and displaying image
2025-07-11 19:56:25 - root - INFO - Image displayed successfully
2025-07-11 19:56:25 - root - DEBUG - Waiting for user input (key press)
2025-07-11 19:56:26 - root - DEBUG - Destroying OpenCV windows
2025-07-11 19:56:26 - root - INFO - Image display completed and windows closed
2025-07-11 19:56:26 - root - INFO - Processing DICOM file 8/11: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000090_20250417_103454
2025-07-11 19:56:26 - root - DEBUG - Converting DICOM to PNG format
2025-07-11 19:56:26 - root - INFO - Starting DICOM to PNG conversion: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000090_20250417_103454
2025-07-11 19:56:26 - root - DEBUG - Reading DICOM file with pydicom
2025-07-11 19:56:26 - root - INFO - DICOM file loaded successfully
2025-07-11 19:56:26 - root - DEBUG - Original photometric interpretation: RGB
2025-07-11 19:56:26 - root - INFO - Processing RGB format DICOM
2025-07-11 19:56:26 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-11 19:56:26 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-11 19:56:26 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-11 19:56:26 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-11 19:56:26 - root - DEBUG - Cropping ultrasound image area
2025-07-11 19:56:26 - root - DEBUG - Initializing USRegionLocation detector
2025-07-11 19:56:26 - root - INFO - Getting ultrasound region coordinates
2025-07-11 19:56:26 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-11 19:56:26 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:56:26 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-11 19:56:26 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-11 19:56:26 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-11 19:56:26 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-11 19:56:26 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:56:26 - root - INFO - Analyzing cropped image for measurement tables
2025-07-11 19:56:26 - root - INFO - Starting table detection in ultrasound image
2025-07-11 19:56:26 - root - INFO - Initializing UltrasoundTableDetector
2025-07-11 19:56:26 - root - INFO - Initializing OCRHandler
2025-07-11 19:56:26 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-11 19:56:26 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-11 19:56:26 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-11 19:56:26 - root - DEBUG - - lang: 'en' (English language)
2025-07-11 19:56:26 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-11 19:56:26 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-11 19:56:26 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-11 19:56:26 - root - INFO - OCRHandler initialized successfully
2025-07-11 19:56:26 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-11 19:56:26 - root - INFO - Initializing TableDetector
2025-07-11 19:56:26 - root - DEBUG - TableDetector instance created successfully
2025-07-11 19:56:26 - root - DEBUG - Default detection parameters:
2025-07-11 19:56:26 - root - DEBUG - - Image upscale factor: 3x
2025-07-11 19:56:26 - root - DEBUG - - Edge threshold: 50
2025-07-11 19:56:26 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-11 19:56:26 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-11 19:56:26 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-11 19:56:26 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-11 19:56:26 - root - INFO - TableDetector initialization completed
2025-07-11 19:56:26 - root - INFO - Initializing TextAnalyzer
2025-07-11 19:56:26 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-11 19:56:26 - root - DEBUG - Text analysis configuration:
2025-07-11 19:56:26 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-11 19:56:26 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-11 19:56:26 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-11 19:56:26 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-11 19:56:26 - root - INFO - TextAnalyzer initialization completed
2025-07-11 19:56:26 - root - INFO - Initializing ContentExtractor
2025-07-11 19:56:26 - root - INFO - ContentExtractor initialized successfully
2025-07-11 19:56:26 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-11 19:56:26 - root - INFO - Detecting measurement tables in the image
2025-07-11 19:56:26 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-11 19:56:26 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-11 19:56:26 - root - DEBUG - Converting upscaled image to grayscale
2025-07-11 19:56:26 - root - DEBUG - Grayscale conversion completed
2025-07-11 19:56:26 - root - INFO - Applying edge detection to grayscale image
2025-07-11 19:56:26 - root - DEBUG - Edge detection completed
2025-07-11 19:56:26 - root - DEBUG - Applying threshold to create binary image
2025-07-11 19:56:26 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 601096
2025-07-11 19:56:26 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-11 19:56:26 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-11 19:56:26 - root - INFO - Enhancing horizontal and vertical lines
2025-07-11 19:56:26 - root - DEBUG - Line enhancement completed
2025-07-11 19:56:26 - root - DEBUG - Applying dilation to make lines thicker
2025-07-11 19:56:26 - root - DEBUG - Line thickening completed
2025-07-11 19:56:26 - root - DEBUG - Combining horizontal and vertical lines
2025-07-11 19:56:26 - root - DEBUG - Line combination completed
2025-07-11 19:56:26 - root - DEBUG - Created copy for contour visualization
2025-07-11 19:56:26 - root - INFO - Finding contours in enhanced lines
2025-07-11 19:56:26 - root - INFO - Found 1062 contours
2025-07-11 19:56:26 - root - DEBUG - Drawing contours for visualization
2025-07-11 19:56:26 - root - DEBUG - Contours drawn successfully
2025-07-11 19:56:26 - root - INFO - Processing contours to find rectangular regions
2025-07-11 19:56:26 - root - INFO - Rectangular region detection completed
2025-07-11 19:56:26 - root - INFO - Total candidate regions found: 381
2025-07-11 19:56:26 - root - DEBUG - Found 381 candidate regions
2025-07-11 19:56:26 - root - INFO - Processing candidate regions for measurement content
2025-07-11 19:56:26 - root - DEBUG - Line 1: '60' (conf: 0.695)
2025-07-11 19:56:26 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:26 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:26 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:26 - root - DEBUG - Combined text: '60'
2025-07-11 19:56:26 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:26 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:26 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:26 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:26 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:26 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:26 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:26 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:26 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:26 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:26 - root - INFO - Final measurement score: 0
2025-07-11 19:56:27 - root - DEBUG - Line 1: '1 D 1.65cm' (conf: 0.998)
2025-07-11 19:56:27 - root - DEBUG - Line 2: '2 l' (conf: 0.834)
2025-07-11 19:56:27 - root - DEBUG - Line 3: 'D 1.56cm' (conf: 1.000)
2025-07-11 19:56:27 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:27 - root - DEBUG - Number of text lines detected: 3
2025-07-11 19:56:27 - root - DEBUG - Text extraction completed - Lines processed: 3
2025-07-11 19:56:27 - root - DEBUG - Combined text: '1 d 1.65cm 2 l d 1.56cm'
2025-07-11 19:56:27 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:27 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:27 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:27 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:27 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:27 - root - DEBUG - Pattern 1 matches: 2
2025-07-11 19:56:27 - root - DEBUG - Pattern 1 found matches: ['1.65cm', '1.56cm']
2025-07-11 19:56:27 - root - DEBUG - Pattern 2 matches: 3
2025-07-11 19:56:27 - root - DEBUG - Pattern 2 found matches: ['d', 'l', 'd']
2025-07-11 19:56:27 - root - DEBUG - Base score from pattern matching: 5
2025-07-11 19:56:27 - root - DEBUG - 'cm' occurrences: 2, bonus added: 4
2025-07-11 19:56:27 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:27 - root - INFO - Final measurement score: 9
2025-07-11 19:56:29 - root - DEBUG - Line 1: 'E2' (conf: 0.914)
2025-07-11 19:56:29 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:29 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:29 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:29 - root - DEBUG - Combined text: 'e2'
2025-07-11 19:56:29 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:29 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:29 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:29 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:29 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:29 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:29 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:29 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:29 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:29 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:29 - root - INFO - Final measurement score: 0
2025-07-11 19:56:29 - root - DEBUG - Line 1: 'HMI' (conf: 0.890)
2025-07-11 19:56:29 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:29 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:29 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:29 - root - DEBUG - Combined text: 'hmi'
2025-07-11 19:56:29 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:29 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:29 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:29 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:29 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:29 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:29 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:29 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:29 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:29 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:29 - root - INFO - Final measurement score: 0
2025-07-11 19:56:29 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-11 19:56:29 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-11 19:56:29 - root - DEBUG - Top 10 score indices: [6, 0, 1, 2, 3, 4, 5, 7, 8, 9]
2025-07-11 19:56:29 - root - DEBUG - Rank 1: Index 6, Score 9.000000
2025-07-11 19:56:29 - root - DEBUG - Rank 2: Index 0, Score 0.000000
2025-07-11 19:56:29 - root - DEBUG - Rank 3: Index 1, Score 0.000000
2025-07-11 19:56:29 - root - DEBUG - Rank 4: Index 2, Score 0.000000
2025-07-11 19:56:29 - root - DEBUG - Rank 5: Index 3, Score 0.000000
2025-07-11 19:56:29 - root - DEBUG - Rank 6: Index 4, Score 0.000000
2025-07-11 19:56:29 - root - DEBUG - Rank 7: Index 5, Score 0.000000
2025-07-11 19:56:29 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-11 19:56:29 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-11 19:56:29 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-11 19:56:29 - root - INFO - Best candidate meets threshold (>= 4). Score: 9.000000
2025-07-11 19:56:29 - root - DEBUG - All top 10 scores:
2025-07-11 19:56:29 - root - DEBUG - Score index 6: 9.000000
2025-07-11 19:56:29 - root - DEBUG - Score index 0: 0.000000
2025-07-11 19:56:29 - root - DEBUG - Score index 1: 0.000000
2025-07-11 19:56:29 - root - DEBUG - Score index 2: 0.000000
2025-07-11 19:56:29 - root - DEBUG - Score index 3: 0.000000
2025-07-11 19:56:29 - root - DEBUG - Score index 4: 0.000000
2025-07-11 19:56:29 - root - DEBUG - Score index 5: 0.000000
2025-07-11 19:56:29 - root - DEBUG - Score index 7: 0.000000
2025-07-11 19:56:29 - root - DEBUG - Score index 8: 0.000000
2025-07-11 19:56:29 - root - DEBUG - Score index 9: 0.000000
2025-07-11 19:56:29 - root - INFO - Measurement table detection completed successfully
2025-07-11 19:56:29 - root - DEBUG - Table detection completed. Candidates found: 381
2025-07-11 19:56:29 - root - INFO - Identifying organ name from the image
2025-07-11 19:56:29 - root - INFO - Starting organ name identification
2025-07-11 19:56:29 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:56:29 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-11 19:56:29 - root - INFO - Starting organ label identification
2025-07-11 19:56:29 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-11 19:56:29 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-11 19:56:31 - root - DEBUG - Line 1: '64%21Hz' (conf: 0.946)
2025-07-11 19:56:31 - root - DEBUG - Line 2: 'Abdomen' (conf: 0.998)
2025-07-11 19:56:31 - root - DEBUG - Line 3: 'Voluson' (conf: 1.000)
2025-07-11 19:56:31 - root - DEBUG - Line 4: 'Voluson' (conf: 0.999)
2025-07-11 19:56:31 - root - DEBUG - Line 5: '58' (conf: 0.967)
2025-07-11 19:56:31 - root - DEBUG - Line 6: '58' (conf: 0.988)
2025-07-11 19:56:31 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.958)
2025-07-11 19:56:31 - root - DEBUG - Line 8: 'A0 100%' (conf: 0.993)
2025-07-11 19:56:31 - root - DEBUG - Line 9: 'Gn -19' (conf: 0.983)
2025-07-11 19:56:31 - root - DEBUG - Line 10: 'C6/M4' (conf: 0.990)
2025-07-11 19:56:31 - root - DEBUG - Line 11: 'FF1 / E2' (conf: 0.988)
2025-07-11 19:56:31 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.976)
2025-07-11 19:56:31 - root - DEBUG - Line 13: 'D 1.65cm' (conf: 0.999)
2025-07-11 19:56:31 - root - DEBUG - Line 14: '2 D 1.56cm' (conf: 0.998)
2025-07-11 19:56:31 - root - DEBUG - OCR completed. Processing 14 text lines for organ keywords
2025-07-11 19:56:31 - root - DEBUG - Line 0 text: '64%21Hz'
2025-07-11 19:56:31 - root - DEBUG - Line 1 text: 'Abdomen'
2025-07-11 19:56:31 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-11 19:56:31 - root - DEBUG - Line 3 text: 'Voluson'
2025-07-11 19:56:31 - root - DEBUG - Line 4 text: '58'
2025-07-11 19:56:31 - root - DEBUG - Line 5 text: '58'
2025-07-11 19:56:31 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-11 19:56:31 - root - DEBUG - Line 7 text: 'A0 100%'
2025-07-11 19:56:31 - root - DEBUG - Line 8 text: 'Gn -19'
2025-07-11 19:56:31 - root - DEBUG - Line 9 text: 'C6/M4'
2025-07-11 19:56:31 - root - DEBUG - Line 10 text: 'FF1 / E2'
2025-07-11 19:56:31 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-11 19:56:31 - root - DEBUG - Line 12 text: 'D 1.65cm'
2025-07-11 19:56:31 - root - DEBUG - Line 13 text: '2 D 1.56cm'
2025-07-11 19:56:31 - root - DEBUG - Combined text for keyword search: '64%21hz abdomen voluson voluson 58 58 hm pi 7.70 - 2.10 a0 100% gn -19 c6/m4 ff1 / e2 sri ii 2 / cri 2 d 1.65cm 2 d 1.56cm'
2025-07-11 19:56:31 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-11 19:56:31 - root - INFO - Organ identification completed. Found 0 organ keywords
2025-07-11 19:56:31 - root - INFO - Identified organs: []
2025-07-11 19:56:31 - root - WARNING - No organ name identified from the image
2025-07-11 19:56:31 - root - DEBUG - Organ identified: []
2025-07-11 19:56:31 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-11 19:56:31 - root - DEBUG - Number of scored candidates: 10
2025-07-11 19:56:31 - root - DEBUG - Best score index: 6
2025-07-11 19:56:31 - root - INFO - Extracting structured data from detected table
2025-07-11 19:56:31 - root - INFO - Starting table content extraction
2025-07-11 19:56:31 - root - DEBUG - Bounding box coordinates: (3109, 2141, 295, 162)
2025-07-11 19:56:31 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-11 19:56:31 - root - DEBUG - Delegating to content extractor for table processing
2025-07-11 19:56:31 - root - INFO - Starting table content extraction
2025-07-11 19:56:31 - root - DEBUG - Bounding box coordinates: (3109, 2141, 295, 162)
2025-07-11 19:56:32 - root - INFO - Performing OCR on extracted table region
2025-07-11 19:56:32 - root - DEBUG - Line 1: '1 D 1.65cm' (conf: 0.998)
2025-07-11 19:56:32 - root - DEBUG - Line 2: '2 l' (conf: 0.834)
2025-07-11 19:56:32 - root - DEBUG - Line 3: 'D 1.56cm' (conf: 1.000)
2025-07-11 19:56:32 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-11 19:56:32 - root - INFO - Extracted 3 text elements from table region
2025-07-11 19:56:32 - root - INFO - Structuring extracted text data
2025-07-11 19:56:32 - root - INFO - Starting table data structuring
2025-07-11 19:56:32 - root - DEBUG - Element 1: text='1 D 1.65cm', x=154.50, y=43.00, conf=0.998
2025-07-11 19:56:32 - root - DEBUG - Element 2: text='2 l', x=53.50, y=129.50, conf=0.834
2025-07-11 19:56:32 - root - DEBUG - Element 3: text='D 1.56cm', x=182.00, y=125.50, conf=1.000
2025-07-11 19:56:32 - root - DEBUG - Processing element 1/3: '1 D 1.65cm' at (154.50, 43.00)
2025-07-11 19:56:32 - root - DEBUG - Processing element 2/3: 'D 1.56cm' at (182.00, 125.50)
2025-07-11 19:56:32 - root - DEBUG - Processing element 3/3: '2 l' at (53.50, 129.50)
2025-07-11 19:56:32 - root - INFO - Line grouping completed - Total lines: 2
2025-07-11 19:56:32 - root - DEBUG - Processing line 1/2 with 1 elements
2025-07-11 19:56:32 - root - DEBUG - Processing word 1/1: '1 D 1.65cm'
2025-07-11 19:56:32 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:32 - root - DEBUG - Input text: '1 D 1.65cm'
2025-07-11 19:56:32 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:32 - root - DEBUG - Pattern 1 matched successfully
2025-07-11 19:56:32 - root - DEBUG - Pattern 1 groups: ('1', 'D', '1.65cm')
2025-07-11 19:56:32 - root - DEBUG - Pattern 1 result: ('1', 'D', '1.65cm')
2025-07-11 19:56:32 - root - INFO - Text split successful using pattern 1: ('1', 'D', '1.65cm')
2025-07-11 19:56:32 - root - DEBUG - Split measurement result: ('1', 'D', '1.65cm')
2025-07-11 19:56:32 - root - DEBUG - Processing line 2/2 with 2 elements
2025-07-11 19:56:32 - root - DEBUG - Processing word 1/2: '2 l'
2025-07-11 19:56:32 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:32 - root - DEBUG - Input text: '2 l'
2025-07-11 19:56:32 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:32 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:56:32 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:32 - root - DEBUG - Pattern 2 did not match
2025-07-11 19:56:32 - root - DEBUG - No patterns matched for text: '2 l'
2025-07-11 19:56:32 - root - INFO - Text split failed - no matching patterns found
2025-07-11 19:56:32 - root - DEBUG - Split measurement result: None
2025-07-11 19:56:32 - root - DEBUG - Processing word 2/2: 'D 1.56cm'
2025-07-11 19:56:32 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:32 - root - DEBUG - Input text: 'D 1.56cm'
2025-07-11 19:56:32 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:32 - root - DEBUG - Pattern 1 did not match
2025-07-11 19:56:32 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:32 - root - DEBUG - Pattern 2 matched successfully
2025-07-11 19:56:32 - root - DEBUG - Pattern 2 groups: ('D', '1.56cm')
2025-07-11 19:56:32 - root - DEBUG - Pattern 2 result: ('D', '1.56cm')
2025-07-11 19:56:32 - root - INFO - Text split successful using pattern 2: ('D', '1.56cm')
2025-07-11 19:56:32 - root - DEBUG - Split measurement result: ('D', '1.56cm')
2025-07-11 19:56:32 - root - DEBUG - Final structured data:
2025-07-11 19:56:32 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D', '1.65cm']}'
2025-07-11 19:56:32 - root - DEBUG - Item 2 (text): '{'Value2': ['2 l', 'D', '1.56cm']}'
2025-07-11 19:56:32 - root - INFO - Table content extraction completed successfully
2025-07-11 19:56:32 - root - DEBUG - Structured data keys: [{'organLabel': []}, {'Value1': ['1', 'D', '1.65cm']}, {'Value2': ['2 l', 'D', '1.56cm']}]
2025-07-11 19:56:32 - root - DEBUG - Organ identified: []
2025-07-11 19:56:32 - root - INFO - Table extraction successful for file: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000090_20250417_103454
2025-07-11 19:56:32 - root - INFO - Organ identified: []
2025-07-11 19:56:32 - root - DEBUG - Structured data extracted: [{'organLabel': []}, {'Value1': ['1', 'D', '1.65cm']}, {'Value2': ['2 l', 'D', '1.56cm']}]
2025-07-11 19:56:32 - root - DEBUG - Displaying cropped image
2025-07-11 19:56:32 - root - INFO - Displaying image in OpenCV window: DICOM Image
2025-07-11 19:56:32 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:56:32 - root - DEBUG - Image data type: uint8
2025-07-11 19:56:32 - root - DEBUG - Creating OpenCV window and displaying image
2025-07-11 19:56:32 - root - INFO - Image displayed successfully
2025-07-11 19:56:32 - root - DEBUG - Waiting for user input (key press)
2025-07-11 19:56:40 - root - DEBUG - Destroying OpenCV windows
2025-07-11 19:56:40 - root - INFO - Image display completed and windows closed
2025-07-11 19:56:40 - root - INFO - Processing DICOM file 9/11: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000100_20250417_103454
2025-07-11 19:56:40 - root - DEBUG - Converting DICOM to PNG format
2025-07-11 19:56:40 - root - INFO - Starting DICOM to PNG conversion: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000100_20250417_103454
2025-07-11 19:56:40 - root - DEBUG - Reading DICOM file with pydicom
2025-07-11 19:56:40 - root - INFO - DICOM file loaded successfully
2025-07-11 19:56:40 - root - DEBUG - Original photometric interpretation: RGB
2025-07-11 19:56:40 - root - INFO - Processing RGB format DICOM
2025-07-11 19:56:40 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-11 19:56:40 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-11 19:56:40 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-11 19:56:40 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-11 19:56:40 - root - DEBUG - Cropping ultrasound image area
2025-07-11 19:56:40 - root - DEBUG - Initializing USRegionLocation detector
2025-07-11 19:56:40 - root - INFO - Getting ultrasound region coordinates
2025-07-11 19:56:40 - root - DEBUG - Raw coordinates - minx0: [0], miny0: [66], maxx1: [1136], maxy1: [852]
2025-07-11 19:56:40 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:56:40 - root - INFO - Single region detected, using direct coordinates
2025-07-11 19:56:40 - root - DEBUG - Single region bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-11 19:56:40 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-11 19:56:40 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-11 19:56:40 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:56:40 - root - INFO - Analyzing cropped image for measurement tables
2025-07-11 19:56:40 - root - INFO - Starting table detection in ultrasound image
2025-07-11 19:56:40 - root - INFO - Initializing UltrasoundTableDetector
2025-07-11 19:56:40 - root - INFO - Initializing OCRHandler
2025-07-11 19:56:40 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-11 19:56:40 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-11 19:56:40 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-11 19:56:40 - root - DEBUG - - lang: 'en' (English language)
2025-07-11 19:56:40 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-11 19:56:40 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-11 19:56:40 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-11 19:56:40 - root - INFO - OCRHandler initialized successfully
2025-07-11 19:56:40 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-11 19:56:40 - root - INFO - Initializing TableDetector
2025-07-11 19:56:40 - root - DEBUG - TableDetector instance created successfully
2025-07-11 19:56:40 - root - DEBUG - Default detection parameters:
2025-07-11 19:56:40 - root - DEBUG - - Image upscale factor: 3x
2025-07-11 19:56:40 - root - DEBUG - - Edge threshold: 50
2025-07-11 19:56:40 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-11 19:56:40 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-11 19:56:40 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-11 19:56:40 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-11 19:56:40 - root - INFO - TableDetector initialization completed
2025-07-11 19:56:40 - root - INFO - Initializing TextAnalyzer
2025-07-11 19:56:40 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-11 19:56:40 - root - DEBUG - Text analysis configuration:
2025-07-11 19:56:40 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-11 19:56:40 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-11 19:56:40 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-11 19:56:40 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-11 19:56:40 - root - INFO - TextAnalyzer initialization completed
2025-07-11 19:56:40 - root - INFO - Initializing ContentExtractor
2025-07-11 19:56:40 - root - INFO - ContentExtractor initialized successfully
2025-07-11 19:56:40 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-11 19:56:40 - root - INFO - Detecting measurement tables in the image
2025-07-11 19:56:40 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-11 19:56:40 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-11 19:56:40 - root - DEBUG - Converting upscaled image to grayscale
2025-07-11 19:56:40 - root - DEBUG - Grayscale conversion completed
2025-07-11 19:56:40 - root - INFO - Applying edge detection to grayscale image
2025-07-11 19:56:41 - root - DEBUG - Edge detection completed
2025-07-11 19:56:41 - root - DEBUG - Applying threshold to create binary image
2025-07-11 19:56:41 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 203485
2025-07-11 19:56:41 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-11 19:56:41 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-11 19:56:41 - root - INFO - Enhancing horizontal and vertical lines
2025-07-11 19:56:41 - root - DEBUG - Line enhancement completed
2025-07-11 19:56:41 - root - DEBUG - Applying dilation to make lines thicker
2025-07-11 19:56:41 - root - DEBUG - Line thickening completed
2025-07-11 19:56:41 - root - DEBUG - Combining horizontal and vertical lines
2025-07-11 19:56:41 - root - DEBUG - Line combination completed
2025-07-11 19:56:41 - root - DEBUG - Created copy for contour visualization
2025-07-11 19:56:41 - root - INFO - Finding contours in enhanced lines
2025-07-11 19:56:41 - root - INFO - Found 500 contours
2025-07-11 19:56:41 - root - DEBUG - Drawing contours for visualization
2025-07-11 19:56:41 - root - DEBUG - Contours drawn successfully
2025-07-11 19:56:41 - root - INFO - Processing contours to find rectangular regions
2025-07-11 19:56:41 - root - INFO - Rectangular region detection completed
2025-07-11 19:56:41 - root - INFO - Total candidate regions found: 63
2025-07-11 19:56:41 - root - DEBUG - Found 63 candidate regions
2025-07-11 19:56:41 - root - INFO - Processing candidate regions for measurement content
2025-07-11 19:56:41 - root - DEBUG - Line 1: '1 D 0.57cm' (conf: 0.997)
2025-07-11 19:56:41 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:41 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:41 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:41 - root - DEBUG - Combined text: '1 d 0.57cm'
2025-07-11 19:56:41 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:41 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:41 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:41 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:41 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:41 - root - DEBUG - Pattern 1 matches: 1
2025-07-11 19:56:41 - root - DEBUG - Pattern 1 found matches: ['0.57cm']
2025-07-11 19:56:41 - root - DEBUG - Pattern 2 matches: 1
2025-07-11 19:56:41 - root - DEBUG - Pattern 2 found matches: ['d']
2025-07-11 19:56:41 - root - DEBUG - Base score from pattern matching: 2
2025-07-11 19:56:41 - root - DEBUG - 'cm' occurrences: 1, bonus added: 2
2025-07-11 19:56:41 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:41 - root - INFO - Final measurement score: 4
2025-07-11 19:56:41 - root - DEBUG - Line 1: 'E2' (conf: 0.914)
2025-07-11 19:56:41 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:41 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:41 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:41 - root - DEBUG - Combined text: 'e2'
2025-07-11 19:56:41 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:41 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:41 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:41 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:41 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:41 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:41 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:41 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:41 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:41 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:41 - root - INFO - Final measurement score: 0
2025-07-11 19:56:41 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-11 19:56:41 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-11 19:56:41 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-11 19:56:41 - root - DEBUG - Rank 1: Index 0, Score 4.000000
2025-07-11 19:56:41 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-11 19:56:41 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-11 19:56:41 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-11 19:56:41 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-11 19:56:41 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-11 19:56:41 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-11 19:56:41 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-11 19:56:41 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-11 19:56:41 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-11 19:56:41 - root - INFO - Best candidate meets threshold (>= 4). Score: 4.000000
2025-07-11 19:56:41 - root - DEBUG - All top 10 scores:
2025-07-11 19:56:41 - root - DEBUG - Score index 0: 4.000000
2025-07-11 19:56:41 - root - DEBUG - Score index 1: 0.000000
2025-07-11 19:56:41 - root - DEBUG - Score index 2: 0.000000
2025-07-11 19:56:41 - root - DEBUG - Score index 3: 0.000000
2025-07-11 19:56:41 - root - DEBUG - Score index 4: 0.000000
2025-07-11 19:56:41 - root - DEBUG - Score index 5: 0.000000
2025-07-11 19:56:41 - root - DEBUG - Score index 6: 0.000000
2025-07-11 19:56:41 - root - DEBUG - Score index 7: 0.000000
2025-07-11 19:56:41 - root - DEBUG - Score index 8: 0.000000
2025-07-11 19:56:41 - root - DEBUG - Score index 9: 0.000000
2025-07-11 19:56:41 - root - INFO - Measurement table detection completed successfully
2025-07-11 19:56:41 - root - DEBUG - Table detection completed. Candidates found: 63
2025-07-11 19:56:41 - root - INFO - Identifying organ name from the image
2025-07-11 19:56:41 - root - INFO - Starting organ name identification
2025-07-11 19:56:41 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:56:41 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-11 19:56:41 - root - INFO - Starting organ label identification
2025-07-11 19:56:41 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-11 19:56:41 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-11 19:56:43 - root - DEBUG - Line 1: '64%21Hz' (conf: 0.946)
2025-07-11 19:56:43 - root - DEBUG - Line 2: 'Voluson' (conf: 0.999)
2025-07-11 19:56:43 - root - DEBUG - Line 3: 'Abdomen' (conf: 0.998)
2025-07-11 19:56:43 - root - DEBUG - Line 4: '58' (conf: 0.960)
2025-07-11 19:56:43 - root - DEBUG - Line 5: 'HM PI 7.70 - 2.10' (conf: 0.993)
2025-07-11 19:56:43 - root - DEBUG - Line 6: 'A0 100%' (conf: 0.984)
2025-07-11 19:56:43 - root - DEBUG - Line 7: 'Gn -20' (conf: 0.993)
2025-07-11 19:56:43 - root - DEBUG - Line 8: 'C6/ M4' (conf: 0.950)
2025-07-11 19:56:43 - root - DEBUG - Line 9: 'FF1 / E2' (conf: 0.998)
2025-07-11 19:56:43 - root - DEBUG - Line 10: 'SRI II 2 / CRI 2' (conf: 0.984)
2025-07-11 19:56:43 - root - DEBUG - Line 11: '--' (conf: 0.836)
2025-07-11 19:56:43 - root - DEBUG - Line 12: '1 D 0.57cm' (conf: 0.999)
2025-07-11 19:56:43 - root - DEBUG - OCR completed. Processing 12 text lines for organ keywords
2025-07-11 19:56:43 - root - DEBUG - Line 0 text: '64%21Hz'
2025-07-11 19:56:43 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-11 19:56:43 - root - DEBUG - Line 2 text: 'Abdomen'
2025-07-11 19:56:43 - root - DEBUG - Line 3 text: '58'
2025-07-11 19:56:43 - root - DEBUG - Line 4 text: 'HM PI 7.70 - 2.10'
2025-07-11 19:56:43 - root - DEBUG - Line 5 text: 'A0 100%'
2025-07-11 19:56:43 - root - DEBUG - Line 6 text: 'Gn -20'
2025-07-11 19:56:43 - root - DEBUG - Line 7 text: 'C6/ M4'
2025-07-11 19:56:43 - root - DEBUG - Line 8 text: 'FF1 / E2'
2025-07-11 19:56:43 - root - DEBUG - Line 9 text: 'SRI II 2 / CRI 2'
2025-07-11 19:56:43 - root - DEBUG - Line 10 text: '--'
2025-07-11 19:56:43 - root - DEBUG - Line 11 text: '1 D 0.57cm'
2025-07-11 19:56:43 - root - DEBUG - Combined text for keyword search: '64%21hz voluson abdomen 58 hm pi 7.70 - 2.10 a0 100% gn -20 c6/ m4 ff1 / e2 sri ii 2 / cri 2 -- 1 d 0.57cm'
2025-07-11 19:56:43 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-11 19:56:43 - root - INFO - Organ identification completed. Found 0 organ keywords
2025-07-11 19:56:43 - root - INFO - Identified organs: []
2025-07-11 19:56:43 - root - WARNING - No organ name identified from the image
2025-07-11 19:56:43 - root - DEBUG - Organ identified: []
2025-07-11 19:56:43 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-11 19:56:43 - root - DEBUG - Number of scored candidates: 10
2025-07-11 19:56:43 - root - DEBUG - Best score index: 0
2025-07-11 19:56:43 - root - INFO - Extracting structured data from detected table
2025-07-11 19:56:43 - root - INFO - Starting table content extraction
2025-07-11 19:56:43 - root - DEBUG - Bounding box coordinates: (3110, 2228, 294, 79)
2025-07-11 19:56:43 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-11 19:56:43 - root - DEBUG - Delegating to content extractor for table processing
2025-07-11 19:56:43 - root - INFO - Starting table content extraction
2025-07-11 19:56:43 - root - DEBUG - Bounding box coordinates: (3110, 2228, 294, 79)
2025-07-11 19:56:51 - root - INFO - Performing OCR on extracted table region
2025-07-11 19:56:51 - root - DEBUG - Line 1: '1 D 0.57cm' (conf: 0.997)
2025-07-11 19:56:51 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-11 19:56:51 - root - INFO - Extracted 1 text elements from table region
2025-07-11 19:56:51 - root - INFO - Structuring extracted text data
2025-07-11 19:56:51 - root - INFO - Starting table data structuring
2025-07-11 19:56:51 - root - DEBUG - Element 1: text='1 D 0.57cm', x=154.50, y=39.00, conf=0.997
2025-07-11 19:56:51 - root - DEBUG - Processing element 1/1: '1 D 0.57cm' at (154.50, 39.00)
2025-07-11 19:56:51 - root - INFO - Line grouping completed - Total lines: 1
2025-07-11 19:56:51 - root - DEBUG - Processing line 1/1 with 1 elements
2025-07-11 19:56:51 - root - DEBUG - Processing word 1/1: '1 D 0.57cm'
2025-07-11 19:56:51 - root - DEBUG - Starting measurement text splitting
2025-07-11 19:56:51 - root - DEBUG - Input text: '1 D 0.57cm'
2025-07-11 19:56:51 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-11 19:56:51 - root - DEBUG - Pattern 1 matched successfully
2025-07-11 19:56:51 - root - DEBUG - Pattern 1 groups: ('1', 'D', '0.57cm')
2025-07-11 19:56:51 - root - DEBUG - Pattern 1 result: ('1', 'D', '0.57cm')
2025-07-11 19:56:51 - root - INFO - Text split successful using pattern 1: ('1', 'D', '0.57cm')
2025-07-11 19:56:51 - root - DEBUG - Split measurement result: ('1', 'D', '0.57cm')
2025-07-11 19:56:51 - root - DEBUG - Final structured data:
2025-07-11 19:56:51 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D', '0.57cm']}'
2025-07-11 19:56:51 - root - INFO - Table content extraction completed successfully
2025-07-11 19:56:51 - root - DEBUG - Structured data keys: [{'organLabel': []}, {'Value1': ['1', 'D', '0.57cm']}]
2025-07-11 19:56:51 - root - DEBUG - Organ identified: []
2025-07-11 19:56:51 - root - INFO - Table extraction successful for file: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000100_20250417_103454
2025-07-11 19:56:51 - root - INFO - Organ identified: []
2025-07-11 19:56:51 - root - DEBUG - Structured data extracted: [{'organLabel': []}, {'Value1': ['1', 'D', '0.57cm']}]
2025-07-11 19:56:51 - root - DEBUG - Displaying cropped image
2025-07-11 19:56:51 - root - INFO - Displaying image in OpenCV window: DICOM Image
2025-07-11 19:56:51 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:56:51 - root - DEBUG - Image data type: uint8
2025-07-11 19:56:51 - root - DEBUG - Creating OpenCV window and displaying image
2025-07-11 19:56:51 - root - INFO - Image displayed successfully
2025-07-11 19:56:51 - root - DEBUG - Waiting for user input (key press)
2025-07-11 19:56:51 - root - DEBUG - Destroying OpenCV windows
2025-07-11 19:56:51 - root - INFO - Image display completed and windows closed
2025-07-11 19:56:51 - root - INFO - Processing DICOM file 10/11: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000110_20250417_103454
2025-07-11 19:56:51 - root - DEBUG - Converting DICOM to PNG format
2025-07-11 19:56:51 - root - INFO - Starting DICOM to PNG conversion: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000110_20250417_103454
2025-07-11 19:56:51 - root - DEBUG - Reading DICOM file with pydicom
2025-07-11 19:56:51 - root - INFO - DICOM file loaded successfully
2025-07-11 19:56:51 - root - DEBUG - Original photometric interpretation: RGB
2025-07-11 19:56:51 - root - INFO - Processing RGB format DICOM
2025-07-11 19:56:51 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-11 19:56:51 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-11 19:56:51 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-11 19:56:51 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-11 19:56:51 - root - DEBUG - Cropping ultrasound image area
2025-07-11 19:56:51 - root - DEBUG - Initializing USRegionLocation detector
2025-07-11 19:56:51 - root - INFO - Getting ultrasound region coordinates
2025-07-11 19:56:51 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-11 19:56:51 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:56:51 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-11 19:56:51 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-11 19:56:51 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-11 19:56:51 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-11 19:56:51 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:56:51 - root - INFO - Analyzing cropped image for measurement tables
2025-07-11 19:56:51 - root - INFO - Starting table detection in ultrasound image
2025-07-11 19:56:51 - root - INFO - Initializing UltrasoundTableDetector
2025-07-11 19:56:51 - root - INFO - Initializing OCRHandler
2025-07-11 19:56:51 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-11 19:56:51 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-11 19:56:51 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-11 19:56:51 - root - DEBUG - - lang: 'en' (English language)
2025-07-11 19:56:51 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-11 19:56:51 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-11 19:56:51 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-11 19:56:52 - root - INFO - OCRHandler initialized successfully
2025-07-11 19:56:52 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-11 19:56:52 - root - INFO - Initializing TableDetector
2025-07-11 19:56:52 - root - DEBUG - TableDetector instance created successfully
2025-07-11 19:56:52 - root - DEBUG - Default detection parameters:
2025-07-11 19:56:52 - root - DEBUG - - Image upscale factor: 3x
2025-07-11 19:56:52 - root - DEBUG - - Edge threshold: 50
2025-07-11 19:56:52 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-11 19:56:52 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-11 19:56:52 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-11 19:56:52 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-11 19:56:52 - root - INFO - TableDetector initialization completed
2025-07-11 19:56:52 - root - INFO - Initializing TextAnalyzer
2025-07-11 19:56:52 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-11 19:56:52 - root - DEBUG - Text analysis configuration:
2025-07-11 19:56:52 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-11 19:56:52 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-11 19:56:52 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-11 19:56:52 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-11 19:56:52 - root - INFO - TextAnalyzer initialization completed
2025-07-11 19:56:52 - root - INFO - Initializing ContentExtractor
2025-07-11 19:56:52 - root - INFO - ContentExtractor initialized successfully
2025-07-11 19:56:52 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-11 19:56:52 - root - INFO - Detecting measurement tables in the image
2025-07-11 19:56:52 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-11 19:56:52 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-11 19:56:52 - root - DEBUG - Converting upscaled image to grayscale
2025-07-11 19:56:52 - root - DEBUG - Grayscale conversion completed
2025-07-11 19:56:52 - root - INFO - Applying edge detection to grayscale image
2025-07-11 19:56:52 - root - DEBUG - Edge detection completed
2025-07-11 19:56:52 - root - DEBUG - Applying threshold to create binary image
2025-07-11 19:56:52 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 589058
2025-07-11 19:56:52 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-11 19:56:52 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-11 19:56:52 - root - INFO - Enhancing horizontal and vertical lines
2025-07-11 19:56:52 - root - DEBUG - Line enhancement completed
2025-07-11 19:56:52 - root - DEBUG - Applying dilation to make lines thicker
2025-07-11 19:56:52 - root - DEBUG - Line thickening completed
2025-07-11 19:56:52 - root - DEBUG - Combining horizontal and vertical lines
2025-07-11 19:56:52 - root - DEBUG - Line combination completed
2025-07-11 19:56:52 - root - DEBUG - Created copy for contour visualization
2025-07-11 19:56:52 - root - INFO - Finding contours in enhanced lines
2025-07-11 19:56:52 - root - INFO - Found 1055 contours
2025-07-11 19:56:52 - root - DEBUG - Drawing contours for visualization
2025-07-11 19:56:52 - root - DEBUG - Contours drawn successfully
2025-07-11 19:56:52 - root - INFO - Processing contours to find rectangular regions
2025-07-11 19:56:52 - root - INFO - Rectangular region detection completed
2025-07-11 19:56:52 - root - INFO - Total candidate regions found: 386
2025-07-11 19:56:52 - root - DEBUG - Found 386 candidate regions
2025-07-11 19:56:52 - root - INFO - Processing candidate regions for measurement content
2025-07-11 19:56:54 - root - DEBUG - Line 1: 'LT OVARY' (conf: 1.000)
2025-07-11 19:56:54 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:54 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:54 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:54 - root - DEBUG - Combined text: 'lt ovary'
2025-07-11 19:56:54 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:54 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:54 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:54 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:54 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:54 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:54 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:54 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:54 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:54 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:54 - root - INFO - Final measurement score: 0
2025-07-11 19:56:54 - root - DEBUG - Line 1: 'E2' (conf: 0.916)
2025-07-11 19:56:54 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:54 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:54 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:54 - root - DEBUG - Combined text: 'e2'
2025-07-11 19:56:54 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:54 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:54 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:54 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:54 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:54 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:54 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:54 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:54 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:54 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:54 - root - INFO - Final measurement score: 0
2025-07-11 19:56:55 - root - DEBUG - Line 1: ':' (conf: 0.517)
2025-07-11 19:56:55 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:55 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:55 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:55 - root - DEBUG - Combined text: ':'
2025-07-11 19:56:55 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:55 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:55 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:55 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:55 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:55 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:55 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:55 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:55 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:55 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:55 - root - INFO - Final measurement score: 0
2025-07-11 19:56:55 - root - DEBUG - Line 1: 'Voluson' (conf: 0.999)
2025-07-11 19:56:55 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:55 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:55 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:55 - root - DEBUG - Combined text: 'voluson'
2025-07-11 19:56:55 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:55 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:55 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:55 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:55 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:55 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:55 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:55 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:55 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:55 - root - DEBUG - 'vol' occurrences: 1, bonus added: 2
2025-07-11 19:56:55 - root - INFO - Final measurement score: 2
2025-07-11 19:56:55 - root - DEBUG - Line 1: 'HM F' (conf: 0.912)
2025-07-11 19:56:55 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:55 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:55 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:55 - root - DEBUG - Combined text: 'hm f'
2025-07-11 19:56:55 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:55 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:55 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:55 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:55 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:55 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:55 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:55 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:55 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:55 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:55 - root - INFO - Final measurement score: 0
2025-07-11 19:56:55 - root - DEBUG - Line 1: 'Voluson' (conf: 0.996)
2025-07-11 19:56:55 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:55 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:55 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:55 - root - DEBUG - Combined text: 'voluson'
2025-07-11 19:56:55 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:55 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:55 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:55 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:55 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:55 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:55 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:55 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:55 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:55 - root - DEBUG - 'vol' occurrences: 1, bonus added: 2
2025-07-11 19:56:55 - root - INFO - Final measurement score: 2
2025-07-11 19:56:55 - root - DEBUG - Line 1: '64' (conf: 1.000)
2025-07-11 19:56:55 - root - DEBUG - Line 2: 'A' (conf: 0.999)
2025-07-11 19:56:55 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:55 - root - DEBUG - Number of text lines detected: 2
2025-07-11 19:56:55 - root - DEBUG - Text extraction completed - Lines processed: 2
2025-07-11 19:56:55 - root - DEBUG - Combined text: '64 a'
2025-07-11 19:56:55 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:55 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:55 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:55 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:55 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:55 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:55 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:55 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:55 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:55 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:55 - root - INFO - Final measurement score: 0
2025-07-11 19:56:56 - root - DEBUG - Line 1: '2' (conf: 0.883)
2025-07-11 19:56:56 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:56:56 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:56:56 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:56:56 - root - DEBUG - Combined text: '2'
2025-07-11 19:56:56 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:56:56 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:56:56 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:56:56 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:56:56 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:56:56 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:56:56 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:56:56 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:56:56 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:56:56 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:56:56 - root - INFO - Final measurement score: 0
2025-07-11 19:56:56 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-11 19:56:56 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-11 19:56:56 - root - DEBUG - Top 10 score indices: [348, 360, 0, 1, 2, 3, 4, 5, 6, 7]
2025-07-11 19:56:56 - root - DEBUG - Rank 1: Index 348, Score 2.000000
2025-07-11 19:56:56 - root - DEBUG - Rank 2: Index 360, Score 2.000000
2025-07-11 19:56:56 - root - DEBUG - Rank 3: Index 0, Score 0.000000
2025-07-11 19:56:56 - root - DEBUG - Rank 4: Index 1, Score 0.000000
2025-07-11 19:56:56 - root - DEBUG - Rank 5: Index 2, Score 0.000000
2025-07-11 19:56:56 - root - DEBUG - Rank 6: Index 3, Score 0.000000
2025-07-11 19:56:56 - root - DEBUG - Rank 7: Index 4, Score 0.000000
2025-07-11 19:56:56 - root - DEBUG - Rank 8: Index 5, Score 0.000000
2025-07-11 19:56:56 - root - DEBUG - Rank 9: Index 6, Score 0.000000
2025-07-11 19:56:56 - root - DEBUG - Rank 10: Index 7, Score 0.000000
2025-07-11 19:56:56 - root - WARNING - No candidates meet the minimum threshold of 4. Best score: 2.000000
2025-07-11 19:56:56 - root - INFO - Measurement table detection completed - no valid tables found
2025-07-11 19:56:56 - root - DEBUG - Table detection completed. Candidates found: 386
2025-07-11 19:56:56 - root - INFO - Identifying organ name from the image
2025-07-11 19:56:56 - root - INFO - Starting organ name identification
2025-07-11 19:56:56 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:56:56 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-11 19:56:56 - root - INFO - Starting organ label identification
2025-07-11 19:56:56 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-11 19:56:56 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-11 19:56:57 - root - DEBUG - Line 1: '64% 21Hz' (conf: 0.983)
2025-07-11 19:56:57 - root - DEBUG - Line 2: ' Yoluson' (conf: 0.852)
2025-07-11 19:56:57 - root - DEBUG - Line 3: 'Voluson' (conf: 0.998)
2025-07-11 19:56:57 - root - DEBUG - Line 4: 'Abdomen' (conf: 0.997)
2025-07-11 19:56:57 - root - DEBUG - Line 5: '58' (conf: 0.634)
2025-07-11 19:56:57 - root - DEBUG - Line 6: '58' (conf: 0.899)
2025-07-11 19:56:57 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.931)
2025-07-11 19:56:57 - root - DEBUG - Line 8: 'A0 100%' (conf: 0.974)
2025-07-11 19:56:57 - root - DEBUG - Line 9: 'Gn -18' (conf: 0.994)
2025-07-11 19:56:57 - root - DEBUG - Line 10: 'C6/M4' (conf: 0.990)
2025-07-11 19:56:57 - root - DEBUG - Line 11: 'FF1 / E2' (conf: 0.998)
2025-07-11 19:56:57 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.974)
2025-07-11 19:56:57 - root - DEBUG - Line 13: 'LT OVARY' (conf: 1.000)
2025-07-11 19:56:57 - root - DEBUG - OCR completed. Processing 13 text lines for organ keywords
2025-07-11 19:56:57 - root - DEBUG - Line 0 text: '64% 21Hz'
2025-07-11 19:56:57 - root - DEBUG - Line 1 text: ' Yoluson'
2025-07-11 19:56:57 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-11 19:56:57 - root - DEBUG - Line 3 text: 'Abdomen'
2025-07-11 19:56:57 - root - DEBUG - Line 4 text: '58'
2025-07-11 19:56:57 - root - DEBUG - Line 5 text: '58'
2025-07-11 19:56:57 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-11 19:56:57 - root - DEBUG - Line 7 text: 'A0 100%'
2025-07-11 19:56:57 - root - DEBUG - Line 8 text: 'Gn -18'
2025-07-11 19:56:57 - root - DEBUG - Line 9 text: 'C6/M4'
2025-07-11 19:56:57 - root - DEBUG - Line 10 text: 'FF1 / E2'
2025-07-11 19:56:57 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-11 19:56:57 - root - DEBUG - Line 12 text: 'LT OVARY'
2025-07-11 19:56:57 - root - DEBUG - Combined text for keyword search: '64% 21hz  yoluson voluson abdomen 58 58 hm pi 7.70 - 2.10 a0 100% gn -18 c6/m4 ff1 / e2 sri ii 2 / cri 2 lt ovary'
2025-07-11 19:56:57 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-11 19:56:57 - root - DEBUG - Found organ keyword: 'lt ovary'
2025-07-11 19:56:57 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-11 19:56:57 - root - INFO - Identified organs: ['lt ovary']
2025-07-11 19:56:57 - root - INFO - Organ identification completed successfully: ['lt ovary']
2025-07-11 19:56:57 - root - DEBUG - Organ identified: ['lt ovary']
2025-07-11 19:56:57 - root - WARNING - No measurement tables detected in the ultrasound image
2025-07-11 19:56:57 - root - WARNING - No structured data extracted from file: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000110_20250417_103454
2025-07-11 19:56:57 - root - DEBUG - Displaying cropped image
2025-07-11 19:56:57 - root - INFO - Displaying image in OpenCV window: DICOM Image
2025-07-11 19:56:57 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:56:57 - root - DEBUG - Image data type: uint8
2025-07-11 19:56:57 - root - DEBUG - Creating OpenCV window and displaying image
2025-07-11 19:56:57 - root - INFO - Image displayed successfully
2025-07-11 19:56:57 - root - DEBUG - Waiting for user input (key press)
2025-07-11 19:56:58 - root - DEBUG - Destroying OpenCV windows
2025-07-11 19:56:58 - root - INFO - Image display completed and windows closed
2025-07-11 19:56:58 - root - INFO - Processing DICOM file 11/11: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000120_20250417_103454
2025-07-11 19:56:58 - root - DEBUG - Converting DICOM to PNG format
2025-07-11 19:56:58 - root - INFO - Starting DICOM to PNG conversion: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000120_20250417_103454
2025-07-11 19:56:58 - root - DEBUG - Reading DICOM file with pydicom
2025-07-11 19:56:58 - root - INFO - DICOM file loaded successfully
2025-07-11 19:56:58 - root - DEBUG - Original photometric interpretation: RGB
2025-07-11 19:56:58 - root - INFO - Processing RGB format DICOM
2025-07-11 19:56:58 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-11 19:56:58 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-11 19:56:58 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-11 19:56:58 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-11 19:56:58 - root - DEBUG - Cropping ultrasound image area
2025-07-11 19:56:58 - root - DEBUG - Initializing USRegionLocation detector
2025-07-11 19:56:58 - root - INFO - Getting ultrasound region coordinates
2025-07-11 19:56:58 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-11 19:56:58 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:56:58 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-11 19:56:58 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-11 19:56:58 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-11 19:56:58 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-11 19:56:58 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-11 19:56:58 - root - INFO - Analyzing cropped image for measurement tables
2025-07-11 19:56:58 - root - INFO - Starting table detection in ultrasound image
2025-07-11 19:56:58 - root - INFO - Initializing UltrasoundTableDetector
2025-07-11 19:56:58 - root - INFO - Initializing OCRHandler
2025-07-11 19:56:58 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-11 19:56:58 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-11 19:56:58 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-11 19:56:58 - root - DEBUG - - lang: 'en' (English language)
2025-07-11 19:56:58 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-11 19:56:58 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-11 19:56:58 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-11 19:56:58 - root - INFO - OCRHandler initialized successfully
2025-07-11 19:56:58 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-11 19:56:58 - root - INFO - Initializing TableDetector
2025-07-11 19:56:58 - root - DEBUG - TableDetector instance created successfully
2025-07-11 19:56:58 - root - DEBUG - Default detection parameters:
2025-07-11 19:56:58 - root - DEBUG - - Image upscale factor: 3x
2025-07-11 19:56:58 - root - DEBUG - - Edge threshold: 50
2025-07-11 19:56:58 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-11 19:56:58 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-11 19:56:58 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-11 19:56:58 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-11 19:56:58 - root - INFO - TableDetector initialization completed
2025-07-11 19:56:58 - root - INFO - Initializing TextAnalyzer
2025-07-11 19:56:58 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-11 19:56:58 - root - DEBUG - Text analysis configuration:
2025-07-11 19:56:58 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-11 19:56:58 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-11 19:56:58 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-11 19:56:58 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-11 19:56:58 - root - INFO - TextAnalyzer initialization completed
2025-07-11 19:56:58 - root - INFO - Initializing ContentExtractor
2025-07-11 19:56:58 - root - INFO - ContentExtractor initialized successfully
2025-07-11 19:56:58 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-11 19:56:58 - root - INFO - Detecting measurement tables in the image
2025-07-11 19:56:58 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-11 19:56:58 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-11 19:56:58 - root - DEBUG - Converting upscaled image to grayscale
2025-07-11 19:56:58 - root - DEBUG - Grayscale conversion completed
2025-07-11 19:56:58 - root - INFO - Applying edge detection to grayscale image
2025-07-11 19:56:58 - root - DEBUG - Edge detection completed
2025-07-11 19:56:58 - root - DEBUG - Applying threshold to create binary image
2025-07-11 19:56:58 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 589058
2025-07-11 19:56:58 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-11 19:56:58 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-11 19:56:58 - root - INFO - Enhancing horizontal and vertical lines
2025-07-11 19:56:58 - root - DEBUG - Line enhancement completed
2025-07-11 19:56:58 - root - DEBUG - Applying dilation to make lines thicker
2025-07-11 19:56:58 - root - DEBUG - Line thickening completed
2025-07-11 19:56:58 - root - DEBUG - Combining horizontal and vertical lines
2025-07-11 19:56:58 - root - DEBUG - Line combination completed
2025-07-11 19:56:58 - root - DEBUG - Created copy for contour visualization
2025-07-11 19:56:58 - root - INFO - Finding contours in enhanced lines
2025-07-11 19:56:58 - root - INFO - Found 1055 contours
2025-07-11 19:56:58 - root - DEBUG - Drawing contours for visualization
2025-07-11 19:56:58 - root - DEBUG - Contours drawn successfully
2025-07-11 19:56:58 - root - INFO - Processing contours to find rectangular regions
2025-07-11 19:56:58 - root - INFO - Rectangular region detection completed
2025-07-11 19:56:58 - root - INFO - Total candidate regions found: 386
2025-07-11 19:56:58 - root - DEBUG - Found 386 candidate regions
2025-07-11 19:56:58 - root - INFO - Processing candidate regions for measurement content
2025-07-11 19:57:01 - root - DEBUG - Line 1: 'LT OVARY' (conf: 1.000)
2025-07-11 19:57:01 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:57:01 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:57:01 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:57:01 - root - DEBUG - Combined text: 'lt ovary'
2025-07-11 19:57:01 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:57:01 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:57:01 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:57:01 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:57:01 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:57:01 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:57:01 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:57:01 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:57:01 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:57:01 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:57:01 - root - INFO - Final measurement score: 0
2025-07-11 19:57:01 - root - DEBUG - Line 1: 'E2' (conf: 0.916)
2025-07-11 19:57:01 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:57:01 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:57:01 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:57:01 - root - DEBUG - Combined text: 'e2'
2025-07-11 19:57:01 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:57:01 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:57:01 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:57:01 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:57:01 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:57:01 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:57:01 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:57:01 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:57:01 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:57:01 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:57:01 - root - INFO - Final measurement score: 0
2025-07-11 19:57:01 - root - DEBUG - Line 1: ':' (conf: 0.517)
2025-07-11 19:57:01 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:57:01 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:57:01 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:57:01 - root - DEBUG - Combined text: ':'
2025-07-11 19:57:01 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:57:01 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:57:01 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:57:01 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:57:01 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:57:01 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:57:01 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:57:01 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:57:01 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:57:01 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:57:01 - root - INFO - Final measurement score: 0
2025-07-11 19:57:01 - root - DEBUG - Line 1: 'Voluson' (conf: 0.999)
2025-07-11 19:57:01 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:57:01 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:57:01 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:57:01 - root - DEBUG - Combined text: 'voluson'
2025-07-11 19:57:01 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:57:01 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:57:01 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:57:01 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:57:01 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:57:01 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:57:01 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:57:01 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:57:01 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:57:01 - root - DEBUG - 'vol' occurrences: 1, bonus added: 2
2025-07-11 19:57:01 - root - INFO - Final measurement score: 2
2025-07-11 19:57:01 - root - DEBUG - Line 1: 'HM F' (conf: 0.912)
2025-07-11 19:57:01 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:57:01 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:57:01 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:57:01 - root - DEBUG - Combined text: 'hm f'
2025-07-11 19:57:01 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:57:01 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:57:01 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:57:01 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:57:01 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:57:01 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:57:01 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:57:01 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:57:01 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:57:01 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:57:01 - root - INFO - Final measurement score: 0
2025-07-11 19:57:01 - root - DEBUG - Line 1: 'Voluson' (conf: 0.996)
2025-07-11 19:57:01 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:57:01 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:57:01 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:57:01 - root - DEBUG - Combined text: 'voluson'
2025-07-11 19:57:01 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:57:01 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:57:01 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:57:01 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:57:01 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:57:01 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:57:01 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:57:01 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:57:01 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:57:01 - root - DEBUG - 'vol' occurrences: 1, bonus added: 2
2025-07-11 19:57:01 - root - INFO - Final measurement score: 2
2025-07-11 19:57:02 - root - DEBUG - Line 1: '64' (conf: 1.000)
2025-07-11 19:57:02 - root - DEBUG - Line 2: 'A' (conf: 0.999)
2025-07-11 19:57:02 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:57:02 - root - DEBUG - Number of text lines detected: 2
2025-07-11 19:57:02 - root - DEBUG - Text extraction completed - Lines processed: 2
2025-07-11 19:57:02 - root - DEBUG - Combined text: '64 a'
2025-07-11 19:57:02 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:57:02 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:57:02 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:57:02 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:57:02 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:57:02 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:57:02 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:57:02 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:57:02 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:57:02 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:57:02 - root - INFO - Final measurement score: 0
2025-07-11 19:57:02 - root - DEBUG - Line 1: '2' (conf: 0.883)
2025-07-11 19:57:02 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-11 19:57:02 - root - DEBUG - Number of text lines detected: 1
2025-07-11 19:57:02 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-11 19:57:02 - root - DEBUG - Combined text: '2'
2025-07-11 19:57:02 - root - DEBUG - Defining measurement patterns for scoring
2025-07-11 19:57:02 - root - DEBUG - Measurement patterns defined:
2025-07-11 19:57:02 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-11 19:57:02 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-11 19:57:02 - root - INFO - Analyzing text for measurement patterns
2025-07-11 19:57:02 - root - DEBUG - Pattern 1 matches: 0
2025-07-11 19:57:02 - root - DEBUG - Pattern 2 matches: 0
2025-07-11 19:57:02 - root - DEBUG - Base score from pattern matching: 0
2025-07-11 19:57:02 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-11 19:57:02 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-11 19:57:02 - root - INFO - Final measurement score: 0
2025-07-11 19:57:02 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-11 19:57:02 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-11 19:57:02 - root - DEBUG - Top 10 score indices: [348, 360, 0, 1, 2, 3, 4, 5, 6, 7]
2025-07-11 19:57:02 - root - DEBUG - Rank 1: Index 348, Score 2.000000
2025-07-11 19:57:02 - root - DEBUG - Rank 2: Index 360, Score 2.000000
2025-07-11 19:57:02 - root - DEBUG - Rank 3: Index 0, Score 0.000000
2025-07-11 19:57:02 - root - DEBUG - Rank 4: Index 1, Score 0.000000
2025-07-11 19:57:02 - root - DEBUG - Rank 5: Index 2, Score 0.000000
2025-07-11 19:57:02 - root - DEBUG - Rank 6: Index 3, Score 0.000000
2025-07-11 19:57:02 - root - DEBUG - Rank 7: Index 4, Score 0.000000
2025-07-11 19:57:02 - root - DEBUG - Rank 8: Index 5, Score 0.000000
2025-07-11 19:57:02 - root - DEBUG - Rank 9: Index 6, Score 0.000000
2025-07-11 19:57:02 - root - DEBUG - Rank 10: Index 7, Score 0.000000
2025-07-11 19:57:02 - root - WARNING - No candidates meet the minimum threshold of 4. Best score: 2.000000
2025-07-11 19:57:02 - root - INFO - Measurement table detection completed - no valid tables found
2025-07-11 19:57:02 - root - DEBUG - Table detection completed. Candidates found: 386
2025-07-11 19:57:02 - root - INFO - Identifying organ name from the image
2025-07-11 19:57:02 - root - INFO - Starting organ name identification
2025-07-11 19:57:02 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:57:02 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-11 19:57:02 - root - INFO - Starting organ label identification
2025-07-11 19:57:02 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-11 19:57:02 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-11 19:57:03 - root - DEBUG - Line 1: '64% 21Hz' (conf: 0.983)
2025-07-11 19:57:03 - root - DEBUG - Line 2: ' Yoluson' (conf: 0.852)
2025-07-11 19:57:03 - root - DEBUG - Line 3: 'Voluson' (conf: 0.998)
2025-07-11 19:57:03 - root - DEBUG - Line 4: 'Abdomen' (conf: 0.997)
2025-07-11 19:57:03 - root - DEBUG - Line 5: '58' (conf: 0.634)
2025-07-11 19:57:03 - root - DEBUG - Line 6: '58' (conf: 0.899)
2025-07-11 19:57:03 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.931)
2025-07-11 19:57:03 - root - DEBUG - Line 8: 'A0 100%' (conf: 0.974)
2025-07-11 19:57:03 - root - DEBUG - Line 9: 'Gn -18' (conf: 0.994)
2025-07-11 19:57:03 - root - DEBUG - Line 10: 'C6/M4' (conf: 0.990)
2025-07-11 19:57:03 - root - DEBUG - Line 11: 'FF1 / E2' (conf: 0.998)
2025-07-11 19:57:03 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.974)
2025-07-11 19:57:03 - root - DEBUG - Line 13: 'LT OVARY' (conf: 1.000)
2025-07-11 19:57:03 - root - DEBUG - OCR completed. Processing 13 text lines for organ keywords
2025-07-11 19:57:03 - root - DEBUG - Line 0 text: '64% 21Hz'
2025-07-11 19:57:03 - root - DEBUG - Line 1 text: ' Yoluson'
2025-07-11 19:57:03 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-11 19:57:03 - root - DEBUG - Line 3 text: 'Abdomen'
2025-07-11 19:57:03 - root - DEBUG - Line 4 text: '58'
2025-07-11 19:57:03 - root - DEBUG - Line 5 text: '58'
2025-07-11 19:57:03 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-11 19:57:03 - root - DEBUG - Line 7 text: 'A0 100%'
2025-07-11 19:57:03 - root - DEBUG - Line 8 text: 'Gn -18'
2025-07-11 19:57:03 - root - DEBUG - Line 9 text: 'C6/M4'
2025-07-11 19:57:03 - root - DEBUG - Line 10 text: 'FF1 / E2'
2025-07-11 19:57:03 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-11 19:57:03 - root - DEBUG - Line 12 text: 'LT OVARY'
2025-07-11 19:57:03 - root - DEBUG - Combined text for keyword search: '64% 21hz  yoluson voluson abdomen 58 58 hm pi 7.70 - 2.10 a0 100% gn -18 c6/m4 ff1 / e2 sri ii 2 / cri 2 lt ovary'
2025-07-11 19:57:03 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-11 19:57:03 - root - DEBUG - Found organ keyword: 'lt ovary'
2025-07-11 19:57:03 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-11 19:57:03 - root - INFO - Identified organs: ['lt ovary']
2025-07-11 19:57:03 - root - INFO - Organ identification completed successfully: ['lt ovary']
2025-07-11 19:57:03 - root - DEBUG - Organ identified: ['lt ovary']
2025-07-11 19:57:03 - root - WARNING - No measurement tables detected in the ultrasound image
2025-07-11 19:57:03 - root - WARNING - No structured data extracted from file: C:\Users\Welcome\Documents\organized_dicom\PELVIS_US\E0000037\I0000120_20250417_103454
2025-07-11 19:57:03 - root - DEBUG - Displaying cropped image
2025-07-11 19:57:03 - root - INFO - Displaying image in OpenCV window: DICOM Image
2025-07-11 19:57:03 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-11 19:57:03 - root - DEBUG - Image data type: uint8
2025-07-11 19:57:03 - root - DEBUG - Creating OpenCV window and displaying image
2025-07-11 19:57:03 - root - INFO - Image displayed successfully
2025-07-11 19:57:03 - root - DEBUG - Waiting for user input (key press)
2025-07-11 19:57:05 - root - DEBUG - Destroying OpenCV windows
2025-07-11 19:57:05 - root - INFO - Image display completed and windows closed
2025-07-11 19:57:05 - root - INFO - === DICOM Processing Session Completed === {'slice1': [None], 'slice2': [[{'organLabel': ['uterus']}, {'Value1': ['1', 'D', '8.60cm']}, {'Value2': ['2', 'D', '4.17cm']}, {'Value3': ['3 ', 'D', '3.63cm']}]], 'slice3': [[{'organLabel': []}, {'Value1': ['1', 'D', '0.65cm']}]], 'slice4': [None], 'slice5': [[{'organLabel': []}, {'Value1': ['1', 'D', '5.87cm']}, {'Value2': ['2 ', 'D', '4.37cm']}]], 'slice6': [None], 'slice7': [[{'organLabel': ['lt ovary']}, {'Value1': ['1', 'D1', '2.93cm']}, {'Value2': ['2', 'D2', '1.52cm']}, {'Value3': ['3', 'D3', '2.54cm']}, {'Value4': ['Vol', '5.923cm']}]], 'slice8': [[{'organLabel': []}, {'Value1': ['1', 'D', '1.65cm']}, {'Value2': ['2 l', 'D', '1.56cm']}]], 'slice9': [[{'organLabel': []}, {'Value1': ['1', 'D', '0.57cm']}]], 'slice10': [None], 'slice11': [None]}
2025-07-11 19:57:05 - root - INFO - Program execution completed
