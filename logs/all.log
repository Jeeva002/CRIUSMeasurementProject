2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:117]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_header_field with data[119:131]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_header_value with data[133:161]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[165:49152]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:47080]
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-07-14 17:22:40 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:117]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_header_field with data[119:131]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_header_value with data[133:161]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[165:98304]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:260072]
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-07-14 17:25:02 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-07-14 17:25:02 - root - INFO - === Starting DICOM Ultrasound Processing Session ===
2025-07-14 17:25:02 - root - INFO - Processing DICOM directory: API\extracted\TestingDicomZip
2025-07-14 17:25:02 - root - INFO - Reading DICOM files from directory
2025-07-14 17:25:02 - root - INFO - Starting to read DICOM directory: API\extracted\TestingDicomZip
2025-07-14 17:25:02 - root - DEBUG - Listing files in directory
2025-07-14 17:25:02 - root - INFO - Found 11 files in directory to process
2025-07-14 17:25:02 - root - DEBUG - Processing file 1/11: I0000010_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000010_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:25:02 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000010_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Added valid DICOM file to list: I0000010_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Processing file 2/11: I0000020_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000020_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:25:02 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000020_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Added valid DICOM file to list: I0000020_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Processing file 3/11: I0000030_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000030_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:25:02 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000030_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Added valid DICOM file to list: I0000030_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Processing file 4/11: I0000040_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000040_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:25:02 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000040_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Added valid DICOM file to list: I0000040_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Processing file 5/11: I0000060_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000060_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:25:02 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000060_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Added valid DICOM file to list: I0000060_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Processing file 6/11: I0000070_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000070_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:25:02 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000070_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Added valid DICOM file to list: I0000070_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Processing file 7/11: I0000080_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000080_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:25:02 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000080_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Added valid DICOM file to list: I0000080_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Processing file 8/11: I0000090_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000090_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:25:02 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000090_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Added valid DICOM file to list: I0000090_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Processing file 9/11: I0000100_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000100_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:25:02 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000100_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Added valid DICOM file to list: I0000100_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Processing file 10/11: I0000110_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000110_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:25:02 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000110_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Added valid DICOM file to list: I0000110_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Processing file 11/11: I0000120_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000120_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:25:02 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000120_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Added valid DICOM file to list: I0000120_20250417_103454
2025-07-14 17:25:02 - root - INFO - DICOM file validation completed. Found 11 valid DICOM files
2025-07-14 17:25:02 - root - INFO - Extracting scan type from first DICOM file
2025-07-14 17:25:02 - root - DEBUG - Extracting scan type from DICOM file: API\extracted\TestingDicomZip\I0000010_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Reading DICOM metadata for scan type extraction
2025-07-14 17:25:02 - root - INFO - Scan type extracted successfully: PELVIS/US
2025-07-14 17:25:02 - root - DEBUG - Scan type from file API\extracted\TestingDicomZip\I0000010_20250417_103454: PELVIS/US
2025-07-14 17:25:02 - root - INFO - Successfully extracted scan type: {'PatientName': 'DHIBANA.C.K', 'PatientID': 'CICPL13880', 'PatientAge': '19921017', 'PatientGender': 'F', 'HospitalName': 'CLARITY IMAGING CENTRE', 'PhysicianName': '^Dr.^Geetha^Raj.^M.B.B.S.,^DNB^(', 'scanType': 'PELVIS/US', 'scanDate': '20250417', 'scanTime': '103454', 'scanModality': 'US'}
2025-07-14 17:25:02 - root - INFO - Directory processing completed successfully
2025-07-14 17:25:02 - root - DEBUG - Final results - DICOM files: 11, Scan type: {'PatientName': 'DHIBANA.C.K', 'PatientID': 'CICPL13880', 'PatientAge': '19921017', 'PatientGender': 'F', 'HospitalName': 'CLARITY IMAGING CENTRE', 'PhysicianName': '^Dr.^Geetha^Raj.^M.B.B.S.,^DNB^(', 'scanType': 'PELVIS/US', 'scanDate': '20250417', 'scanTime': '103454', 'scanModality': 'US'}
2025-07-14 17:25:02 - root - INFO - Found 11 DICOM files to process
2025-07-14 17:25:02 - root - DEBUG - metaData: {'PatientName': 'DHIBANA.C.K', 'PatientID': 'CICPL13880', 'PatientAge': '19921017', 'PatientGender': 'F', 'HospitalName': 'CLARITY IMAGING CENTRE', 'PhysicianName': '^Dr.^Geetha^Raj.^M.B.B.S.,^DNB^(', 'scanType': 'PELVIS/US', 'scanDate': '20250417', 'scanTime': '103454', 'scanModality': 'US'}
2025-07-14 17:25:02 - root - INFO - Processing DICOM file 1/11: API\extracted\TestingDicomZip\I0000010_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:25:02 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000010_20250417_103454
2025-07-14 17:25:02 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:25:02 - root - INFO - DICOM file loaded successfully
2025-07-14 17:25:02 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:25:02 - root - INFO - Processing RGB format DICOM
2025-07-14 17:25:02 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:25:02 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:25:02 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:25:02 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:25:02 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:25:02 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:25:02 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:25:02 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-14 17:25:02 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:25:02 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-14 17:25:02 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:25:02 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:25:02 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:25:02 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:25:02 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:25:02 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:25:02 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:25:02 - root - INFO - Initializing OCRHandler
2025-07-14 17:25:02 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:25:02 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:25:02 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:25:02 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:25:02 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:25:02 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:25:02 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:25:03 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:25:03 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:25:03 - root - INFO - Initializing TableDetector
2025-07-14 17:25:03 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:25:03 - root - DEBUG - Default detection parameters:
2025-07-14 17:25:03 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:25:03 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:25:03 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:25:03 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:25:03 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:25:03 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:25:03 - root - INFO - TableDetector initialization completed
2025-07-14 17:25:03 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:25:03 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:25:03 - root - DEBUG - Text analysis configuration:
2025-07-14 17:25:03 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:25:03 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:25:03 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:25:03 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:25:03 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:25:03 - root - INFO - Initializing ContentExtractor
2025-07-14 17:25:03 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:25:03 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:25:03 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:25:03 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:25:03 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:25:03 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:25:03 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:25:03 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:25:03 - root - DEBUG - Edge detection completed
2025-07-14 17:25:03 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:25:03 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 466792
2025-07-14 17:25:03 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:25:03 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:25:03 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:25:03 - root - DEBUG - Line enhancement completed
2025-07-14 17:25:03 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:25:03 - root - DEBUG - Line thickening completed
2025-07-14 17:25:03 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:25:03 - root - DEBUG - Line combination completed
2025-07-14 17:25:03 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:25:03 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:25:03 - root - INFO - Found 830 contours
2025-07-14 17:25:03 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:25:03 - root - DEBUG - Contours drawn successfully
2025-07-14 17:25:03 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:25:03 - root - INFO - Rectangular region detection completed
2025-07-14 17:25:03 - root - INFO - Total candidate regions found: 179
2025-07-14 17:25:03 - root - DEBUG - Found 179 candidate regions
2025-07-14 17:25:03 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:25:04 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:25:04 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:25:04 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:25:04 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:25:04 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:25:04 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:25:04 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:25:04 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:25:04 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:25:04 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:25:04 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:25:04 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:25:04 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:25:04 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:25:04 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:25:04 - root - INFO - Final measurement score: 0
2025-07-14 17:25:05 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:25:05 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:25:05 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-14 17:25:05 - root - DEBUG - Rank 1: Index 0, Score 0.000000
2025-07-14 17:25:05 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-14 17:25:05 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-14 17:25:05 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-14 17:25:05 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-14 17:25:05 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-14 17:25:05 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-14 17:25:05 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:25:05 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:25:05 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:25:05 - root - WARNING - No candidates meet the minimum threshold of 4. Best score: 0.000000
2025-07-14 17:25:05 - root - INFO - Measurement table detection completed - no valid tables found
2025-07-14 17:25:05 - root - DEBUG - Table detection completed. Candidates found: 179
2025-07-14 17:25:05 - root - INFO - Identifying organ name from the image
2025-07-14 17:25:05 - root - INFO - Starting organ name identification
2025-07-14 17:25:05 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:25:05 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:25:05 - root - INFO - Starting organ label identification
2025-07-14 17:25:05 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:25:05 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:25:07 - root - DEBUG - Line 1: '64/22Hz' (conf: 1.000)
2025-07-14 17:25:07 - root - DEBUG - Line 2: 'Voluson' (conf: 1.000)
2025-07-14 17:25:07 - root - DEBUG - Line 3: 'Voluson' (conf: 0.994)
2025-07-14 17:25:07 - root - DEBUG - Line 4: 'Abdomen' (conf: 1.000)
2025-07-14 17:25:07 - root - DEBUG - Line 5: 'S8' (conf: 0.741)
2025-07-14 17:25:07 - root - DEBUG - Line 6: '58' (conf: 0.915)
2025-07-14 17:25:07 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.927)
2025-07-14 17:25:07 - root - DEBUG - Line 8: 'AO 100%' (conf: 0.938)
2025-07-14 17:25:07 - root - DEBUG - Line 9: 'Gn -20' (conf: 0.920)
2025-07-14 17:25:07 - root - DEBUG - Line 10: 'C6 M4' (conf: 0.883)
2025-07-14 17:25:07 - root - DEBUG - Line 11: 'FF1/E2' (conf: 0.997)
2025-07-14 17:25:07 - root - DEBUG - Line 12: 'SRII2/CRI 2' (conf: 0.961)
2025-07-14 17:25:07 - root - DEBUG - Line 13: 'UTERUS' (conf: 0.999)
2025-07-14 17:25:07 - root - DEBUG - OCR completed. Processing 13 text lines for organ keywords
2025-07-14 17:25:07 - root - DEBUG - Line 0 text: '64/22Hz'
2025-07-14 17:25:07 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-14 17:25:07 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-14 17:25:07 - root - DEBUG - Line 3 text: 'Abdomen'
2025-07-14 17:25:07 - root - DEBUG - Line 4 text: 'S8'
2025-07-14 17:25:07 - root - DEBUG - Line 5 text: '58'
2025-07-14 17:25:07 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:25:07 - root - DEBUG - Line 7 text: 'AO 100%'
2025-07-14 17:25:07 - root - DEBUG - Line 8 text: 'Gn -20'
2025-07-14 17:25:07 - root - DEBUG - Line 9 text: 'C6 M4'
2025-07-14 17:25:07 - root - DEBUG - Line 10 text: 'FF1/E2'
2025-07-14 17:25:07 - root - DEBUG - Line 11 text: 'SRII2/CRI 2'
2025-07-14 17:25:07 - root - DEBUG - Line 12 text: 'UTERUS'
2025-07-14 17:25:07 - root - DEBUG - Combined text for keyword search: '64/22hz voluson voluson abdomen s8 58 hm pi 7.70 - 2.10 ao 100% gn -20 c6 m4 ff1/e2 srii2/cri 2 uterus'
2025-07-14 17:25:07 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:25:07 - root - DEBUG - Found organ keyword: 'uterus'
2025-07-14 17:25:07 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-14 17:25:07 - root - INFO - Identified organs: ['uterus']
2025-07-14 17:25:07 - root - INFO - Organ identification completed successfully: ['uterus']
2025-07-14 17:25:07 - root - DEBUG - Organ identified: ['uterus']
2025-07-14 17:25:07 - root - WARNING - No measurement tables detected in the ultrasound image
2025-07-14 17:25:07 - root - WARNING - No structured data extracted from file: API\extracted\TestingDicomZip\I0000010_20250417_103454
2025-07-14 17:25:07 - root - INFO - Processing DICOM file 2/11: API\extracted\TestingDicomZip\I0000020_20250417_103454
2025-07-14 17:25:07 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:25:07 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000020_20250417_103454
2025-07-14 17:25:07 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:25:07 - root - INFO - DICOM file loaded successfully
2025-07-14 17:25:07 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:25:07 - root - INFO - Processing RGB format DICOM
2025-07-14 17:25:07 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:25:07 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:25:07 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:25:07 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:25:07 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:25:07 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:25:07 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:25:07 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-14 17:25:07 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:25:07 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-14 17:25:07 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:25:07 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:25:07 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:25:07 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:25:07 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:25:07 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:25:07 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:25:07 - root - INFO - Initializing OCRHandler
2025-07-14 17:25:07 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:25:07 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:25:07 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:25:07 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:25:07 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:25:07 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:25:07 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:25:08 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:25:08 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:25:08 - root - INFO - Initializing TableDetector
2025-07-14 17:25:08 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:25:08 - root - DEBUG - Default detection parameters:
2025-07-14 17:25:08 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:25:08 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:25:08 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:25:08 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:25:08 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:25:08 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:25:08 - root - INFO - TableDetector initialization completed
2025-07-14 17:25:08 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:25:08 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:25:08 - root - DEBUG - Text analysis configuration:
2025-07-14 17:25:08 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:25:08 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:25:08 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:25:08 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:25:08 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:25:08 - root - INFO - Initializing ContentExtractor
2025-07-14 17:25:08 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:25:08 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:25:08 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:25:08 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:25:08 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:25:08 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:25:08 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:25:08 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:25:08 - root - DEBUG - Edge detection completed
2025-07-14 17:25:08 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:25:08 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 410383
2025-07-14 17:25:08 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:25:08 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:25:08 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:25:08 - root - DEBUG - Line enhancement completed
2025-07-14 17:25:08 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:25:08 - root - DEBUG - Line thickening completed
2025-07-14 17:25:08 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:25:08 - root - DEBUG - Line combination completed
2025-07-14 17:25:08 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:25:08 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:25:08 - root - INFO - Found 1006 contours
2025-07-14 17:25:08 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:25:08 - root - DEBUG - Contours drawn successfully
2025-07-14 17:25:08 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:25:08 - root - INFO - Rectangular region detection completed
2025-07-14 17:25:08 - root - INFO - Total candidate regions found: 172
2025-07-14 17:25:08 - root - DEBUG - Found 172 candidate regions
2025-07-14 17:25:08 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:25:09 - root - DEBUG - Line 1: '1 D 8.60cm' (conf: 1.000)
2025-07-14 17:25:09 - root - DEBUG - Line 2: '2 D 4.17cm' (conf: 0.999)
2025-07-14 17:25:09 - root - DEBUG - Line 3: '3 ' (conf: 0.988)
2025-07-14 17:25:09 - root - DEBUG - Line 4: 'D 3.63cm' (conf: 0.999)
2025-07-14 17:25:09 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:25:09 - root - DEBUG - Number of text lines detected: 4
2025-07-14 17:25:09 - root - DEBUG - Text extraction completed - Lines processed: 4
2025-07-14 17:25:09 - root - DEBUG - Combined text: '1 d 8.60cm 2 d 4.17cm 3  d 3.63cm'
2025-07-14 17:25:09 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:25:09 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:25:09 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:25:09 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:25:09 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:25:09 - root - DEBUG - Pattern 1 matches: 3
2025-07-14 17:25:09 - root - DEBUG - Pattern 1 found matches: ['8.60cm', '4.17cm', '3.63cm']
2025-07-14 17:25:09 - root - DEBUG - Pattern 2 matches: 3
2025-07-14 17:25:09 - root - DEBUG - Pattern 2 found matches: ['d', 'd', 'd']
2025-07-14 17:25:09 - root - DEBUG - Base score from pattern matching: 6
2025-07-14 17:25:09 - root - DEBUG - 'cm' occurrences: 3, bonus added: 6
2025-07-14 17:25:09 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:25:09 - root - INFO - Final measurement score: 12
2025-07-14 17:25:09 - root - DEBUG - Line 1: '1' (conf: 0.980)
2025-07-14 17:25:09 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:25:09 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:25:09 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:25:09 - root - DEBUG - Combined text: '1'
2025-07-14 17:25:09 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:25:09 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:25:09 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:25:09 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:25:09 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:25:09 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:25:09 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:25:09 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:25:09 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:25:09 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:25:09 - root - INFO - Final measurement score: 0
2025-07-14 17:25:10 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:25:10 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:25:10 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:25:10 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:25:10 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:25:10 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:25:10 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:25:10 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:25:10 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:25:10 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:25:10 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:25:10 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:25:10 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:25:10 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:25:10 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:25:10 - root - INFO - Final measurement score: 0
2025-07-14 17:25:10 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:25:10 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:25:10 - root - DEBUG - Top 10 score indices: [4, 0, 1, 2, 3, 5, 6, 7, 8, 9]
2025-07-14 17:25:10 - root - DEBUG - Rank 1: Index 4, Score 12.000000
2025-07-14 17:25:10 - root - DEBUG - Rank 2: Index 0, Score 0.000000
2025-07-14 17:25:10 - root - DEBUG - Rank 3: Index 1, Score 0.000000
2025-07-14 17:25:10 - root - DEBUG - Rank 4: Index 2, Score 0.000000
2025-07-14 17:25:10 - root - DEBUG - Rank 5: Index 3, Score 0.000000
2025-07-14 17:25:10 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-14 17:25:10 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-14 17:25:10 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:25:10 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:25:10 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:25:10 - root - INFO - Best candidate meets threshold (>= 4). Score: 12.000000
2025-07-14 17:25:10 - root - DEBUG - All top 10 scores:
2025-07-14 17:25:10 - root - DEBUG - Score index 4: 12.000000
2025-07-14 17:25:10 - root - DEBUG - Score index 0: 0.000000
2025-07-14 17:25:10 - root - DEBUG - Score index 1: 0.000000
2025-07-14 17:25:10 - root - DEBUG - Score index 2: 0.000000
2025-07-14 17:25:10 - root - DEBUG - Score index 3: 0.000000
2025-07-14 17:25:10 - root - DEBUG - Score index 5: 0.000000
2025-07-14 17:25:10 - root - DEBUG - Score index 6: 0.000000
2025-07-14 17:25:10 - root - DEBUG - Score index 7: 0.000000
2025-07-14 17:25:10 - root - DEBUG - Score index 8: 0.000000
2025-07-14 17:25:10 - root - DEBUG - Score index 9: 0.000000
2025-07-14 17:25:10 - root - INFO - Measurement table detection completed successfully
2025-07-14 17:25:10 - root - DEBUG - Table detection completed. Candidates found: 172
2025-07-14 17:25:10 - root - INFO - Identifying organ name from the image
2025-07-14 17:25:10 - root - INFO - Starting organ name identification
2025-07-14 17:25:10 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:25:10 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:25:10 - root - INFO - Starting organ label identification
2025-07-14 17:25:10 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:25:10 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:25:14 - root - DEBUG - Line 1: '64/22Hz' (conf: 1.000)
2025-07-14 17:25:14 - root - DEBUG - Line 2: 'Voluson' (conf: 0.983)
2025-07-14 17:25:14 - root - DEBUG - Line 3: 'Voluson' (conf: 0.990)
2025-07-14 17:25:14 - root - DEBUG - Line 4: 'Abdomen' (conf: 1.000)
2025-07-14 17:25:14 - root - DEBUG - Line 5: 'S8' (conf: 0.741)
2025-07-14 17:25:14 - root - DEBUG - Line 6: '58' (conf: 0.915)
2025-07-14 17:25:14 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.927)
2025-07-14 17:25:14 - root - DEBUG - Line 8: 'AO 100%' (conf: 0.938)
2025-07-14 17:25:14 - root - DEBUG - Line 9: 'Gn -20' (conf: 0.947)
2025-07-14 17:25:14 - root - DEBUG - Line 10: 'C6 M4' (conf: 0.883)
2025-07-14 17:25:14 - root - DEBUG - Line 11: 'FF1/E2' (conf: 0.997)
2025-07-14 17:25:14 - root - DEBUG - Line 12: 'SRIII2/CRI 2' (conf: 0.942)
2025-07-14 17:25:14 - root - DEBUG - Line 13: 'UTERUS' (conf: 0.999)
2025-07-14 17:25:14 - root - DEBUG - Line 14: 'D 8.60cm' (conf: 0.999)
2025-07-14 17:25:14 - root - DEBUG - Line 15: '2 D 4.17cm' (conf: 0.963)
2025-07-14 17:25:14 - root - DEBUG - Line 16: '3 D 3.63cm' (conf: 0.986)
2025-07-14 17:25:14 - root - DEBUG - OCR completed. Processing 16 text lines for organ keywords
2025-07-14 17:25:14 - root - DEBUG - Line 0 text: '64/22Hz'
2025-07-14 17:25:14 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-14 17:25:14 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-14 17:25:14 - root - DEBUG - Line 3 text: 'Abdomen'
2025-07-14 17:25:14 - root - DEBUG - Line 4 text: 'S8'
2025-07-14 17:25:14 - root - DEBUG - Line 5 text: '58'
2025-07-14 17:25:14 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:25:14 - root - DEBUG - Line 7 text: 'AO 100%'
2025-07-14 17:25:14 - root - DEBUG - Line 8 text: 'Gn -20'
2025-07-14 17:25:14 - root - DEBUG - Line 9 text: 'C6 M4'
2025-07-14 17:25:14 - root - DEBUG - Line 10 text: 'FF1/E2'
2025-07-14 17:25:14 - root - DEBUG - Line 11 text: 'SRIII2/CRI 2'
2025-07-14 17:25:14 - root - DEBUG - Line 12 text: 'UTERUS'
2025-07-14 17:25:14 - root - DEBUG - Line 13 text: 'D 8.60cm'
2025-07-14 17:25:14 - root - DEBUG - Line 14 text: '2 D 4.17cm'
2025-07-14 17:25:14 - root - DEBUG - Line 15 text: '3 D 3.63cm'
2025-07-14 17:25:14 - root - DEBUG - Combined text for keyword search: '64/22hz voluson voluson abdomen s8 58 hm pi 7.70 - 2.10 ao 100% gn -20 c6 m4 ff1/e2 sriii2/cri 2 uterus d 8.60cm 2 d 4.17cm 3 d 3.63cm'
2025-07-14 17:25:14 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:25:14 - root - DEBUG - Found organ keyword: 'uterus'
2025-07-14 17:25:14 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-14 17:25:14 - root - INFO - Identified organs: ['uterus']
2025-07-14 17:25:14 - root - INFO - Organ identification completed successfully: ['uterus']
2025-07-14 17:25:14 - root - DEBUG - Organ identified: ['uterus']
2025-07-14 17:25:14 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-14 17:25:14 - root - DEBUG - Number of scored candidates: 10
2025-07-14 17:25:14 - root - DEBUG - Best score index: 4
2025-07-14 17:25:14 - root - INFO - Extracting structured data from detected table
2025-07-14 17:25:14 - root - INFO - Starting table content extraction
2025-07-14 17:25:14 - root - DEBUG - Bounding box coordinates: (3110, 2056, 294, 247)
2025-07-14 17:25:14 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-14 17:25:14 - root - DEBUG - Delegating to content extractor for table processing
2025-07-14 17:25:14 - root - INFO - Starting table content extraction
2025-07-14 17:25:14 - root - DEBUG - Bounding box coordinates: (3110, 2056, 294, 247)
2025-07-14 17:25:14 - root - INFO - Performing OCR on extracted table region
2025-07-14 17:25:15 - root - DEBUG - Line 1: '1 D 8.60cm' (conf: 1.000)
2025-07-14 17:25:15 - root - DEBUG - Line 2: '2 D 4.17cm' (conf: 0.999)
2025-07-14 17:25:15 - root - DEBUG - Line 3: '3 ' (conf: 0.988)
2025-07-14 17:25:15 - root - DEBUG - Line 4: 'D 3.63cm' (conf: 0.999)
2025-07-14 17:25:15 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-14 17:25:15 - root - INFO - Extracted 4 text elements from table region
2025-07-14 17:25:15 - root - INFO - Structuring extracted text data
2025-07-14 17:25:15 - root - INFO - Starting table data structuring
2025-07-14 17:25:15 - root - DEBUG - Element 1: text='1 D 8.60cm', x=154.00, y=43.50, conf=1.000
2025-07-14 17:25:15 - root - DEBUG - Element 2: text='2 D 4.17cm', x=151.50, y=128.00, conf=0.999
2025-07-14 17:25:15 - root - DEBUG - Element 3: text='3 ', x=55.50, y=214.00, conf=0.988
2025-07-14 17:25:15 - root - DEBUG - Element 4: text='D 3.63cm', x=179.50, y=211.00, conf=0.999
2025-07-14 17:25:15 - root - DEBUG - Processing element 1/4: '1 D 8.60cm' at (154.00, 43.50)
2025-07-14 17:25:15 - root - DEBUG - Processing element 2/4: '2 D 4.17cm' at (151.50, 128.00)
2025-07-14 17:25:15 - root - DEBUG - Processing element 3/4: 'D 3.63cm' at (179.50, 211.00)
2025-07-14 17:25:15 - root - DEBUG - Processing element 4/4: '3 ' at (55.50, 214.00)
2025-07-14 17:25:15 - root - INFO - Line grouping completed - Total lines: 3
2025-07-14 17:25:15 - root - DEBUG - Processing line 1/3 with 1 elements
2025-07-14 17:25:15 - root - DEBUG - Processing word 1/1: '1 D 8.60cm'
2025-07-14 17:25:15 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:25:15 - root - DEBUG - Input text: '1 D 8.60cm'
2025-07-14 17:25:15 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:25:15 - root - DEBUG - Pattern 1 matched successfully
2025-07-14 17:25:15 - root - DEBUG - Pattern 1 groups: ('1', 'D', '8.60cm')
2025-07-14 17:25:15 - root - DEBUG - Pattern 1 result: ('1', 'D', '8.60cm')
2025-07-14 17:25:15 - root - INFO - Text split successful using pattern 1: ('1', 'D', '8.60cm')
2025-07-14 17:25:15 - root - DEBUG - Split measurement result: ('1', 'D', '8.60cm')
2025-07-14 17:25:15 - root - DEBUG - Processing line 2/3 with 1 elements
2025-07-14 17:25:15 - root - DEBUG - Processing word 1/1: '2 D 4.17cm'
2025-07-14 17:25:15 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:25:15 - root - DEBUG - Input text: '2 D 4.17cm'
2025-07-14 17:25:15 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:25:15 - root - DEBUG - Pattern 1 matched successfully
2025-07-14 17:25:15 - root - DEBUG - Pattern 1 groups: ('2', 'D', '4.17cm')
2025-07-14 17:25:15 - root - DEBUG - Pattern 1 result: ('2', 'D', '4.17cm')
2025-07-14 17:25:15 - root - INFO - Text split successful using pattern 1: ('2', 'D', '4.17cm')
2025-07-14 17:25:15 - root - DEBUG - Split measurement result: ('2', 'D', '4.17cm')
2025-07-14 17:25:15 - root - DEBUG - Processing line 3/3 with 2 elements
2025-07-14 17:25:15 - root - DEBUG - Processing word 1/2: '3 '
2025-07-14 17:25:15 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:25:15 - root - DEBUG - Input text: '3 '
2025-07-14 17:25:15 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:25:15 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:25:15 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:25:15 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:25:15 - root - DEBUG - No patterns matched for text: '3 '
2025-07-14 17:25:15 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:25:15 - root - DEBUG - Split measurement result: None
2025-07-14 17:25:15 - root - DEBUG - Processing word 2/2: 'D 3.63cm'
2025-07-14 17:25:15 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:25:15 - root - DEBUG - Input text: 'D 3.63cm'
2025-07-14 17:25:15 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:25:15 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:25:15 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:25:15 - root - DEBUG - Pattern 2 matched successfully
2025-07-14 17:25:15 - root - DEBUG - Pattern 2 groups: ('D', '3.63cm')
2025-07-14 17:25:15 - root - DEBUG - Pattern 2 result: ('D', '3.63cm')
2025-07-14 17:25:15 - root - INFO - Text split successful using pattern 2: ('D', '3.63cm')
2025-07-14 17:25:15 - root - DEBUG - Split measurement result: ('D', '3.63cm')
2025-07-14 17:25:15 - root - DEBUG - Final structured data:
2025-07-14 17:25:15 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D', '8.60cm']}'
2025-07-14 17:25:15 - root - DEBUG - Item 2 (text): '{'Value2': ['2', 'D', '4.17cm']}'
2025-07-14 17:25:15 - root - DEBUG - Item 3 (text): '{'Value3': ['3 ', 'D', '3.63cm']}'
2025-07-14 17:25:15 - root - INFO - Table content extraction completed successfully
2025-07-14 17:25:15 - root - DEBUG - Structured data keys: [{'organLabel': ['uterus']}, {'Value1': ['1', 'D', '8.60cm']}, {'Value2': ['2', 'D', '4.17cm']}, {'Value3': ['3 ', 'D', '3.63cm']}]
2025-07-14 17:25:15 - root - DEBUG - Organ identified: ['uterus']
2025-07-14 17:25:15 - root - INFO - Table extraction successful for file: API\extracted\TestingDicomZip\I0000020_20250417_103454
2025-07-14 17:25:15 - root - INFO - Organ identified: ['uterus']
2025-07-14 17:25:15 - root - DEBUG - Structured data extracted: [{'organLabel': ['uterus']}, {'Value1': ['1', 'D', '8.60cm']}, {'Value2': ['2', 'D', '4.17cm']}, {'Value3': ['3 ', 'D', '3.63cm']}]
2025-07-14 17:25:15 - root - INFO - Processing DICOM file 3/11: API\extracted\TestingDicomZip\I0000030_20250417_103454
2025-07-14 17:25:15 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:25:15 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000030_20250417_103454
2025-07-14 17:25:15 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:25:15 - root - INFO - DICOM file loaded successfully
2025-07-14 17:25:15 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:25:15 - root - INFO - Processing RGB format DICOM
2025-07-14 17:25:15 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:25:15 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:25:15 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:25:15 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:25:15 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:25:15 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:25:15 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:25:15 - root - DEBUG - Raw coordinates - minx0: [0], miny0: [66], maxx1: [1136], maxy1: [852]
2025-07-14 17:25:15 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:25:15 - root - INFO - Single region detected, using direct coordinates
2025-07-14 17:25:15 - root - DEBUG - Single region bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:25:15 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:25:15 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:25:15 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:25:15 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:25:15 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:25:15 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:25:15 - root - INFO - Initializing OCRHandler
2025-07-14 17:25:15 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:25:15 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:25:15 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:25:15 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:25:15 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:25:15 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:25:15 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:25:16 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:25:16 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:25:16 - root - INFO - Initializing TableDetector
2025-07-14 17:25:16 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:25:16 - root - DEBUG - Default detection parameters:
2025-07-14 17:25:16 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:25:16 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:25:16 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:25:16 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:25:16 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:25:16 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:25:16 - root - INFO - TableDetector initialization completed
2025-07-14 17:25:16 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:25:16 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:25:16 - root - DEBUG - Text analysis configuration:
2025-07-14 17:25:16 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:25:16 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:25:16 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:25:16 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:25:16 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:25:16 - root - INFO - Initializing ContentExtractor
2025-07-14 17:25:16 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:25:16 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:25:16 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:25:16 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:25:16 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:25:16 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:25:16 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:25:16 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:25:16 - root - DEBUG - Edge detection completed
2025-07-14 17:25:16 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:25:16 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 325111
2025-07-14 17:25:16 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:25:16 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:25:16 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:25:16 - root - DEBUG - Line enhancement completed
2025-07-14 17:25:16 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:25:16 - root - DEBUG - Line thickening completed
2025-07-14 17:25:16 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:25:16 - root - DEBUG - Line combination completed
2025-07-14 17:25:16 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:25:16 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:25:16 - root - INFO - Found 606 contours
2025-07-14 17:25:16 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:25:16 - root - DEBUG - Contours drawn successfully
2025-07-14 17:25:16 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:25:16 - root - INFO - Rectangular region detection completed
2025-07-14 17:25:16 - root - INFO - Total candidate regions found: 98
2025-07-14 17:25:16 - root - DEBUG - Found 98 candidate regions
2025-07-14 17:25:16 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:25:16 - root - DEBUG - Line 1: '1 D 0.65cm' (conf: 0.999)
2025-07-14 17:25:16 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:25:16 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:25:16 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:25:16 - root - DEBUG - Combined text: '1 d 0.65cm'
2025-07-14 17:25:16 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:25:16 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:25:16 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:25:16 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:25:16 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:25:16 - root - DEBUG - Pattern 1 matches: 1
2025-07-14 17:25:16 - root - DEBUG - Pattern 1 found matches: ['0.65cm']
2025-07-14 17:25:16 - root - DEBUG - Pattern 2 matches: 1
2025-07-14 17:25:16 - root - DEBUG - Pattern 2 found matches: ['d']
2025-07-14 17:25:16 - root - DEBUG - Base score from pattern matching: 2
2025-07-14 17:25:16 - root - DEBUG - 'cm' occurrences: 1, bonus added: 2
2025-07-14 17:25:16 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:25:16 - root - INFO - Final measurement score: 4
2025-07-14 17:25:17 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:25:17 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:25:17 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:25:17 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:25:17 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:25:17 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:25:17 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:25:17 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:25:17 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:25:17 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:25:17 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:25:17 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:25:17 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:25:17 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:25:17 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:25:17 - root - INFO - Final measurement score: 0
2025-07-14 17:25:17 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:25:17 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:25:17 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-14 17:25:17 - root - DEBUG - Rank 1: Index 0, Score 4.000000
2025-07-14 17:25:17 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-14 17:25:17 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-14 17:25:17 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-14 17:25:17 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-14 17:25:17 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-14 17:25:17 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-14 17:25:17 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:25:17 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:25:17 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:25:17 - root - INFO - Best candidate meets threshold (>= 4). Score: 4.000000
2025-07-14 17:25:17 - root - DEBUG - All top 10 scores:
2025-07-14 17:25:17 - root - DEBUG - Score index 0: 4.000000
2025-07-14 17:25:17 - root - DEBUG - Score index 1: 0.000000
2025-07-14 17:25:17 - root - DEBUG - Score index 2: 0.000000
2025-07-14 17:25:17 - root - DEBUG - Score index 3: 0.000000
2025-07-14 17:25:17 - root - DEBUG - Score index 4: 0.000000
2025-07-14 17:25:17 - root - DEBUG - Score index 5: 0.000000
2025-07-14 17:25:17 - root - DEBUG - Score index 6: 0.000000
2025-07-14 17:25:17 - root - DEBUG - Score index 7: 0.000000
2025-07-14 17:25:17 - root - DEBUG - Score index 8: 0.000000
2025-07-14 17:25:17 - root - DEBUG - Score index 9: 0.000000
2025-07-14 17:25:17 - root - INFO - Measurement table detection completed successfully
2025-07-14 17:25:17 - root - DEBUG - Table detection completed. Candidates found: 98
2025-07-14 17:25:17 - root - INFO - Identifying organ name from the image
2025-07-14 17:25:17 - root - INFO - Starting organ name identification
2025-07-14 17:25:17 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:25:17 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:25:17 - root - INFO - Starting organ label identification
2025-07-14 17:25:17 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:25:17 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:25:19 - root - DEBUG - Line 1: '64/22Hz' (conf: 1.000)
2025-07-14 17:25:19 - root - DEBUG - Line 2: 'Voluson' (conf: 1.000)
2025-07-14 17:25:19 - root - DEBUG - Line 3: 'Abdomen' (conf: 0.999)
2025-07-14 17:25:19 - root - DEBUG - Line 4: '58' (conf: 0.722)
2025-07-14 17:25:19 - root - DEBUG - Line 5: 'HM PI 7.70 - 2.10' (conf: 0.927)
2025-07-14 17:25:19 - root - DEBUG - Line 6: 'AO 100%' (conf: 0.938)
2025-07-14 17:25:19 - root - DEBUG - Line 7: 'Gn -20' (conf: 0.938)
2025-07-14 17:25:19 - root - DEBUG - Line 8: 'C6 / M4' (conf: 0.878)
2025-07-14 17:25:19 - root - DEBUG - Line 9: 'FF1/E2' (conf: 0.997)
2025-07-14 17:25:19 - root - DEBUG - Line 10: 'SRI II 2 / CRI 2' (conf: 0.984)
2025-07-14 17:25:19 - root - DEBUG - Line 11: '1 D 0.65cm' (conf: 0.994)
2025-07-14 17:25:19 - root - DEBUG - OCR completed. Processing 11 text lines for organ keywords
2025-07-14 17:25:19 - root - DEBUG - Line 0 text: '64/22Hz'
2025-07-14 17:25:19 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-14 17:25:19 - root - DEBUG - Line 2 text: 'Abdomen'
2025-07-14 17:25:19 - root - DEBUG - Line 3 text: '58'
2025-07-14 17:25:19 - root - DEBUG - Line 4 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:25:19 - root - DEBUG - Line 5 text: 'AO 100%'
2025-07-14 17:25:19 - root - DEBUG - Line 6 text: 'Gn -20'
2025-07-14 17:25:19 - root - DEBUG - Line 7 text: 'C6 / M4'
2025-07-14 17:25:19 - root - DEBUG - Line 8 text: 'FF1/E2'
2025-07-14 17:25:19 - root - DEBUG - Line 9 text: 'SRI II 2 / CRI 2'
2025-07-14 17:25:19 - root - DEBUG - Line 10 text: '1 D 0.65cm'
2025-07-14 17:25:19 - root - DEBUG - Combined text for keyword search: '64/22hz voluson abdomen 58 hm pi 7.70 - 2.10 ao 100% gn -20 c6 / m4 ff1/e2 sri ii 2 / cri 2 1 d 0.65cm'
2025-07-14 17:25:19 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:25:19 - root - INFO - Organ identification completed. Found 0 organ keywords
2025-07-14 17:25:19 - root - INFO - Identified organs: []
2025-07-14 17:25:19 - root - WARNING - No organ name identified from the image
2025-07-14 17:25:19 - root - DEBUG - Organ identified: []
2025-07-14 17:25:19 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-14 17:25:19 - root - DEBUG - Number of scored candidates: 10
2025-07-14 17:25:19 - root - DEBUG - Best score index: 0
2025-07-14 17:25:19 - root - INFO - Extracting structured data from detected table
2025-07-14 17:25:19 - root - INFO - Starting table content extraction
2025-07-14 17:25:19 - root - DEBUG - Bounding box coordinates: (3110, 2225, 294, 79)
2025-07-14 17:25:19 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-14 17:25:19 - root - DEBUG - Delegating to content extractor for table processing
2025-07-14 17:25:19 - root - INFO - Starting table content extraction
2025-07-14 17:25:19 - root - DEBUG - Bounding box coordinates: (3110, 2225, 294, 79)
2025-07-14 17:25:19 - root - INFO - Performing OCR on extracted table region
2025-07-14 17:25:20 - root - DEBUG - Line 1: '1 D 0.65cm' (conf: 0.999)
2025-07-14 17:25:20 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-14 17:25:20 - root - INFO - Extracted 1 text elements from table region
2025-07-14 17:25:20 - root - INFO - Structuring extracted text data
2025-07-14 17:25:20 - root - INFO - Starting table data structuring
2025-07-14 17:25:20 - root - DEBUG - Element 1: text='1 D 0.65cm', x=154.00, y=42.00, conf=0.999
2025-07-14 17:25:20 - root - DEBUG - Processing element 1/1: '1 D 0.65cm' at (154.00, 42.00)
2025-07-14 17:25:20 - root - INFO - Line grouping completed - Total lines: 1
2025-07-14 17:25:20 - root - DEBUG - Processing line 1/1 with 1 elements
2025-07-14 17:25:20 - root - DEBUG - Processing word 1/1: '1 D 0.65cm'
2025-07-14 17:25:20 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:25:20 - root - DEBUG - Input text: '1 D 0.65cm'
2025-07-14 17:25:20 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:25:20 - root - DEBUG - Pattern 1 matched successfully
2025-07-14 17:25:20 - root - DEBUG - Pattern 1 groups: ('1', 'D', '0.65cm')
2025-07-14 17:25:20 - root - DEBUG - Pattern 1 result: ('1', 'D', '0.65cm')
2025-07-14 17:25:20 - root - INFO - Text split successful using pattern 1: ('1', 'D', '0.65cm')
2025-07-14 17:25:20 - root - DEBUG - Split measurement result: ('1', 'D', '0.65cm')
2025-07-14 17:25:20 - root - DEBUG - Final structured data:
2025-07-14 17:25:20 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D', '0.65cm']}'
2025-07-14 17:25:20 - root - INFO - Table content extraction completed successfully
2025-07-14 17:25:20 - root - DEBUG - Structured data keys: [{'organLabel': []}, {'Value1': ['1', 'D', '0.65cm']}]
2025-07-14 17:25:20 - root - DEBUG - Organ identified: []
2025-07-14 17:25:20 - root - INFO - Table extraction successful for file: API\extracted\TestingDicomZip\I0000030_20250417_103454
2025-07-14 17:25:20 - root - INFO - Organ identified: []
2025-07-14 17:25:20 - root - DEBUG - Structured data extracted: [{'organLabel': []}, {'Value1': ['1', 'D', '0.65cm']}]
2025-07-14 17:25:20 - root - INFO - Processing DICOM file 4/11: API\extracted\TestingDicomZip\I0000040_20250417_103454
2025-07-14 17:25:20 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:25:20 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000040_20250417_103454
2025-07-14 17:25:20 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:25:20 - root - INFO - DICOM file loaded successfully
2025-07-14 17:25:20 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:25:20 - root - INFO - Processing RGB format DICOM
2025-07-14 17:25:20 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:25:20 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:25:20 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:25:20 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:25:20 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:25:20 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:25:20 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:25:20 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-14 17:25:20 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:25:20 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-14 17:25:20 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:25:20 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:25:20 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:25:20 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:25:20 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:25:20 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:25:20 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:25:20 - root - INFO - Initializing OCRHandler
2025-07-14 17:25:20 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:25:20 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:25:20 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:25:20 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:25:20 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:25:20 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:25:20 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:25:20 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:25:20 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:25:20 - root - INFO - Initializing TableDetector
2025-07-14 17:25:20 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:25:20 - root - DEBUG - Default detection parameters:
2025-07-14 17:25:20 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:25:20 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:25:20 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:25:20 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:25:20 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:25:20 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:25:20 - root - INFO - TableDetector initialization completed
2025-07-14 17:25:20 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:25:20 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:25:20 - root - DEBUG - Text analysis configuration:
2025-07-14 17:25:20 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:25:20 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:25:20 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:25:20 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:25:20 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:25:20 - root - INFO - Initializing ContentExtractor
2025-07-14 17:25:20 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:25:20 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:25:20 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:25:20 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:25:20 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:25:20 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:25:20 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:25:20 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:25:21 - root - DEBUG - Edge detection completed
2025-07-14 17:25:21 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:25:21 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 573974
2025-07-14 17:25:21 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:25:21 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:25:21 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:25:21 - root - DEBUG - Line enhancement completed
2025-07-14 17:25:21 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:25:21 - root - DEBUG - Line thickening completed
2025-07-14 17:25:21 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:25:21 - root - DEBUG - Line combination completed
2025-07-14 17:25:21 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:25:21 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:25:21 - root - INFO - Found 1070 contours
2025-07-14 17:25:21 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:25:21 - root - DEBUG - Contours drawn successfully
2025-07-14 17:25:21 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:25:21 - root - INFO - Rectangular region detection completed
2025-07-14 17:25:21 - root - INFO - Total candidate regions found: 329
2025-07-14 17:25:21 - root - DEBUG - Found 329 candidate regions
2025-07-14 17:25:21 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:25:22 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:25:22 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:25:22 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:25:22 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:25:22 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:25:22 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:25:22 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:25:22 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:25:22 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:25:22 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:25:22 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:25:22 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:25:22 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:25:22 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:25:22 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:25:22 - root - INFO - Final measurement score: 0
2025-07-14 17:25:23 - root - DEBUG - Line 1: 'M' (conf: 0.996)
2025-07-14 17:25:23 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:25:23 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:25:23 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:25:23 - root - DEBUG - Combined text: 'm'
2025-07-14 17:25:23 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:25:23 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:25:23 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:25:23 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:25:23 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:25:23 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:25:23 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:25:23 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:25:23 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:25:23 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:25:23 - root - INFO - Final measurement score: 0
2025-07-14 17:25:23 - root - DEBUG - Line 1: 'HM' (conf: 0.989)
2025-07-14 17:25:23 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:25:23 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:25:23 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:25:23 - root - DEBUG - Combined text: 'hm'
2025-07-14 17:25:23 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:25:23 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:25:23 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:25:23 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:25:23 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:25:23 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:25:23 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:25:23 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:25:23 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:25:23 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:25:23 - root - INFO - Final measurement score: 0
2025-07-14 17:25:23 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:25:23 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:25:23 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-14 17:25:23 - root - DEBUG - Rank 1: Index 0, Score 0.000000
2025-07-14 17:25:23 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-14 17:25:23 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-14 17:25:23 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-14 17:25:23 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-14 17:25:23 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-14 17:25:23 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-14 17:25:23 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:25:23 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:25:23 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:25:23 - root - WARNING - No candidates meet the minimum threshold of 4. Best score: 0.000000
2025-07-14 17:25:23 - root - INFO - Measurement table detection completed - no valid tables found
2025-07-14 17:25:23 - root - DEBUG - Table detection completed. Candidates found: 329
2025-07-14 17:25:23 - root - INFO - Identifying organ name from the image
2025-07-14 17:25:23 - root - INFO - Starting organ name identification
2025-07-14 17:25:23 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:25:23 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:25:23 - root - INFO - Starting organ label identification
2025-07-14 17:25:23 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:25:23 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:25:25 - root - DEBUG - Line 1: '64/21Hz' (conf: 1.000)
2025-07-14 17:25:25 - root - DEBUG - Line 2: 'Abdomen' (conf: 0.999)
2025-07-14 17:25:25 - root - DEBUG - Line 3: 'Voluson' (conf: 0.999)
2025-07-14 17:25:25 - root - DEBUG - Line 4: 'Voluson' (conf: 1.000)
2025-07-14 17:25:25 - root - DEBUG - Line 5: 'S8' (conf: 0.786)
2025-07-14 17:25:25 - root - DEBUG - Line 6: '58' (conf: 0.891)
2025-07-14 17:25:25 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.925)
2025-07-14 17:25:25 - root - DEBUG - Line 8: 'AO100%' (conf: 0.999)
2025-07-14 17:25:25 - root - DEBUG - Line 9: 'Gn -19' (conf: 0.929)
2025-07-14 17:25:25 - root - DEBUG - Line 10: 'C6/M4' (conf: 0.980)
2025-07-14 17:25:25 - root - DEBUG - Line 11: 'FF1/E2' (conf: 0.996)
2025-07-14 17:25:25 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.978)
2025-07-14 17:25:25 - root - DEBUG - Line 13: 'RT OVARY' (conf: 1.000)
2025-07-14 17:25:25 - root - DEBUG - OCR completed. Processing 13 text lines for organ keywords
2025-07-14 17:25:25 - root - DEBUG - Line 0 text: '64/21Hz'
2025-07-14 17:25:25 - root - DEBUG - Line 1 text: 'Abdomen'
2025-07-14 17:25:25 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-14 17:25:25 - root - DEBUG - Line 3 text: 'Voluson'
2025-07-14 17:25:25 - root - DEBUG - Line 4 text: 'S8'
2025-07-14 17:25:25 - root - DEBUG - Line 5 text: '58'
2025-07-14 17:25:25 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:25:25 - root - DEBUG - Line 7 text: 'AO100%'
2025-07-14 17:25:25 - root - DEBUG - Line 8 text: 'Gn -19'
2025-07-14 17:25:25 - root - DEBUG - Line 9 text: 'C6/M4'
2025-07-14 17:25:25 - root - DEBUG - Line 10 text: 'FF1/E2'
2025-07-14 17:25:25 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-14 17:25:25 - root - DEBUG - Line 12 text: 'RT OVARY'
2025-07-14 17:25:25 - root - DEBUG - Combined text for keyword search: '64/21hz abdomen voluson voluson s8 58 hm pi 7.70 - 2.10 ao100% gn -19 c6/m4 ff1/e2 sri ii 2 / cri 2 rt ovary'
2025-07-14 17:25:25 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:25:25 - root - DEBUG - Found organ keyword: 'rt ovary'
2025-07-14 17:25:25 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-14 17:25:25 - root - INFO - Identified organs: ['rt ovary']
2025-07-14 17:25:25 - root - INFO - Organ identification completed successfully: ['rt ovary']
2025-07-14 17:25:25 - root - DEBUG - Organ identified: ['rt ovary']
2025-07-14 17:25:25 - root - WARNING - No measurement tables detected in the ultrasound image
2025-07-14 17:25:25 - root - WARNING - No structured data extracted from file: API\extracted\TestingDicomZip\I0000040_20250417_103454
2025-07-14 17:25:25 - root - INFO - Processing DICOM file 5/11: API\extracted\TestingDicomZip\I0000060_20250417_103454
2025-07-14 17:25:25 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:25:25 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000060_20250417_103454
2025-07-14 17:25:25 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:25:25 - root - INFO - DICOM file loaded successfully
2025-07-14 17:25:25 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:25:25 - root - INFO - Processing RGB format DICOM
2025-07-14 17:25:25 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:25:25 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:25:25 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:25:25 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:25:25 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:25:25 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:25:25 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:25:25 - root - DEBUG - Raw coordinates - minx0: [0], miny0: [66], maxx1: [1136], maxy1: [852]
2025-07-14 17:25:25 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:25:25 - root - INFO - Single region detected, using direct coordinates
2025-07-14 17:25:25 - root - DEBUG - Single region bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:25:25 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:25:25 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:25:25 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:25:25 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:25:25 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:25:25 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:25:25 - root - INFO - Initializing OCRHandler
2025-07-14 17:25:25 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:25:25 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:25:25 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:25:25 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:25:25 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:25:25 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:25:25 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:25:26 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:25:26 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:25:26 - root - INFO - Initializing TableDetector
2025-07-14 17:25:26 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:25:26 - root - DEBUG - Default detection parameters:
2025-07-14 17:25:26 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:25:26 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:25:26 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:25:26 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:25:26 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:25:26 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:25:26 - root - INFO - TableDetector initialization completed
2025-07-14 17:25:26 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:25:26 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:25:26 - root - DEBUG - Text analysis configuration:
2025-07-14 17:25:26 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:25:26 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:25:26 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:25:26 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:25:26 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:25:26 - root - INFO - Initializing ContentExtractor
2025-07-14 17:25:26 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:25:26 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:25:26 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:25:26 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:25:26 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:25:26 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:25:26 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:25:26 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:25:26 - root - DEBUG - Edge detection completed
2025-07-14 17:25:26 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:25:26 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 347890
2025-07-14 17:25:26 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:25:26 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:25:26 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:25:26 - root - DEBUG - Line enhancement completed
2025-07-14 17:25:26 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:25:26 - root - DEBUG - Line thickening completed
2025-07-14 17:25:26 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:25:26 - root - DEBUG - Line combination completed
2025-07-14 17:25:26 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:25:26 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:25:26 - root - INFO - Found 755 contours
2025-07-14 17:25:26 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:25:26 - root - DEBUG - Contours drawn successfully
2025-07-14 17:25:26 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:25:26 - root - INFO - Rectangular region detection completed
2025-07-14 17:25:26 - root - INFO - Total candidate regions found: 168
2025-07-14 17:25:26 - root - DEBUG - Found 168 candidate regions
2025-07-14 17:25:26 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:25:26 - root - DEBUG - Line 1: '1 D 5.87cm' (conf: 0.985)
2025-07-14 17:25:26 - root - DEBUG - Line 2: '2 ' (conf: 0.817)
2025-07-14 17:25:26 - root - DEBUG - Line 3: 'D 4.37cm' (conf: 1.000)
2025-07-14 17:25:26 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:25:26 - root - DEBUG - Number of text lines detected: 3
2025-07-14 17:25:26 - root - DEBUG - Text extraction completed - Lines processed: 3
2025-07-14 17:25:26 - root - DEBUG - Combined text: '1 d 5.87cm 2  d 4.37cm'
2025-07-14 17:25:26 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:25:26 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:25:26 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:25:26 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:25:26 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:25:26 - root - DEBUG - Pattern 1 matches: 2
2025-07-14 17:25:26 - root - DEBUG - Pattern 1 found matches: ['5.87cm', '4.37cm']
2025-07-14 17:25:26 - root - DEBUG - Pattern 2 matches: 2
2025-07-14 17:25:26 - root - DEBUG - Pattern 2 found matches: ['d', 'd']
2025-07-14 17:25:26 - root - DEBUG - Base score from pattern matching: 4
2025-07-14 17:25:26 - root - DEBUG - 'cm' occurrences: 2, bonus added: 4
2025-07-14 17:25:26 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:25:26 - root - INFO - Final measurement score: 8
2025-07-14 17:25:27 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:25:27 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:25:27 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:25:27 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:25:27 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:25:27 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:25:27 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:25:27 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:25:27 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:25:27 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:25:27 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:25:27 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:25:27 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:25:27 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:25:27 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:25:27 - root - INFO - Final measurement score: 0
2025-07-14 17:25:27 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:25:27 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:25:27 - root - DEBUG - Top 10 score indices: [2, 0, 1, 3, 4, 5, 6, 7, 8, 9]
2025-07-14 17:25:27 - root - DEBUG - Rank 1: Index 2, Score 8.000000
2025-07-14 17:25:27 - root - DEBUG - Rank 2: Index 0, Score 0.000000
2025-07-14 17:25:27 - root - DEBUG - Rank 3: Index 1, Score 0.000000
2025-07-14 17:25:27 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-14 17:25:27 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-14 17:25:27 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-14 17:25:27 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-14 17:25:27 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:25:27 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:25:27 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:25:27 - root - INFO - Best candidate meets threshold (>= 4). Score: 8.000000
2025-07-14 17:25:27 - root - DEBUG - All top 10 scores:
2025-07-14 17:25:27 - root - DEBUG - Score index 2: 8.000000
2025-07-14 17:25:27 - root - DEBUG - Score index 0: 0.000000
2025-07-14 17:25:27 - root - DEBUG - Score index 1: 0.000000
2025-07-14 17:25:27 - root - DEBUG - Score index 3: 0.000000
2025-07-14 17:25:27 - root - DEBUG - Score index 4: 0.000000
2025-07-14 17:25:27 - root - DEBUG - Score index 5: 0.000000
2025-07-14 17:25:27 - root - DEBUG - Score index 6: 0.000000
2025-07-14 17:25:27 - root - DEBUG - Score index 7: 0.000000
2025-07-14 17:25:27 - root - DEBUG - Score index 8: 0.000000
2025-07-14 17:25:27 - root - DEBUG - Score index 9: 0.000000
2025-07-14 17:25:27 - root - INFO - Measurement table detection completed successfully
2025-07-14 17:25:27 - root - DEBUG - Table detection completed. Candidates found: 168
2025-07-14 17:25:27 - root - INFO - Identifying organ name from the image
2025-07-14 17:25:27 - root - INFO - Starting organ name identification
2025-07-14 17:25:27 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:25:27 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:25:27 - root - INFO - Starting organ label identification
2025-07-14 17:25:27 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:25:27 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:25:29 - root - DEBUG - Line 1: '64/21Hz' (conf: 1.000)
2025-07-14 17:25:29 - root - DEBUG - Line 2: 'Voluson' (conf: 1.000)
2025-07-14 17:25:29 - root - DEBUG - Line 3: 'Abdomen' (conf: 0.999)
2025-07-14 17:25:29 - root - DEBUG - Line 4: '58' (conf: 0.891)
2025-07-14 17:25:29 - root - DEBUG - Line 5: 'HM PI 7.70 - 2.10' (conf: 0.927)
2025-07-14 17:25:29 - root - DEBUG - Line 6: 'AO 100%' (conf: 0.938)
2025-07-14 17:25:29 - root - DEBUG - Line 7: 'Gn -19' (conf: 0.948)
2025-07-14 17:25:29 - root - DEBUG - Line 8: 'C6 / M4' (conf: 0.878)
2025-07-14 17:25:29 - root - DEBUG - Line 9: 'FF1/E2' (conf: 0.997)
2025-07-14 17:25:29 - root - DEBUG - Line 10: 'SRI II 2 / CRI 2' (conf: 0.984)
2025-07-14 17:25:29 - root - DEBUG - Line 11: '1 D 5.87cm' (conf: 0.999)
2025-07-14 17:25:29 - root - DEBUG - Line 12: '2 D 4.37cm' (conf: 0.974)
2025-07-14 17:25:29 - root - DEBUG - OCR completed. Processing 12 text lines for organ keywords
2025-07-14 17:25:29 - root - DEBUG - Line 0 text: '64/21Hz'
2025-07-14 17:25:29 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-14 17:25:29 - root - DEBUG - Line 2 text: 'Abdomen'
2025-07-14 17:25:29 - root - DEBUG - Line 3 text: '58'
2025-07-14 17:25:29 - root - DEBUG - Line 4 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:25:29 - root - DEBUG - Line 5 text: 'AO 100%'
2025-07-14 17:25:29 - root - DEBUG - Line 6 text: 'Gn -19'
2025-07-14 17:25:29 - root - DEBUG - Line 7 text: 'C6 / M4'
2025-07-14 17:25:29 - root - DEBUG - Line 8 text: 'FF1/E2'
2025-07-14 17:25:29 - root - DEBUG - Line 9 text: 'SRI II 2 / CRI 2'
2025-07-14 17:25:29 - root - DEBUG - Line 10 text: '1 D 5.87cm'
2025-07-14 17:25:29 - root - DEBUG - Line 11 text: '2 D 4.37cm'
2025-07-14 17:25:29 - root - DEBUG - Combined text for keyword search: '64/21hz voluson abdomen 58 hm pi 7.70 - 2.10 ao 100% gn -19 c6 / m4 ff1/e2 sri ii 2 / cri 2 1 d 5.87cm 2 d 4.37cm'
2025-07-14 17:25:29 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:25:29 - root - INFO - Organ identification completed. Found 0 organ keywords
2025-07-14 17:25:29 - root - INFO - Identified organs: []
2025-07-14 17:25:29 - root - WARNING - No organ name identified from the image
2025-07-14 17:25:29 - root - DEBUG - Organ identified: []
2025-07-14 17:25:29 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-14 17:25:29 - root - DEBUG - Number of scored candidates: 10
2025-07-14 17:25:29 - root - DEBUG - Best score index: 2
2025-07-14 17:25:29 - root - INFO - Extracting structured data from detected table
2025-07-14 17:25:29 - root - INFO - Starting table content extraction
2025-07-14 17:25:29 - root - DEBUG - Bounding box coordinates: (3110, 2141, 294, 163)
2025-07-14 17:25:29 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-14 17:25:29 - root - DEBUG - Delegating to content extractor for table processing
2025-07-14 17:25:29 - root - INFO - Starting table content extraction
2025-07-14 17:25:29 - root - DEBUG - Bounding box coordinates: (3110, 2141, 294, 163)
2025-07-14 17:25:29 - root - INFO - Performing OCR on extracted table region
2025-07-14 17:25:30 - root - DEBUG - Line 1: '1 D 5.87cm' (conf: 0.985)
2025-07-14 17:25:30 - root - DEBUG - Line 2: '2 ' (conf: 0.817)
2025-07-14 17:25:30 - root - DEBUG - Line 3: 'D 4.37cm' (conf: 1.000)
2025-07-14 17:25:30 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-14 17:25:30 - root - INFO - Extracted 3 text elements from table region
2025-07-14 17:25:30 - root - INFO - Structuring extracted text data
2025-07-14 17:25:30 - root - INFO - Starting table data structuring
2025-07-14 17:25:30 - root - DEBUG - Element 1: text='1 D 5.87cm', x=153.00, y=43.00, conf=0.985
2025-07-14 17:25:30 - root - DEBUG - Element 2: text='2 ', x=55.00, y=130.00, conf=0.817
2025-07-14 17:25:30 - root - DEBUG - Element 3: text='D 4.37cm', x=180.00, y=126.00, conf=1.000
2025-07-14 17:25:30 - root - DEBUG - Processing element 1/3: '1 D 5.87cm' at (153.00, 43.00)
2025-07-14 17:25:30 - root - DEBUG - Processing element 2/3: 'D 4.37cm' at (180.00, 126.00)
2025-07-14 17:25:30 - root - DEBUG - Processing element 3/3: '2 ' at (55.00, 130.00)
2025-07-14 17:25:30 - root - INFO - Line grouping completed - Total lines: 2
2025-07-14 17:25:30 - root - DEBUG - Processing line 1/2 with 1 elements
2025-07-14 17:25:30 - root - DEBUG - Processing word 1/1: '1 D 5.87cm'
2025-07-14 17:25:30 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:25:30 - root - DEBUG - Input text: '1 D 5.87cm'
2025-07-14 17:25:30 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:25:30 - root - DEBUG - Pattern 1 matched successfully
2025-07-14 17:25:30 - root - DEBUG - Pattern 1 groups: ('1', 'D', '5.87cm')
2025-07-14 17:25:30 - root - DEBUG - Pattern 1 result: ('1', 'D', '5.87cm')
2025-07-14 17:25:30 - root - INFO - Text split successful using pattern 1: ('1', 'D', '5.87cm')
2025-07-14 17:25:30 - root - DEBUG - Split measurement result: ('1', 'D', '5.87cm')
2025-07-14 17:25:30 - root - DEBUG - Processing line 2/2 with 2 elements
2025-07-14 17:25:30 - root - DEBUG - Processing word 1/2: '2 '
2025-07-14 17:25:30 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:25:30 - root - DEBUG - Input text: '2 '
2025-07-14 17:25:30 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:25:30 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:25:30 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:25:30 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:25:30 - root - DEBUG - No patterns matched for text: '2 '
2025-07-14 17:25:30 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:25:30 - root - DEBUG - Split measurement result: None
2025-07-14 17:25:30 - root - DEBUG - Processing word 2/2: 'D 4.37cm'
2025-07-14 17:25:30 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:25:30 - root - DEBUG - Input text: 'D 4.37cm'
2025-07-14 17:25:30 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:25:30 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:25:30 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:25:30 - root - DEBUG - Pattern 2 matched successfully
2025-07-14 17:25:30 - root - DEBUG - Pattern 2 groups: ('D', '4.37cm')
2025-07-14 17:25:30 - root - DEBUG - Pattern 2 result: ('D', '4.37cm')
2025-07-14 17:25:30 - root - INFO - Text split successful using pattern 2: ('D', '4.37cm')
2025-07-14 17:25:30 - root - DEBUG - Split measurement result: ('D', '4.37cm')
2025-07-14 17:25:30 - root - DEBUG - Final structured data:
2025-07-14 17:25:30 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D', '5.87cm']}'
2025-07-14 17:25:30 - root - DEBUG - Item 2 (text): '{'Value2': ['2 ', 'D', '4.37cm']}'
2025-07-14 17:25:30 - root - INFO - Table content extraction completed successfully
2025-07-14 17:25:30 - root - DEBUG - Structured data keys: [{'organLabel': []}, {'Value1': ['1', 'D', '5.87cm']}, {'Value2': ['2 ', 'D', '4.37cm']}]
2025-07-14 17:25:30 - root - DEBUG - Organ identified: []
2025-07-14 17:25:30 - root - INFO - Table extraction successful for file: API\extracted\TestingDicomZip\I0000060_20250417_103454
2025-07-14 17:25:30 - root - INFO - Organ identified: []
2025-07-14 17:25:30 - root - DEBUG - Structured data extracted: [{'organLabel': []}, {'Value1': ['1', 'D', '5.87cm']}, {'Value2': ['2 ', 'D', '4.37cm']}]
2025-07-14 17:25:30 - root - INFO - Processing DICOM file 6/11: API\extracted\TestingDicomZip\I0000070_20250417_103454
2025-07-14 17:25:30 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:25:30 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000070_20250417_103454
2025-07-14 17:25:30 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:25:30 - root - INFO - DICOM file loaded successfully
2025-07-14 17:25:30 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:25:30 - root - INFO - Processing RGB format DICOM
2025-07-14 17:25:30 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:25:30 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:25:30 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:25:30 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:25:30 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:25:30 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:25:30 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:25:30 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-14 17:25:30 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:25:30 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-14 17:25:30 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:25:30 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:25:30 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:25:30 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:25:30 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:25:30 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:25:30 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:25:30 - root - INFO - Initializing OCRHandler
2025-07-14 17:25:30 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:25:30 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:25:30 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:25:30 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:25:30 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:25:30 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:25:30 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:25:31 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:25:31 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:25:31 - root - INFO - Initializing TableDetector
2025-07-14 17:25:31 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:25:31 - root - DEBUG - Default detection parameters:
2025-07-14 17:25:31 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:25:31 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:25:31 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:25:31 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:25:31 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:25:31 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:25:31 - root - INFO - TableDetector initialization completed
2025-07-14 17:25:31 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:25:31 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:25:31 - root - DEBUG - Text analysis configuration:
2025-07-14 17:25:31 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:25:31 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:25:31 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:25:31 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:25:31 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:25:31 - root - INFO - Initializing ContentExtractor
2025-07-14 17:25:31 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:25:31 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:25:31 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:25:31 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:25:31 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:25:31 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:25:31 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:25:31 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:25:31 - root - DEBUG - Edge detection completed
2025-07-14 17:25:31 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:25:31 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 539695
2025-07-14 17:25:31 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:25:31 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:25:31 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:25:31 - root - DEBUG - Line enhancement completed
2025-07-14 17:25:31 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:25:31 - root - DEBUG - Line thickening completed
2025-07-14 17:25:31 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:25:31 - root - DEBUG - Line combination completed
2025-07-14 17:25:31 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:25:31 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:25:31 - root - INFO - Found 988 contours
2025-07-14 17:25:31 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:25:31 - root - DEBUG - Contours drawn successfully
2025-07-14 17:25:31 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:25:31 - root - INFO - Rectangular region detection completed
2025-07-14 17:25:31 - root - INFO - Total candidate regions found: 308
2025-07-14 17:25:31 - root - DEBUG - Found 308 candidate regions
2025-07-14 17:25:31 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:25:33 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:25:33 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:25:33 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:25:33 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:25:33 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:25:33 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:25:33 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:25:33 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:25:33 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:25:33 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:25:33 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:25:33 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:25:33 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:25:33 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:25:33 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:25:33 - root - INFO - Final measurement score: 0
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:117]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_header_field with data[119:131]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_header_value with data[133:161]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[165:131072]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:262144]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:227304]
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-07-14 17:27:36 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-07-14 17:27:36 - root - INFO - === Starting DICOM Ultrasound Processing Session ===
2025-07-14 17:27:36 - root - INFO - Processing DICOM directory: API\extracted\TestingDicomZip
2025-07-14 17:27:36 - root - INFO - Reading DICOM files from directory
2025-07-14 17:27:36 - root - INFO - Starting to read DICOM directory: API\extracted\TestingDicomZip
2025-07-14 17:27:36 - root - DEBUG - Listing files in directory
2025-07-14 17:27:36 - root - INFO - Found 11 files in directory to process
2025-07-14 17:27:36 - root - DEBUG - Processing file 1/11: I0000010_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000010_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:27:36 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000010_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Added valid DICOM file to list: I0000010_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Processing file 2/11: I0000020_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000020_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:27:36 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000020_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Added valid DICOM file to list: I0000020_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Processing file 3/11: I0000030_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000030_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:27:36 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000030_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Added valid DICOM file to list: I0000030_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Processing file 4/11: I0000040_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000040_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:27:36 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000040_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Added valid DICOM file to list: I0000040_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Processing file 5/11: I0000060_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000060_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:27:36 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000060_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Added valid DICOM file to list: I0000060_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Processing file 6/11: I0000070_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000070_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:27:36 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000070_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Added valid DICOM file to list: I0000070_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Processing file 7/11: I0000080_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000080_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:27:36 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000080_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Added valid DICOM file to list: I0000080_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Processing file 8/11: I0000090_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000090_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:27:36 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000090_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Added valid DICOM file to list: I0000090_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Processing file 9/11: I0000100_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000100_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:27:36 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000100_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Added valid DICOM file to list: I0000100_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Processing file 10/11: I0000110_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000110_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:27:36 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000110_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Added valid DICOM file to list: I0000110_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Processing file 11/11: I0000120_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Checking if file is valid DICOM: API\extracted\TestingDicomZip\I0000120_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Attempting to read DICOM file with pydicom
2025-07-14 17:27:36 - root - DEBUG - File successfully validated as DICOM: API\extracted\TestingDicomZip\I0000120_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Added valid DICOM file to list: I0000120_20250417_103454
2025-07-14 17:27:36 - root - INFO - DICOM file validation completed. Found 11 valid DICOM files
2025-07-14 17:27:36 - root - INFO - Extracting scan type from first DICOM file
2025-07-14 17:27:36 - root - DEBUG - Extracting scan type from DICOM file: API\extracted\TestingDicomZip\I0000010_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Reading DICOM metadata for scan type extraction
2025-07-14 17:27:36 - root - INFO - Scan type extracted successfully: PELVIS/US
2025-07-14 17:27:36 - root - DEBUG - Scan type from file API\extracted\TestingDicomZip\I0000010_20250417_103454: PELVIS/US
2025-07-14 17:27:36 - root - INFO - Successfully extracted scan type: {'PatientName': 'DHIBANA.C.K', 'PatientID': 'CICPL13880', 'PatientAge': '19921017', 'PatientGender': 'F', 'HospitalName': 'CLARITY IMAGING CENTRE', 'PhysicianName': '^Dr.^Geetha^Raj.^M.B.B.S.,^DNB^(', 'scanType': 'PELVIS/US', 'scanDate': '20250417', 'scanTime': '103454', 'scanModality': 'US'}
2025-07-14 17:27:36 - root - INFO - Directory processing completed successfully
2025-07-14 17:27:36 - root - DEBUG - Final results - DICOM files: 11, Scan type: {'PatientName': 'DHIBANA.C.K', 'PatientID': 'CICPL13880', 'PatientAge': '19921017', 'PatientGender': 'F', 'HospitalName': 'CLARITY IMAGING CENTRE', 'PhysicianName': '^Dr.^Geetha^Raj.^M.B.B.S.,^DNB^(', 'scanType': 'PELVIS/US', 'scanDate': '20250417', 'scanTime': '103454', 'scanModality': 'US'}
2025-07-14 17:27:36 - root - INFO - Found 11 DICOM files to process
2025-07-14 17:27:36 - root - DEBUG - metaData: {'PatientName': 'DHIBANA.C.K', 'PatientID': 'CICPL13880', 'PatientAge': '19921017', 'PatientGender': 'F', 'HospitalName': 'CLARITY IMAGING CENTRE', 'PhysicianName': '^Dr.^Geetha^Raj.^M.B.B.S.,^DNB^(', 'scanType': 'PELVIS/US', 'scanDate': '20250417', 'scanTime': '103454', 'scanModality': 'US'}
2025-07-14 17:27:36 - root - INFO - Processing DICOM file 1/11: API\extracted\TestingDicomZip\I0000010_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:27:36 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000010_20250417_103454
2025-07-14 17:27:36 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:27:36 - root - INFO - DICOM file loaded successfully
2025-07-14 17:27:36 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:27:36 - root - INFO - Processing RGB format DICOM
2025-07-14 17:27:36 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:27:36 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:27:36 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:27:36 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:27:36 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:27:36 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:27:36 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:27:36 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-14 17:27:36 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:27:36 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-14 17:27:36 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:27:36 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:27:36 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:27:36 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:27:36 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:27:36 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:27:36 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:27:36 - root - INFO - Initializing OCRHandler
2025-07-14 17:27:36 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:27:36 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:27:36 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:27:36 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:27:36 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:27:36 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:27:36 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:27:37 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:27:37 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:27:37 - root - INFO - Initializing TableDetector
2025-07-14 17:27:37 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:27:37 - root - DEBUG - Default detection parameters:
2025-07-14 17:27:37 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:27:37 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:27:37 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:27:37 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:27:37 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:27:37 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:27:37 - root - INFO - TableDetector initialization completed
2025-07-14 17:27:37 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:27:37 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:27:37 - root - DEBUG - Text analysis configuration:
2025-07-14 17:27:37 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:27:37 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:27:37 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:27:37 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:27:37 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:27:37 - root - INFO - Initializing ContentExtractor
2025-07-14 17:27:37 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:27:37 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:27:37 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:27:37 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:27:37 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:27:37 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:27:37 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:27:37 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:27:37 - root - DEBUG - Edge detection completed
2025-07-14 17:27:37 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:27:37 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 466792
2025-07-14 17:27:37 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:27:37 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:27:37 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:27:37 - root - DEBUG - Line enhancement completed
2025-07-14 17:27:37 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:27:37 - root - DEBUG - Line thickening completed
2025-07-14 17:27:37 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:27:37 - root - DEBUG - Line combination completed
2025-07-14 17:27:37 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:27:37 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:27:37 - root - INFO - Found 830 contours
2025-07-14 17:27:37 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:27:37 - root - DEBUG - Contours drawn successfully
2025-07-14 17:27:37 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:27:37 - root - INFO - Rectangular region detection completed
2025-07-14 17:27:37 - root - INFO - Total candidate regions found: 179
2025-07-14 17:27:37 - root - DEBUG - Found 179 candidate regions
2025-07-14 17:27:37 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:27:38 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:27:38 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:27:38 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:27:38 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:27:38 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:27:38 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:27:38 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:27:38 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:27:38 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:27:38 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:27:38 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:27:38 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:27:38 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:27:38 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:27:38 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:27:38 - root - INFO - Final measurement score: 0
2025-07-14 17:27:38 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:27:38 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:27:38 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-14 17:27:38 - root - DEBUG - Rank 1: Index 0, Score 0.000000
2025-07-14 17:27:38 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-14 17:27:38 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-14 17:27:38 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-14 17:27:38 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-14 17:27:38 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-14 17:27:38 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-14 17:27:38 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:27:38 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:27:38 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:27:38 - root - WARNING - No candidates meet the minimum threshold of 4. Best score: 0.000000
2025-07-14 17:27:38 - root - INFO - Measurement table detection completed - no valid tables found
2025-07-14 17:27:38 - root - DEBUG - Table detection completed. Candidates found: 179
2025-07-14 17:27:38 - root - INFO - Identifying organ name from the image
2025-07-14 17:27:38 - root - INFO - Starting organ name identification
2025-07-14 17:27:38 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:27:38 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:27:38 - root - INFO - Starting organ label identification
2025-07-14 17:27:38 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:27:38 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:27:41 - root - DEBUG - Line 1: '64/22Hz' (conf: 1.000)
2025-07-14 17:27:41 - root - DEBUG - Line 2: 'Voluson' (conf: 1.000)
2025-07-14 17:27:41 - root - DEBUG - Line 3: 'Voluson' (conf: 0.994)
2025-07-14 17:27:41 - root - DEBUG - Line 4: 'Abdomen' (conf: 1.000)
2025-07-14 17:27:41 - root - DEBUG - Line 5: 'S8' (conf: 0.741)
2025-07-14 17:27:41 - root - DEBUG - Line 6: '58' (conf: 0.915)
2025-07-14 17:27:41 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.927)
2025-07-14 17:27:41 - root - DEBUG - Line 8: 'AO 100%' (conf: 0.938)
2025-07-14 17:27:41 - root - DEBUG - Line 9: 'Gn -20' (conf: 0.920)
2025-07-14 17:27:41 - root - DEBUG - Line 10: 'C6 M4' (conf: 0.883)
2025-07-14 17:27:41 - root - DEBUG - Line 11: 'FF1/E2' (conf: 0.997)
2025-07-14 17:27:41 - root - DEBUG - Line 12: 'SRII2/CRI 2' (conf: 0.961)
2025-07-14 17:27:41 - root - DEBUG - Line 13: 'UTERUS' (conf: 0.999)
2025-07-14 17:27:41 - root - DEBUG - OCR completed. Processing 13 text lines for organ keywords
2025-07-14 17:27:41 - root - DEBUG - Line 0 text: '64/22Hz'
2025-07-14 17:27:41 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-14 17:27:41 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-14 17:27:41 - root - DEBUG - Line 3 text: 'Abdomen'
2025-07-14 17:27:41 - root - DEBUG - Line 4 text: 'S8'
2025-07-14 17:27:41 - root - DEBUG - Line 5 text: '58'
2025-07-14 17:27:41 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:27:41 - root - DEBUG - Line 7 text: 'AO 100%'
2025-07-14 17:27:41 - root - DEBUG - Line 8 text: 'Gn -20'
2025-07-14 17:27:41 - root - DEBUG - Line 9 text: 'C6 M4'
2025-07-14 17:27:41 - root - DEBUG - Line 10 text: 'FF1/E2'
2025-07-14 17:27:41 - root - DEBUG - Line 11 text: 'SRII2/CRI 2'
2025-07-14 17:27:41 - root - DEBUG - Line 12 text: 'UTERUS'
2025-07-14 17:27:41 - root - DEBUG - Combined text for keyword search: '64/22hz voluson voluson abdomen s8 58 hm pi 7.70 - 2.10 ao 100% gn -20 c6 m4 ff1/e2 srii2/cri 2 uterus'
2025-07-14 17:27:41 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:27:41 - root - DEBUG - Found organ keyword: 'uterus'
2025-07-14 17:27:41 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-14 17:27:41 - root - INFO - Identified organs: ['uterus']
2025-07-14 17:27:41 - root - INFO - Organ identification completed successfully: ['uterus']
2025-07-14 17:27:41 - root - DEBUG - Organ identified: ['uterus']
2025-07-14 17:27:41 - root - WARNING - No measurement tables detected in the ultrasound image
2025-07-14 17:27:41 - root - WARNING - No structured data extracted from file: API\extracted\TestingDicomZip\I0000010_20250417_103454
2025-07-14 17:27:41 - root - INFO - Processing DICOM file 2/11: API\extracted\TestingDicomZip\I0000020_20250417_103454
2025-07-14 17:27:41 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:27:41 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000020_20250417_103454
2025-07-14 17:27:41 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:27:41 - root - INFO - DICOM file loaded successfully
2025-07-14 17:27:41 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:27:41 - root - INFO - Processing RGB format DICOM
2025-07-14 17:27:41 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:27:41 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:27:41 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:27:41 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:27:41 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:27:41 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:27:41 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:27:41 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-14 17:27:41 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:27:41 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-14 17:27:41 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:27:41 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:27:41 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:27:41 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:27:41 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:27:41 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:27:41 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:27:41 - root - INFO - Initializing OCRHandler
2025-07-14 17:27:41 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:27:41 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:27:41 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:27:41 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:27:41 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:27:41 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:27:41 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:27:42 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:27:42 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:27:42 - root - INFO - Initializing TableDetector
2025-07-14 17:27:42 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:27:42 - root - DEBUG - Default detection parameters:
2025-07-14 17:27:42 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:27:42 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:27:42 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:27:42 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:27:42 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:27:42 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:27:42 - root - INFO - TableDetector initialization completed
2025-07-14 17:27:42 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:27:42 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:27:42 - root - DEBUG - Text analysis configuration:
2025-07-14 17:27:42 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:27:42 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:27:42 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:27:42 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:27:42 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:27:42 - root - INFO - Initializing ContentExtractor
2025-07-14 17:27:42 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:27:42 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:27:42 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:27:42 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:27:42 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:27:42 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:27:42 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:27:42 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:27:42 - root - DEBUG - Edge detection completed
2025-07-14 17:27:42 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:27:42 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 410383
2025-07-14 17:27:42 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:27:42 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:27:42 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:27:42 - root - DEBUG - Line enhancement completed
2025-07-14 17:27:42 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:27:42 - root - DEBUG - Line thickening completed
2025-07-14 17:27:42 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:27:42 - root - DEBUG - Line combination completed
2025-07-14 17:27:42 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:27:42 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:27:42 - root - INFO - Found 1006 contours
2025-07-14 17:27:42 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:27:42 - root - DEBUG - Contours drawn successfully
2025-07-14 17:27:42 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:27:42 - root - INFO - Rectangular region detection completed
2025-07-14 17:27:42 - root - INFO - Total candidate regions found: 172
2025-07-14 17:27:42 - root - DEBUG - Found 172 candidate regions
2025-07-14 17:27:42 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:27:43 - root - DEBUG - Line 1: '1 D 8.60cm' (conf: 1.000)
2025-07-14 17:27:43 - root - DEBUG - Line 2: '2 D 4.17cm' (conf: 0.999)
2025-07-14 17:27:43 - root - DEBUG - Line 3: '3 ' (conf: 0.988)
2025-07-14 17:27:43 - root - DEBUG - Line 4: 'D 3.63cm' (conf: 0.999)
2025-07-14 17:27:43 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:27:43 - root - DEBUG - Number of text lines detected: 4
2025-07-14 17:27:43 - root - DEBUG - Text extraction completed - Lines processed: 4
2025-07-14 17:27:43 - root - DEBUG - Combined text: '1 d 8.60cm 2 d 4.17cm 3  d 3.63cm'
2025-07-14 17:27:43 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:27:43 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:27:43 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:27:43 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:27:43 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:27:43 - root - DEBUG - Pattern 1 matches: 3
2025-07-14 17:27:43 - root - DEBUG - Pattern 1 found matches: ['8.60cm', '4.17cm', '3.63cm']
2025-07-14 17:27:43 - root - DEBUG - Pattern 2 matches: 3
2025-07-14 17:27:43 - root - DEBUG - Pattern 2 found matches: ['d', 'd', 'd']
2025-07-14 17:27:43 - root - DEBUG - Base score from pattern matching: 6
2025-07-14 17:27:43 - root - DEBUG - 'cm' occurrences: 3, bonus added: 6
2025-07-14 17:27:43 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:27:43 - root - INFO - Final measurement score: 12
2025-07-14 17:27:43 - root - DEBUG - Line 1: '1' (conf: 0.980)
2025-07-14 17:27:43 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:27:43 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:27:43 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:27:43 - root - DEBUG - Combined text: '1'
2025-07-14 17:27:43 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:27:43 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:27:43 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:27:43 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:27:43 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:27:43 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:27:43 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:27:43 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:27:43 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:27:43 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:27:43 - root - INFO - Final measurement score: 0
2025-07-14 17:27:45 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:27:45 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:27:45 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:27:45 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:27:45 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:27:45 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:27:45 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:27:45 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:27:45 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:27:45 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:27:45 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:27:45 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:27:45 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:27:45 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:27:45 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:27:45 - root - INFO - Final measurement score: 0
2025-07-14 17:27:45 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:27:45 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:27:45 - root - DEBUG - Top 10 score indices: [4, 0, 1, 2, 3, 5, 6, 7, 8, 9]
2025-07-14 17:27:45 - root - DEBUG - Rank 1: Index 4, Score 12.000000
2025-07-14 17:27:45 - root - DEBUG - Rank 2: Index 0, Score 0.000000
2025-07-14 17:27:45 - root - DEBUG - Rank 3: Index 1, Score 0.000000
2025-07-14 17:27:45 - root - DEBUG - Rank 4: Index 2, Score 0.000000
2025-07-14 17:27:45 - root - DEBUG - Rank 5: Index 3, Score 0.000000
2025-07-14 17:27:45 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-14 17:27:45 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-14 17:27:45 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:27:45 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:27:45 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:27:45 - root - INFO - Best candidate meets threshold (>= 4). Score: 12.000000
2025-07-14 17:27:45 - root - DEBUG - All top 10 scores:
2025-07-14 17:27:45 - root - DEBUG - Score index 4: 12.000000
2025-07-14 17:27:45 - root - DEBUG - Score index 0: 0.000000
2025-07-14 17:27:45 - root - DEBUG - Score index 1: 0.000000
2025-07-14 17:27:45 - root - DEBUG - Score index 2: 0.000000
2025-07-14 17:27:45 - root - DEBUG - Score index 3: 0.000000
2025-07-14 17:27:45 - root - DEBUG - Score index 5: 0.000000
2025-07-14 17:27:45 - root - DEBUG - Score index 6: 0.000000
2025-07-14 17:27:45 - root - DEBUG - Score index 7: 0.000000
2025-07-14 17:27:45 - root - DEBUG - Score index 8: 0.000000
2025-07-14 17:27:45 - root - DEBUG - Score index 9: 0.000000
2025-07-14 17:27:45 - root - INFO - Measurement table detection completed successfully
2025-07-14 17:27:45 - root - DEBUG - Table detection completed. Candidates found: 172
2025-07-14 17:27:45 - root - INFO - Identifying organ name from the image
2025-07-14 17:27:45 - root - INFO - Starting organ name identification
2025-07-14 17:27:45 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:27:45 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:27:45 - root - INFO - Starting organ label identification
2025-07-14 17:27:45 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:27:45 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:27:48 - root - DEBUG - Line 1: '64/22Hz' (conf: 1.000)
2025-07-14 17:27:48 - root - DEBUG - Line 2: 'Voluson' (conf: 0.983)
2025-07-14 17:27:48 - root - DEBUG - Line 3: 'Voluson' (conf: 0.990)
2025-07-14 17:27:48 - root - DEBUG - Line 4: 'Abdomen' (conf: 1.000)
2025-07-14 17:27:48 - root - DEBUG - Line 5: 'S8' (conf: 0.741)
2025-07-14 17:27:48 - root - DEBUG - Line 6: '58' (conf: 0.915)
2025-07-14 17:27:48 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.927)
2025-07-14 17:27:48 - root - DEBUG - Line 8: 'AO 100%' (conf: 0.938)
2025-07-14 17:27:48 - root - DEBUG - Line 9: 'Gn -20' (conf: 0.947)
2025-07-14 17:27:48 - root - DEBUG - Line 10: 'C6 M4' (conf: 0.883)
2025-07-14 17:27:48 - root - DEBUG - Line 11: 'FF1/E2' (conf: 0.997)
2025-07-14 17:27:48 - root - DEBUG - Line 12: 'SRIII2/CRI 2' (conf: 0.942)
2025-07-14 17:27:48 - root - DEBUG - Line 13: 'UTERUS' (conf: 0.999)
2025-07-14 17:27:48 - root - DEBUG - Line 14: 'D 8.60cm' (conf: 0.999)
2025-07-14 17:27:48 - root - DEBUG - Line 15: '2 D 4.17cm' (conf: 0.963)
2025-07-14 17:27:48 - root - DEBUG - Line 16: '3 D 3.63cm' (conf: 0.986)
2025-07-14 17:27:48 - root - DEBUG - OCR completed. Processing 16 text lines for organ keywords
2025-07-14 17:27:48 - root - DEBUG - Line 0 text: '64/22Hz'
2025-07-14 17:27:48 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-14 17:27:48 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-14 17:27:48 - root - DEBUG - Line 3 text: 'Abdomen'
2025-07-14 17:27:48 - root - DEBUG - Line 4 text: 'S8'
2025-07-14 17:27:48 - root - DEBUG - Line 5 text: '58'
2025-07-14 17:27:48 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:27:48 - root - DEBUG - Line 7 text: 'AO 100%'
2025-07-14 17:27:48 - root - DEBUG - Line 8 text: 'Gn -20'
2025-07-14 17:27:48 - root - DEBUG - Line 9 text: 'C6 M4'
2025-07-14 17:27:48 - root - DEBUG - Line 10 text: 'FF1/E2'
2025-07-14 17:27:48 - root - DEBUG - Line 11 text: 'SRIII2/CRI 2'
2025-07-14 17:27:48 - root - DEBUG - Line 12 text: 'UTERUS'
2025-07-14 17:27:48 - root - DEBUG - Line 13 text: 'D 8.60cm'
2025-07-14 17:27:48 - root - DEBUG - Line 14 text: '2 D 4.17cm'
2025-07-14 17:27:48 - root - DEBUG - Line 15 text: '3 D 3.63cm'
2025-07-14 17:27:48 - root - DEBUG - Combined text for keyword search: '64/22hz voluson voluson abdomen s8 58 hm pi 7.70 - 2.10 ao 100% gn -20 c6 m4 ff1/e2 sriii2/cri 2 uterus d 8.60cm 2 d 4.17cm 3 d 3.63cm'
2025-07-14 17:27:48 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:27:48 - root - DEBUG - Found organ keyword: 'uterus'
2025-07-14 17:27:48 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-14 17:27:48 - root - INFO - Identified organs: ['uterus']
2025-07-14 17:27:48 - root - INFO - Organ identification completed successfully: ['uterus']
2025-07-14 17:27:48 - root - DEBUG - Organ identified: ['uterus']
2025-07-14 17:27:48 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-14 17:27:48 - root - DEBUG - Number of scored candidates: 10
2025-07-14 17:27:48 - root - DEBUG - Best score index: 4
2025-07-14 17:27:48 - root - INFO - Extracting structured data from detected table
2025-07-14 17:27:48 - root - INFO - Starting table content extraction
2025-07-14 17:27:48 - root - DEBUG - Bounding box coordinates: (3110, 2056, 294, 247)
2025-07-14 17:27:48 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-14 17:27:48 - root - DEBUG - Delegating to content extractor for table processing
2025-07-14 17:27:48 - root - INFO - Starting table content extraction
2025-07-14 17:27:48 - root - DEBUG - Bounding box coordinates: (3110, 2056, 294, 247)
2025-07-14 17:27:48 - root - INFO - Performing OCR on extracted table region
2025-07-14 17:27:49 - root - DEBUG - Line 1: '1 D 8.60cm' (conf: 1.000)
2025-07-14 17:27:49 - root - DEBUG - Line 2: '2 D 4.17cm' (conf: 0.999)
2025-07-14 17:27:49 - root - DEBUG - Line 3: '3 ' (conf: 0.988)
2025-07-14 17:27:49 - root - DEBUG - Line 4: 'D 3.63cm' (conf: 0.999)
2025-07-14 17:27:49 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-14 17:27:49 - root - INFO - Extracted 4 text elements from table region
2025-07-14 17:27:49 - root - INFO - Structuring extracted text data
2025-07-14 17:27:49 - root - INFO - Starting table data structuring
2025-07-14 17:27:49 - root - DEBUG - Element 1: text='1 D 8.60cm', x=154.00, y=43.50, conf=1.000
2025-07-14 17:27:49 - root - DEBUG - Element 2: text='2 D 4.17cm', x=151.50, y=128.00, conf=0.999
2025-07-14 17:27:49 - root - DEBUG - Element 3: text='3 ', x=55.50, y=214.00, conf=0.988
2025-07-14 17:27:49 - root - DEBUG - Element 4: text='D 3.63cm', x=179.50, y=211.00, conf=0.999
2025-07-14 17:27:49 - root - DEBUG - Processing element 1/4: '1 D 8.60cm' at (154.00, 43.50)
2025-07-14 17:27:49 - root - DEBUG - Processing element 2/4: '2 D 4.17cm' at (151.50, 128.00)
2025-07-14 17:27:49 - root - DEBUG - Processing element 3/4: 'D 3.63cm' at (179.50, 211.00)
2025-07-14 17:27:49 - root - DEBUG - Processing element 4/4: '3 ' at (55.50, 214.00)
2025-07-14 17:27:49 - root - INFO - Line grouping completed - Total lines: 3
2025-07-14 17:27:49 - root - DEBUG - Processing line 1/3 with 1 elements
2025-07-14 17:27:49 - root - DEBUG - Processing word 1/1: '1 D 8.60cm'
2025-07-14 17:27:49 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:27:49 - root - DEBUG - Input text: '1 D 8.60cm'
2025-07-14 17:27:49 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:27:49 - root - DEBUG - Pattern 1 matched successfully
2025-07-14 17:27:49 - root - DEBUG - Pattern 1 groups: ('1', 'D', '8.60cm')
2025-07-14 17:27:49 - root - DEBUG - Pattern 1 result: ('1', 'D', '8.60cm')
2025-07-14 17:27:49 - root - INFO - Text split successful using pattern 1: ('1', 'D', '8.60cm')
2025-07-14 17:27:49 - root - DEBUG - Split measurement result: ('1', 'D', '8.60cm')
2025-07-14 17:27:49 - root - DEBUG - Processing line 2/3 with 1 elements
2025-07-14 17:27:49 - root - DEBUG - Processing word 1/1: '2 D 4.17cm'
2025-07-14 17:27:49 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:27:49 - root - DEBUG - Input text: '2 D 4.17cm'
2025-07-14 17:27:49 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:27:49 - root - DEBUG - Pattern 1 matched successfully
2025-07-14 17:27:49 - root - DEBUG - Pattern 1 groups: ('2', 'D', '4.17cm')
2025-07-14 17:27:49 - root - DEBUG - Pattern 1 result: ('2', 'D', '4.17cm')
2025-07-14 17:27:49 - root - INFO - Text split successful using pattern 1: ('2', 'D', '4.17cm')
2025-07-14 17:27:49 - root - DEBUG - Split measurement result: ('2', 'D', '4.17cm')
2025-07-14 17:27:49 - root - DEBUG - Processing line 3/3 with 2 elements
2025-07-14 17:27:49 - root - DEBUG - Processing word 1/2: '3 '
2025-07-14 17:27:49 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:27:49 - root - DEBUG - Input text: '3 '
2025-07-14 17:27:49 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:27:49 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:27:49 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:27:49 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:27:49 - root - DEBUG - No patterns matched for text: '3 '
2025-07-14 17:27:49 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:27:49 - root - DEBUG - Split measurement result: None
2025-07-14 17:27:49 - root - DEBUG - Processing word 2/2: 'D 3.63cm'
2025-07-14 17:27:49 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:27:49 - root - DEBUG - Input text: 'D 3.63cm'
2025-07-14 17:27:49 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:27:49 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:27:49 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:27:49 - root - DEBUG - Pattern 2 matched successfully
2025-07-14 17:27:49 - root - DEBUG - Pattern 2 groups: ('D', '3.63cm')
2025-07-14 17:27:49 - root - DEBUG - Pattern 2 result: ('D', '3.63cm')
2025-07-14 17:27:49 - root - INFO - Text split successful using pattern 2: ('D', '3.63cm')
2025-07-14 17:27:49 - root - DEBUG - Split measurement result: ('D', '3.63cm')
2025-07-14 17:27:49 - root - DEBUG - Final structured data:
2025-07-14 17:27:49 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D', '8.60cm']}'
2025-07-14 17:27:49 - root - DEBUG - Item 2 (text): '{'Value2': ['2', 'D', '4.17cm']}'
2025-07-14 17:27:49 - root - DEBUG - Item 3 (text): '{'Value3': ['3 ', 'D', '3.63cm']}'
2025-07-14 17:27:49 - root - INFO - Table content extraction completed successfully
2025-07-14 17:27:49 - root - DEBUG - Structured data keys: [{'organLabel': ['uterus']}, {'Value1': ['1', 'D', '8.60cm']}, {'Value2': ['2', 'D', '4.17cm']}, {'Value3': ['3 ', 'D', '3.63cm']}]
2025-07-14 17:27:49 - root - DEBUG - Organ identified: ['uterus']
2025-07-14 17:27:49 - root - INFO - Table extraction successful for file: API\extracted\TestingDicomZip\I0000020_20250417_103454
2025-07-14 17:27:49 - root - INFO - Organ identified: ['uterus']
2025-07-14 17:27:49 - root - DEBUG - Structured data extracted: [{'organLabel': ['uterus']}, {'Value1': ['1', 'D', '8.60cm']}, {'Value2': ['2', 'D', '4.17cm']}, {'Value3': ['3 ', 'D', '3.63cm']}]
2025-07-14 17:27:49 - root - INFO - Processing DICOM file 3/11: API\extracted\TestingDicomZip\I0000030_20250417_103454
2025-07-14 17:27:49 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:27:49 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000030_20250417_103454
2025-07-14 17:27:49 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:27:49 - root - INFO - DICOM file loaded successfully
2025-07-14 17:27:49 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:27:49 - root - INFO - Processing RGB format DICOM
2025-07-14 17:27:49 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:27:49 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:27:49 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:27:49 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:27:49 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:27:49 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:27:49 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:27:49 - root - DEBUG - Raw coordinates - minx0: [0], miny0: [66], maxx1: [1136], maxy1: [852]
2025-07-14 17:27:49 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:27:49 - root - INFO - Single region detected, using direct coordinates
2025-07-14 17:27:49 - root - DEBUG - Single region bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:27:49 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:27:49 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:27:49 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:27:49 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:27:49 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:27:49 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:27:49 - root - INFO - Initializing OCRHandler
2025-07-14 17:27:49 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:27:49 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:27:49 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:27:49 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:27:49 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:27:49 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:27:49 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:27:50 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:27:50 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:27:50 - root - INFO - Initializing TableDetector
2025-07-14 17:27:50 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:27:50 - root - DEBUG - Default detection parameters:
2025-07-14 17:27:50 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:27:50 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:27:50 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:27:50 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:27:50 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:27:50 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:27:50 - root - INFO - TableDetector initialization completed
2025-07-14 17:27:50 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:27:50 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:27:50 - root - DEBUG - Text analysis configuration:
2025-07-14 17:27:50 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:27:50 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:27:50 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:27:50 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:27:50 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:27:50 - root - INFO - Initializing ContentExtractor
2025-07-14 17:27:50 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:27:50 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:27:50 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:27:50 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:27:50 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:27:50 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:27:50 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:27:50 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:27:50 - root - DEBUG - Edge detection completed
2025-07-14 17:27:50 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:27:50 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 325111
2025-07-14 17:27:50 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:27:50 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:27:50 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:27:50 - root - DEBUG - Line enhancement completed
2025-07-14 17:27:50 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:27:50 - root - DEBUG - Line thickening completed
2025-07-14 17:27:50 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:27:50 - root - DEBUG - Line combination completed
2025-07-14 17:27:50 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:27:50 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:27:50 - root - INFO - Found 606 contours
2025-07-14 17:27:50 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:27:50 - root - DEBUG - Contours drawn successfully
2025-07-14 17:27:50 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:27:50 - root - INFO - Rectangular region detection completed
2025-07-14 17:27:50 - root - INFO - Total candidate regions found: 98
2025-07-14 17:27:50 - root - DEBUG - Found 98 candidate regions
2025-07-14 17:27:50 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:27:50 - root - DEBUG - Line 1: '1 D 0.65cm' (conf: 0.999)
2025-07-14 17:27:50 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:27:50 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:27:50 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:27:50 - root - DEBUG - Combined text: '1 d 0.65cm'
2025-07-14 17:27:50 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:27:50 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:27:50 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:27:50 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:27:50 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:27:50 - root - DEBUG - Pattern 1 matches: 1
2025-07-14 17:27:50 - root - DEBUG - Pattern 1 found matches: ['0.65cm']
2025-07-14 17:27:50 - root - DEBUG - Pattern 2 matches: 1
2025-07-14 17:27:50 - root - DEBUG - Pattern 2 found matches: ['d']
2025-07-14 17:27:50 - root - DEBUG - Base score from pattern matching: 2
2025-07-14 17:27:50 - root - DEBUG - 'cm' occurrences: 1, bonus added: 2
2025-07-14 17:27:50 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:27:50 - root - INFO - Final measurement score: 4
2025-07-14 17:27:51 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:27:51 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:27:51 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:27:51 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:27:51 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:27:51 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:27:51 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:27:51 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:27:51 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:27:51 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:27:51 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:27:51 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:27:51 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:27:51 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:27:51 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:27:51 - root - INFO - Final measurement score: 0
2025-07-14 17:27:51 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:27:51 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:27:51 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-14 17:27:51 - root - DEBUG - Rank 1: Index 0, Score 4.000000
2025-07-14 17:27:51 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-14 17:27:51 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-14 17:27:51 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-14 17:27:51 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-14 17:27:51 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-14 17:27:51 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-14 17:27:51 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:27:51 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:27:51 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:27:51 - root - INFO - Best candidate meets threshold (>= 4). Score: 4.000000
2025-07-14 17:27:51 - root - DEBUG - All top 10 scores:
2025-07-14 17:27:51 - root - DEBUG - Score index 0: 4.000000
2025-07-14 17:27:51 - root - DEBUG - Score index 1: 0.000000
2025-07-14 17:27:51 - root - DEBUG - Score index 2: 0.000000
2025-07-14 17:27:51 - root - DEBUG - Score index 3: 0.000000
2025-07-14 17:27:51 - root - DEBUG - Score index 4: 0.000000
2025-07-14 17:27:51 - root - DEBUG - Score index 5: 0.000000
2025-07-14 17:27:51 - root - DEBUG - Score index 6: 0.000000
2025-07-14 17:27:51 - root - DEBUG - Score index 7: 0.000000
2025-07-14 17:27:51 - root - DEBUG - Score index 8: 0.000000
2025-07-14 17:27:51 - root - DEBUG - Score index 9: 0.000000
2025-07-14 17:27:51 - root - INFO - Measurement table detection completed successfully
2025-07-14 17:27:51 - root - DEBUG - Table detection completed. Candidates found: 98
2025-07-14 17:27:51 - root - INFO - Identifying organ name from the image
2025-07-14 17:27:51 - root - INFO - Starting organ name identification
2025-07-14 17:27:51 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:27:51 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:27:51 - root - INFO - Starting organ label identification
2025-07-14 17:27:51 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:27:51 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:27:53 - root - DEBUG - Line 1: '64/22Hz' (conf: 1.000)
2025-07-14 17:27:53 - root - DEBUG - Line 2: 'Voluson' (conf: 1.000)
2025-07-14 17:27:53 - root - DEBUG - Line 3: 'Abdomen' (conf: 0.999)
2025-07-14 17:27:53 - root - DEBUG - Line 4: '58' (conf: 0.722)
2025-07-14 17:27:53 - root - DEBUG - Line 5: 'HM PI 7.70 - 2.10' (conf: 0.927)
2025-07-14 17:27:53 - root - DEBUG - Line 6: 'AO 100%' (conf: 0.938)
2025-07-14 17:27:53 - root - DEBUG - Line 7: 'Gn -20' (conf: 0.938)
2025-07-14 17:27:53 - root - DEBUG - Line 8: 'C6 / M4' (conf: 0.878)
2025-07-14 17:27:53 - root - DEBUG - Line 9: 'FF1/E2' (conf: 0.997)
2025-07-14 17:27:53 - root - DEBUG - Line 10: 'SRI II 2 / CRI 2' (conf: 0.984)
2025-07-14 17:27:53 - root - DEBUG - Line 11: '1 D 0.65cm' (conf: 0.994)
2025-07-14 17:27:53 - root - DEBUG - OCR completed. Processing 11 text lines for organ keywords
2025-07-14 17:27:53 - root - DEBUG - Line 0 text: '64/22Hz'
2025-07-14 17:27:53 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-14 17:27:53 - root - DEBUG - Line 2 text: 'Abdomen'
2025-07-14 17:27:53 - root - DEBUG - Line 3 text: '58'
2025-07-14 17:27:53 - root - DEBUG - Line 4 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:27:53 - root - DEBUG - Line 5 text: 'AO 100%'
2025-07-14 17:27:53 - root - DEBUG - Line 6 text: 'Gn -20'
2025-07-14 17:27:53 - root - DEBUG - Line 7 text: 'C6 / M4'
2025-07-14 17:27:53 - root - DEBUG - Line 8 text: 'FF1/E2'
2025-07-14 17:27:53 - root - DEBUG - Line 9 text: 'SRI II 2 / CRI 2'
2025-07-14 17:27:53 - root - DEBUG - Line 10 text: '1 D 0.65cm'
2025-07-14 17:27:53 - root - DEBUG - Combined text for keyword search: '64/22hz voluson abdomen 58 hm pi 7.70 - 2.10 ao 100% gn -20 c6 / m4 ff1/e2 sri ii 2 / cri 2 1 d 0.65cm'
2025-07-14 17:27:53 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:27:53 - root - INFO - Organ identification completed. Found 0 organ keywords
2025-07-14 17:27:53 - root - INFO - Identified organs: []
2025-07-14 17:27:53 - root - WARNING - No organ name identified from the image
2025-07-14 17:27:53 - root - DEBUG - Organ identified: []
2025-07-14 17:27:53 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-14 17:27:53 - root - DEBUG - Number of scored candidates: 10
2025-07-14 17:27:53 - root - DEBUG - Best score index: 0
2025-07-14 17:27:53 - root - INFO - Extracting structured data from detected table
2025-07-14 17:27:53 - root - INFO - Starting table content extraction
2025-07-14 17:27:53 - root - DEBUG - Bounding box coordinates: (3110, 2225, 294, 79)
2025-07-14 17:27:53 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-14 17:27:53 - root - DEBUG - Delegating to content extractor for table processing
2025-07-14 17:27:53 - root - INFO - Starting table content extraction
2025-07-14 17:27:53 - root - DEBUG - Bounding box coordinates: (3110, 2225, 294, 79)
2025-07-14 17:27:53 - root - INFO - Performing OCR on extracted table region
2025-07-14 17:27:53 - root - DEBUG - Line 1: '1 D 0.65cm' (conf: 0.999)
2025-07-14 17:27:53 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-14 17:27:53 - root - INFO - Extracted 1 text elements from table region
2025-07-14 17:27:53 - root - INFO - Structuring extracted text data
2025-07-14 17:27:53 - root - INFO - Starting table data structuring
2025-07-14 17:27:53 - root - DEBUG - Element 1: text='1 D 0.65cm', x=154.00, y=42.00, conf=0.999
2025-07-14 17:27:53 - root - DEBUG - Processing element 1/1: '1 D 0.65cm' at (154.00, 42.00)
2025-07-14 17:27:53 - root - INFO - Line grouping completed - Total lines: 1
2025-07-14 17:27:53 - root - DEBUG - Processing line 1/1 with 1 elements
2025-07-14 17:27:53 - root - DEBUG - Processing word 1/1: '1 D 0.65cm'
2025-07-14 17:27:53 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:27:53 - root - DEBUG - Input text: '1 D 0.65cm'
2025-07-14 17:27:53 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:27:53 - root - DEBUG - Pattern 1 matched successfully
2025-07-14 17:27:53 - root - DEBUG - Pattern 1 groups: ('1', 'D', '0.65cm')
2025-07-14 17:27:53 - root - DEBUG - Pattern 1 result: ('1', 'D', '0.65cm')
2025-07-14 17:27:53 - root - INFO - Text split successful using pattern 1: ('1', 'D', '0.65cm')
2025-07-14 17:27:53 - root - DEBUG - Split measurement result: ('1', 'D', '0.65cm')
2025-07-14 17:27:53 - root - DEBUG - Final structured data:
2025-07-14 17:27:53 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D', '0.65cm']}'
2025-07-14 17:27:53 - root - INFO - Table content extraction completed successfully
2025-07-14 17:27:53 - root - DEBUG - Structured data keys: [{'organLabel': []}, {'Value1': ['1', 'D', '0.65cm']}]
2025-07-14 17:27:53 - root - DEBUG - Organ identified: []
2025-07-14 17:27:53 - root - INFO - Table extraction successful for file: API\extracted\TestingDicomZip\I0000030_20250417_103454
2025-07-14 17:27:53 - root - INFO - Organ identified: []
2025-07-14 17:27:53 - root - DEBUG - Structured data extracted: [{'organLabel': []}, {'Value1': ['1', 'D', '0.65cm']}]
2025-07-14 17:27:53 - root - INFO - Processing DICOM file 4/11: API\extracted\TestingDicomZip\I0000040_20250417_103454
2025-07-14 17:27:53 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:27:53 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000040_20250417_103454
2025-07-14 17:27:53 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:27:53 - root - INFO - DICOM file loaded successfully
2025-07-14 17:27:53 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:27:53 - root - INFO - Processing RGB format DICOM
2025-07-14 17:27:53 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:27:53 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:27:53 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:27:53 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:27:53 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:27:53 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:27:53 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:27:53 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-14 17:27:53 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:27:53 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-14 17:27:53 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:27:53 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:27:53 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:27:53 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:27:53 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:27:53 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:27:53 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:27:53 - root - INFO - Initializing OCRHandler
2025-07-14 17:27:53 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:27:53 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:27:53 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:27:53 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:27:53 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:27:53 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:27:53 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:27:54 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:27:54 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:27:54 - root - INFO - Initializing TableDetector
2025-07-14 17:27:54 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:27:54 - root - DEBUG - Default detection parameters:
2025-07-14 17:27:54 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:27:54 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:27:54 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:27:54 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:27:54 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:27:54 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:27:54 - root - INFO - TableDetector initialization completed
2025-07-14 17:27:54 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:27:54 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:27:54 - root - DEBUG - Text analysis configuration:
2025-07-14 17:27:54 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:27:54 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:27:54 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:27:54 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:27:54 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:27:54 - root - INFO - Initializing ContentExtractor
2025-07-14 17:27:54 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:27:54 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:27:54 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:27:54 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:27:54 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:27:54 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:27:54 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:27:54 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:27:54 - root - DEBUG - Edge detection completed
2025-07-14 17:27:54 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:27:54 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 573974
2025-07-14 17:27:54 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:27:54 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:27:54 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:27:54 - root - DEBUG - Line enhancement completed
2025-07-14 17:27:54 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:27:54 - root - DEBUG - Line thickening completed
2025-07-14 17:27:54 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:27:54 - root - DEBUG - Line combination completed
2025-07-14 17:27:54 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:27:54 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:27:54 - root - INFO - Found 1070 contours
2025-07-14 17:27:54 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:27:54 - root - DEBUG - Contours drawn successfully
2025-07-14 17:27:54 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:27:54 - root - INFO - Rectangular region detection completed
2025-07-14 17:27:54 - root - INFO - Total candidate regions found: 329
2025-07-14 17:27:54 - root - DEBUG - Found 329 candidate regions
2025-07-14 17:27:54 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:27:56 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:27:56 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:27:56 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:27:56 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:27:56 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:27:56 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:27:56 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:27:56 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:27:56 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:27:56 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:27:56 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:27:56 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:27:56 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:27:56 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:27:56 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:27:56 - root - INFO - Final measurement score: 0
2025-07-14 17:27:56 - root - DEBUG - Line 1: 'M' (conf: 0.996)
2025-07-14 17:27:56 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:27:56 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:27:56 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:27:56 - root - DEBUG - Combined text: 'm'
2025-07-14 17:27:56 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:27:56 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:27:56 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:27:56 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:27:56 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:27:56 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:27:56 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:27:56 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:27:56 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:27:56 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:27:56 - root - INFO - Final measurement score: 0
2025-07-14 17:27:56 - root - DEBUG - Line 1: 'HM' (conf: 0.989)
2025-07-14 17:27:56 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:27:56 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:27:56 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:27:56 - root - DEBUG - Combined text: 'hm'
2025-07-14 17:27:56 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:27:56 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:27:56 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:27:56 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:27:56 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:27:56 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:27:56 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:27:56 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:27:56 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:27:56 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:27:56 - root - INFO - Final measurement score: 0
2025-07-14 17:27:56 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:27:56 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:27:56 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-14 17:27:56 - root - DEBUG - Rank 1: Index 0, Score 0.000000
2025-07-14 17:27:56 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-14 17:27:56 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-14 17:27:56 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-14 17:27:56 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-14 17:27:56 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-14 17:27:56 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-14 17:27:56 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:27:56 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:27:56 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:27:56 - root - WARNING - No candidates meet the minimum threshold of 4. Best score: 0.000000
2025-07-14 17:27:56 - root - INFO - Measurement table detection completed - no valid tables found
2025-07-14 17:27:56 - root - DEBUG - Table detection completed. Candidates found: 329
2025-07-14 17:27:56 - root - INFO - Identifying organ name from the image
2025-07-14 17:27:56 - root - INFO - Starting organ name identification
2025-07-14 17:27:56 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:27:56 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:27:56 - root - INFO - Starting organ label identification
2025-07-14 17:27:56 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:27:56 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:27:58 - root - DEBUG - Line 1: '64/21Hz' (conf: 1.000)
2025-07-14 17:27:58 - root - DEBUG - Line 2: 'Abdomen' (conf: 0.999)
2025-07-14 17:27:58 - root - DEBUG - Line 3: 'Voluson' (conf: 0.999)
2025-07-14 17:27:58 - root - DEBUG - Line 4: 'Voluson' (conf: 1.000)
2025-07-14 17:27:58 - root - DEBUG - Line 5: 'S8' (conf: 0.786)
2025-07-14 17:27:58 - root - DEBUG - Line 6: '58' (conf: 0.891)
2025-07-14 17:27:58 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.925)
2025-07-14 17:27:58 - root - DEBUG - Line 8: 'AO100%' (conf: 0.999)
2025-07-14 17:27:58 - root - DEBUG - Line 9: 'Gn -19' (conf: 0.929)
2025-07-14 17:27:58 - root - DEBUG - Line 10: 'C6/M4' (conf: 0.980)
2025-07-14 17:27:58 - root - DEBUG - Line 11: 'FF1/E2' (conf: 0.996)
2025-07-14 17:27:58 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.978)
2025-07-14 17:27:58 - root - DEBUG - Line 13: 'RT OVARY' (conf: 1.000)
2025-07-14 17:27:58 - root - DEBUG - OCR completed. Processing 13 text lines for organ keywords
2025-07-14 17:27:58 - root - DEBUG - Line 0 text: '64/21Hz'
2025-07-14 17:27:58 - root - DEBUG - Line 1 text: 'Abdomen'
2025-07-14 17:27:58 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-14 17:27:58 - root - DEBUG - Line 3 text: 'Voluson'
2025-07-14 17:27:58 - root - DEBUG - Line 4 text: 'S8'
2025-07-14 17:27:58 - root - DEBUG - Line 5 text: '58'
2025-07-14 17:27:58 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:27:58 - root - DEBUG - Line 7 text: 'AO100%'
2025-07-14 17:27:58 - root - DEBUG - Line 8 text: 'Gn -19'
2025-07-14 17:27:58 - root - DEBUG - Line 9 text: 'C6/M4'
2025-07-14 17:27:58 - root - DEBUG - Line 10 text: 'FF1/E2'
2025-07-14 17:27:58 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-14 17:27:58 - root - DEBUG - Line 12 text: 'RT OVARY'
2025-07-14 17:27:58 - root - DEBUG - Combined text for keyword search: '64/21hz abdomen voluson voluson s8 58 hm pi 7.70 - 2.10 ao100% gn -19 c6/m4 ff1/e2 sri ii 2 / cri 2 rt ovary'
2025-07-14 17:27:58 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:27:58 - root - DEBUG - Found organ keyword: 'rt ovary'
2025-07-14 17:27:58 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-14 17:27:58 - root - INFO - Identified organs: ['rt ovary']
2025-07-14 17:27:58 - root - INFO - Organ identification completed successfully: ['rt ovary']
2025-07-14 17:27:58 - root - DEBUG - Organ identified: ['rt ovary']
2025-07-14 17:27:58 - root - WARNING - No measurement tables detected in the ultrasound image
2025-07-14 17:27:58 - root - WARNING - No structured data extracted from file: API\extracted\TestingDicomZip\I0000040_20250417_103454
2025-07-14 17:27:58 - root - INFO - Processing DICOM file 5/11: API\extracted\TestingDicomZip\I0000060_20250417_103454
2025-07-14 17:27:58 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:27:58 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000060_20250417_103454
2025-07-14 17:27:58 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:27:58 - root - INFO - DICOM file loaded successfully
2025-07-14 17:27:58 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:27:58 - root - INFO - Processing RGB format DICOM
2025-07-14 17:27:58 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:27:58 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:27:58 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:27:58 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:27:58 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:27:58 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:27:58 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:27:58 - root - DEBUG - Raw coordinates - minx0: [0], miny0: [66], maxx1: [1136], maxy1: [852]
2025-07-14 17:27:58 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:27:58 - root - INFO - Single region detected, using direct coordinates
2025-07-14 17:27:58 - root - DEBUG - Single region bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:27:58 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:27:58 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:27:58 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:27:58 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:27:58 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:27:58 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:27:58 - root - INFO - Initializing OCRHandler
2025-07-14 17:27:58 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:27:58 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:27:58 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:27:58 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:27:58 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:27:58 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:27:58 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:27:59 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:27:59 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:27:59 - root - INFO - Initializing TableDetector
2025-07-14 17:27:59 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:27:59 - root - DEBUG - Default detection parameters:
2025-07-14 17:27:59 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:27:59 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:27:59 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:27:59 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:27:59 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:27:59 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:27:59 - root - INFO - TableDetector initialization completed
2025-07-14 17:27:59 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:27:59 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:27:59 - root - DEBUG - Text analysis configuration:
2025-07-14 17:27:59 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:27:59 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:27:59 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:27:59 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:27:59 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:27:59 - root - INFO - Initializing ContentExtractor
2025-07-14 17:27:59 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:27:59 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:27:59 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:27:59 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:27:59 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:27:59 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:27:59 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:27:59 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:27:59 - root - DEBUG - Edge detection completed
2025-07-14 17:27:59 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:27:59 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 347890
2025-07-14 17:27:59 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:27:59 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:27:59 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:27:59 - root - DEBUG - Line enhancement completed
2025-07-14 17:27:59 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:27:59 - root - DEBUG - Line thickening completed
2025-07-14 17:27:59 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:27:59 - root - DEBUG - Line combination completed
2025-07-14 17:27:59 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:27:59 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:27:59 - root - INFO - Found 755 contours
2025-07-14 17:27:59 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:27:59 - root - DEBUG - Contours drawn successfully
2025-07-14 17:27:59 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:27:59 - root - INFO - Rectangular region detection completed
2025-07-14 17:27:59 - root - INFO - Total candidate regions found: 168
2025-07-14 17:27:59 - root - DEBUG - Found 168 candidate regions
2025-07-14 17:27:59 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:28:00 - root - DEBUG - Line 1: '1 D 5.87cm' (conf: 0.985)
2025-07-14 17:28:00 - root - DEBUG - Line 2: '2 ' (conf: 0.817)
2025-07-14 17:28:00 - root - DEBUG - Line 3: 'D 4.37cm' (conf: 1.000)
2025-07-14 17:28:00 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:00 - root - DEBUG - Number of text lines detected: 3
2025-07-14 17:28:00 - root - DEBUG - Text extraction completed - Lines processed: 3
2025-07-14 17:28:00 - root - DEBUG - Combined text: '1 d 5.87cm 2  d 4.37cm'
2025-07-14 17:28:00 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:00 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:00 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:00 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:00 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:00 - root - DEBUG - Pattern 1 matches: 2
2025-07-14 17:28:00 - root - DEBUG - Pattern 1 found matches: ['5.87cm', '4.37cm']
2025-07-14 17:28:00 - root - DEBUG - Pattern 2 matches: 2
2025-07-14 17:28:00 - root - DEBUG - Pattern 2 found matches: ['d', 'd']
2025-07-14 17:28:00 - root - DEBUG - Base score from pattern matching: 4
2025-07-14 17:28:00 - root - DEBUG - 'cm' occurrences: 2, bonus added: 4
2025-07-14 17:28:00 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:00 - root - INFO - Final measurement score: 8
2025-07-14 17:28:00 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:28:00 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:00 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:00 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:00 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:28:00 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:00 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:00 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:00 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:00 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:00 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:00 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:00 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:00 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:00 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:00 - root - INFO - Final measurement score: 0
2025-07-14 17:28:01 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:28:01 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:28:01 - root - DEBUG - Top 10 score indices: [2, 0, 1, 3, 4, 5, 6, 7, 8, 9]
2025-07-14 17:28:01 - root - DEBUG - Rank 1: Index 2, Score 8.000000
2025-07-14 17:28:01 - root - DEBUG - Rank 2: Index 0, Score 0.000000
2025-07-14 17:28:01 - root - DEBUG - Rank 3: Index 1, Score 0.000000
2025-07-14 17:28:01 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-14 17:28:01 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-14 17:28:01 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-14 17:28:01 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-14 17:28:01 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:28:01 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:28:01 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:28:01 - root - INFO - Best candidate meets threshold (>= 4). Score: 8.000000
2025-07-14 17:28:01 - root - DEBUG - All top 10 scores:
2025-07-14 17:28:01 - root - DEBUG - Score index 2: 8.000000
2025-07-14 17:28:01 - root - DEBUG - Score index 0: 0.000000
2025-07-14 17:28:01 - root - DEBUG - Score index 1: 0.000000
2025-07-14 17:28:01 - root - DEBUG - Score index 3: 0.000000
2025-07-14 17:28:01 - root - DEBUG - Score index 4: 0.000000
2025-07-14 17:28:01 - root - DEBUG - Score index 5: 0.000000
2025-07-14 17:28:01 - root - DEBUG - Score index 6: 0.000000
2025-07-14 17:28:01 - root - DEBUG - Score index 7: 0.000000
2025-07-14 17:28:01 - root - DEBUG - Score index 8: 0.000000
2025-07-14 17:28:01 - root - DEBUG - Score index 9: 0.000000
2025-07-14 17:28:01 - root - INFO - Measurement table detection completed successfully
2025-07-14 17:28:01 - root - DEBUG - Table detection completed. Candidates found: 168
2025-07-14 17:28:01 - root - INFO - Identifying organ name from the image
2025-07-14 17:28:01 - root - INFO - Starting organ name identification
2025-07-14 17:28:01 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:28:01 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:28:01 - root - INFO - Starting organ label identification
2025-07-14 17:28:01 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:28:01 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:28:03 - root - DEBUG - Line 1: '64/21Hz' (conf: 1.000)
2025-07-14 17:28:03 - root - DEBUG - Line 2: 'Voluson' (conf: 1.000)
2025-07-14 17:28:03 - root - DEBUG - Line 3: 'Abdomen' (conf: 0.999)
2025-07-14 17:28:03 - root - DEBUG - Line 4: '58' (conf: 0.891)
2025-07-14 17:28:03 - root - DEBUG - Line 5: 'HM PI 7.70 - 2.10' (conf: 0.927)
2025-07-14 17:28:03 - root - DEBUG - Line 6: 'AO 100%' (conf: 0.938)
2025-07-14 17:28:03 - root - DEBUG - Line 7: 'Gn -19' (conf: 0.948)
2025-07-14 17:28:03 - root - DEBUG - Line 8: 'C6 / M4' (conf: 0.878)
2025-07-14 17:28:03 - root - DEBUG - Line 9: 'FF1/E2' (conf: 0.997)
2025-07-14 17:28:03 - root - DEBUG - Line 10: 'SRI II 2 / CRI 2' (conf: 0.984)
2025-07-14 17:28:03 - root - DEBUG - Line 11: '1 D 5.87cm' (conf: 0.999)
2025-07-14 17:28:03 - root - DEBUG - Line 12: '2 D 4.37cm' (conf: 0.974)
2025-07-14 17:28:03 - root - DEBUG - OCR completed. Processing 12 text lines for organ keywords
2025-07-14 17:28:03 - root - DEBUG - Line 0 text: '64/21Hz'
2025-07-14 17:28:03 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-14 17:28:03 - root - DEBUG - Line 2 text: 'Abdomen'
2025-07-14 17:28:03 - root - DEBUG - Line 3 text: '58'
2025-07-14 17:28:03 - root - DEBUG - Line 4 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:28:03 - root - DEBUG - Line 5 text: 'AO 100%'
2025-07-14 17:28:03 - root - DEBUG - Line 6 text: 'Gn -19'
2025-07-14 17:28:03 - root - DEBUG - Line 7 text: 'C6 / M4'
2025-07-14 17:28:03 - root - DEBUG - Line 8 text: 'FF1/E2'
2025-07-14 17:28:03 - root - DEBUG - Line 9 text: 'SRI II 2 / CRI 2'
2025-07-14 17:28:03 - root - DEBUG - Line 10 text: '1 D 5.87cm'
2025-07-14 17:28:03 - root - DEBUG - Line 11 text: '2 D 4.37cm'
2025-07-14 17:28:03 - root - DEBUG - Combined text for keyword search: '64/21hz voluson abdomen 58 hm pi 7.70 - 2.10 ao 100% gn -19 c6 / m4 ff1/e2 sri ii 2 / cri 2 1 d 5.87cm 2 d 4.37cm'
2025-07-14 17:28:03 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:28:03 - root - INFO - Organ identification completed. Found 0 organ keywords
2025-07-14 17:28:03 - root - INFO - Identified organs: []
2025-07-14 17:28:03 - root - WARNING - No organ name identified from the image
2025-07-14 17:28:03 - root - DEBUG - Organ identified: []
2025-07-14 17:28:03 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-14 17:28:03 - root - DEBUG - Number of scored candidates: 10
2025-07-14 17:28:03 - root - DEBUG - Best score index: 2
2025-07-14 17:28:03 - root - INFO - Extracting structured data from detected table
2025-07-14 17:28:03 - root - INFO - Starting table content extraction
2025-07-14 17:28:03 - root - DEBUG - Bounding box coordinates: (3110, 2141, 294, 163)
2025-07-14 17:28:03 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-14 17:28:03 - root - DEBUG - Delegating to content extractor for table processing
2025-07-14 17:28:03 - root - INFO - Starting table content extraction
2025-07-14 17:28:03 - root - DEBUG - Bounding box coordinates: (3110, 2141, 294, 163)
2025-07-14 17:28:03 - root - INFO - Performing OCR on extracted table region
2025-07-14 17:28:03 - root - DEBUG - Line 1: '1 D 5.87cm' (conf: 0.985)
2025-07-14 17:28:03 - root - DEBUG - Line 2: '2 ' (conf: 0.817)
2025-07-14 17:28:03 - root - DEBUG - Line 3: 'D 4.37cm' (conf: 1.000)
2025-07-14 17:28:03 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-14 17:28:03 - root - INFO - Extracted 3 text elements from table region
2025-07-14 17:28:03 - root - INFO - Structuring extracted text data
2025-07-14 17:28:03 - root - INFO - Starting table data structuring
2025-07-14 17:28:03 - root - DEBUG - Element 1: text='1 D 5.87cm', x=153.00, y=43.00, conf=0.985
2025-07-14 17:28:03 - root - DEBUG - Element 2: text='2 ', x=55.00, y=130.00, conf=0.817
2025-07-14 17:28:03 - root - DEBUG - Element 3: text='D 4.37cm', x=180.00, y=126.00, conf=1.000
2025-07-14 17:28:03 - root - DEBUG - Processing element 1/3: '1 D 5.87cm' at (153.00, 43.00)
2025-07-14 17:28:03 - root - DEBUG - Processing element 2/3: 'D 4.37cm' at (180.00, 126.00)
2025-07-14 17:28:03 - root - DEBUG - Processing element 3/3: '2 ' at (55.00, 130.00)
2025-07-14 17:28:03 - root - INFO - Line grouping completed - Total lines: 2
2025-07-14 17:28:03 - root - DEBUG - Processing line 1/2 with 1 elements
2025-07-14 17:28:03 - root - DEBUG - Processing word 1/1: '1 D 5.87cm'
2025-07-14 17:28:03 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:03 - root - DEBUG - Input text: '1 D 5.87cm'
2025-07-14 17:28:03 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:03 - root - DEBUG - Pattern 1 matched successfully
2025-07-14 17:28:03 - root - DEBUG - Pattern 1 groups: ('1', 'D', '5.87cm')
2025-07-14 17:28:03 - root - DEBUG - Pattern 1 result: ('1', 'D', '5.87cm')
2025-07-14 17:28:03 - root - INFO - Text split successful using pattern 1: ('1', 'D', '5.87cm')
2025-07-14 17:28:03 - root - DEBUG - Split measurement result: ('1', 'D', '5.87cm')
2025-07-14 17:28:03 - root - DEBUG - Processing line 2/2 with 2 elements
2025-07-14 17:28:03 - root - DEBUG - Processing word 1/2: '2 '
2025-07-14 17:28:03 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:03 - root - DEBUG - Input text: '2 '
2025-07-14 17:28:03 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:03 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:03 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:03 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:28:03 - root - DEBUG - No patterns matched for text: '2 '
2025-07-14 17:28:03 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:28:03 - root - DEBUG - Split measurement result: None
2025-07-14 17:28:03 - root - DEBUG - Processing word 2/2: 'D 4.37cm'
2025-07-14 17:28:03 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:03 - root - DEBUG - Input text: 'D 4.37cm'
2025-07-14 17:28:03 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:03 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:03 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:03 - root - DEBUG - Pattern 2 matched successfully
2025-07-14 17:28:03 - root - DEBUG - Pattern 2 groups: ('D', '4.37cm')
2025-07-14 17:28:03 - root - DEBUG - Pattern 2 result: ('D', '4.37cm')
2025-07-14 17:28:03 - root - INFO - Text split successful using pattern 2: ('D', '4.37cm')
2025-07-14 17:28:03 - root - DEBUG - Split measurement result: ('D', '4.37cm')
2025-07-14 17:28:03 - root - DEBUG - Final structured data:
2025-07-14 17:28:03 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D', '5.87cm']}'
2025-07-14 17:28:03 - root - DEBUG - Item 2 (text): '{'Value2': ['2 ', 'D', '4.37cm']}'
2025-07-14 17:28:03 - root - INFO - Table content extraction completed successfully
2025-07-14 17:28:03 - root - DEBUG - Structured data keys: [{'organLabel': []}, {'Value1': ['1', 'D', '5.87cm']}, {'Value2': ['2 ', 'D', '4.37cm']}]
2025-07-14 17:28:03 - root - DEBUG - Organ identified: []
2025-07-14 17:28:03 - root - INFO - Table extraction successful for file: API\extracted\TestingDicomZip\I0000060_20250417_103454
2025-07-14 17:28:03 - root - INFO - Organ identified: []
2025-07-14 17:28:03 - root - DEBUG - Structured data extracted: [{'organLabel': []}, {'Value1': ['1', 'D', '5.87cm']}, {'Value2': ['2 ', 'D', '4.37cm']}]
2025-07-14 17:28:03 - root - INFO - Processing DICOM file 6/11: API\extracted\TestingDicomZip\I0000070_20250417_103454
2025-07-14 17:28:03 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:28:03 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000070_20250417_103454
2025-07-14 17:28:03 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:28:03 - root - INFO - DICOM file loaded successfully
2025-07-14 17:28:03 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:28:03 - root - INFO - Processing RGB format DICOM
2025-07-14 17:28:03 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:28:03 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:28:03 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:28:03 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:28:03 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:28:03 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:28:03 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:28:03 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-14 17:28:03 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:28:03 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-14 17:28:03 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:28:03 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:28:03 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:28:03 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:28:03 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:28:03 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:28:03 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:28:03 - root - INFO - Initializing OCRHandler
2025-07-14 17:28:03 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:28:03 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:28:03 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:28:03 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:28:03 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:28:03 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:28:03 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:28:04 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:28:04 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:28:04 - root - INFO - Initializing TableDetector
2025-07-14 17:28:04 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:28:04 - root - DEBUG - Default detection parameters:
2025-07-14 17:28:04 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:28:04 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:28:04 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:28:04 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:28:04 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:28:04 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:28:04 - root - INFO - TableDetector initialization completed
2025-07-14 17:28:04 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:28:04 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:28:04 - root - DEBUG - Text analysis configuration:
2025-07-14 17:28:04 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:28:04 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:28:04 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:28:04 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:28:04 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:28:04 - root - INFO - Initializing ContentExtractor
2025-07-14 17:28:04 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:28:04 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:28:04 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:28:04 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:28:04 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:28:04 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:28:04 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:28:04 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:28:04 - root - DEBUG - Edge detection completed
2025-07-14 17:28:04 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:28:04 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 539695
2025-07-14 17:28:04 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:28:04 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:28:04 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:28:04 - root - DEBUG - Line enhancement completed
2025-07-14 17:28:04 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:28:04 - root - DEBUG - Line thickening completed
2025-07-14 17:28:04 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:28:04 - root - DEBUG - Line combination completed
2025-07-14 17:28:04 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:28:04 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:28:04 - root - INFO - Found 988 contours
2025-07-14 17:28:04 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:28:04 - root - DEBUG - Contours drawn successfully
2025-07-14 17:28:04 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:28:04 - root - INFO - Rectangular region detection completed
2025-07-14 17:28:04 - root - INFO - Total candidate regions found: 308
2025-07-14 17:28:04 - root - DEBUG - Found 308 candidate regions
2025-07-14 17:28:04 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:28:06 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:28:06 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:06 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:06 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:06 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:28:06 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:06 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:06 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:06 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:06 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:06 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:06 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:06 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:06 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:06 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:06 - root - INFO - Final measurement score: 0
2025-07-14 17:28:06 - root - DEBUG - Line 1: 'HN' (conf: 0.818)
2025-07-14 17:28:06 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:06 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:06 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:06 - root - DEBUG - Combined text: 'hn'
2025-07-14 17:28:06 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:06 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:06 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:06 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:06 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:06 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:06 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:06 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:06 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:06 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:06 - root - INFO - Final measurement score: 0
2025-07-14 17:28:06 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:28:06 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:28:06 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-14 17:28:06 - root - DEBUG - Rank 1: Index 0, Score 0.000000
2025-07-14 17:28:06 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-14 17:28:06 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-14 17:28:06 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-14 17:28:06 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-14 17:28:06 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-14 17:28:06 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-14 17:28:06 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:28:06 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:28:06 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:28:06 - root - WARNING - No candidates meet the minimum threshold of 4. Best score: 0.000000
2025-07-14 17:28:06 - root - INFO - Measurement table detection completed - no valid tables found
2025-07-14 17:28:06 - root - DEBUG - Table detection completed. Candidates found: 308
2025-07-14 17:28:06 - root - INFO - Identifying organ name from the image
2025-07-14 17:28:06 - root - INFO - Starting organ name identification
2025-07-14 17:28:06 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:28:06 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:28:06 - root - INFO - Starting organ label identification
2025-07-14 17:28:06 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:28:06 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:28:08 - root - DEBUG - Line 1: '64/21Hz' (conf: 1.000)
2025-07-14 17:28:08 - root - DEBUG - Line 2: 'Abdomen' (conf: 0.999)
2025-07-14 17:28:08 - root - DEBUG - Line 3: 'Voluson' (conf: 0.999)
2025-07-14 17:28:08 - root - DEBUG - Line 4: 'Voluson' (conf: 1.000)
2025-07-14 17:28:08 - root - DEBUG - Line 5: 'S8' (conf: 0.786)
2025-07-14 17:28:08 - root - DEBUG - Line 6: '58' (conf: 0.891)
2025-07-14 17:28:08 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.941)
2025-07-14 17:28:08 - root - DEBUG - Line 8: 'AO 100%' (conf: 0.933)
2025-07-14 17:28:08 - root - DEBUG - Line 9: 'Gn -19' (conf: 0.929)
2025-07-14 17:28:08 - root - DEBUG - Line 10: 'C6/M4' (conf: 0.977)
2025-07-14 17:28:08 - root - DEBUG - Line 11: 'FF1/E2' (conf: 0.996)
2025-07-14 17:28:08 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.942)
2025-07-14 17:28:08 - root - DEBUG - Line 13: 'LT OVARY' (conf: 0.999)
2025-07-14 17:28:08 - root - DEBUG - OCR completed. Processing 13 text lines for organ keywords
2025-07-14 17:28:08 - root - DEBUG - Line 0 text: '64/21Hz'
2025-07-14 17:28:08 - root - DEBUG - Line 1 text: 'Abdomen'
2025-07-14 17:28:08 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-14 17:28:08 - root - DEBUG - Line 3 text: 'Voluson'
2025-07-14 17:28:08 - root - DEBUG - Line 4 text: 'S8'
2025-07-14 17:28:08 - root - DEBUG - Line 5 text: '58'
2025-07-14 17:28:08 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:28:08 - root - DEBUG - Line 7 text: 'AO 100%'
2025-07-14 17:28:08 - root - DEBUG - Line 8 text: 'Gn -19'
2025-07-14 17:28:08 - root - DEBUG - Line 9 text: 'C6/M4'
2025-07-14 17:28:08 - root - DEBUG - Line 10 text: 'FF1/E2'
2025-07-14 17:28:08 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-14 17:28:08 - root - DEBUG - Line 12 text: 'LT OVARY'
2025-07-14 17:28:08 - root - DEBUG - Combined text for keyword search: '64/21hz abdomen voluson voluson s8 58 hm pi 7.70 - 2.10 ao 100% gn -19 c6/m4 ff1/e2 sri ii 2 / cri 2 lt ovary'
2025-07-14 17:28:08 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:28:08 - root - DEBUG - Found organ keyword: 'lt ovary'
2025-07-14 17:28:08 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-14 17:28:08 - root - INFO - Identified organs: ['lt ovary']
2025-07-14 17:28:08 - root - INFO - Organ identification completed successfully: ['lt ovary']
2025-07-14 17:28:08 - root - DEBUG - Organ identified: ['lt ovary']
2025-07-14 17:28:08 - root - WARNING - No measurement tables detected in the ultrasound image
2025-07-14 17:28:08 - root - WARNING - No structured data extracted from file: API\extracted\TestingDicomZip\I0000070_20250417_103454
2025-07-14 17:28:08 - root - INFO - Processing DICOM file 7/11: API\extracted\TestingDicomZip\I0000080_20250417_103454
2025-07-14 17:28:08 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:28:08 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000080_20250417_103454
2025-07-14 17:28:08 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:28:08 - root - INFO - DICOM file loaded successfully
2025-07-14 17:28:08 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:28:08 - root - INFO - Processing RGB format DICOM
2025-07-14 17:28:08 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:28:08 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:28:08 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:28:08 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:28:08 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:28:08 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:28:08 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:28:08 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-14 17:28:08 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:28:08 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-14 17:28:08 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:28:08 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:28:08 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:28:08 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:28:08 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:28:08 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:28:08 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:28:08 - root - INFO - Initializing OCRHandler
2025-07-14 17:28:08 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:28:08 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:28:08 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:28:08 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:28:08 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:28:08 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:28:08 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:28:09 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:28:09 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:28:09 - root - INFO - Initializing TableDetector
2025-07-14 17:28:09 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:28:09 - root - DEBUG - Default detection parameters:
2025-07-14 17:28:09 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:28:09 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:28:09 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:28:09 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:28:09 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:28:09 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:28:09 - root - INFO - TableDetector initialization completed
2025-07-14 17:28:09 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:28:09 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:28:09 - root - DEBUG - Text analysis configuration:
2025-07-14 17:28:09 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:28:09 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:28:09 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:28:09 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:28:09 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:28:09 - root - INFO - Initializing ContentExtractor
2025-07-14 17:28:09 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:28:09 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:28:09 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:28:09 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:28:09 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:28:09 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:28:09 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:28:09 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:28:09 - root - DEBUG - Edge detection completed
2025-07-14 17:28:09 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:28:09 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 470717
2025-07-14 17:28:09 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:28:09 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:28:09 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:28:09 - root - DEBUG - Line enhancement completed
2025-07-14 17:28:09 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:28:09 - root - DEBUG - Line thickening completed
2025-07-14 17:28:09 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:28:09 - root - DEBUG - Line combination completed
2025-07-14 17:28:09 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:28:09 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:28:09 - root - INFO - Found 1091 contours
2025-07-14 17:28:09 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:28:09 - root - DEBUG - Contours drawn successfully
2025-07-14 17:28:09 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:28:09 - root - INFO - Rectangular region detection completed
2025-07-14 17:28:09 - root - INFO - Total candidate regions found: 235
2025-07-14 17:28:09 - root - DEBUG - Found 235 candidate regions
2025-07-14 17:28:09 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:28:10 - root - DEBUG - Line 1: 'D1' (conf: 1.000)
2025-07-14 17:28:10 - root - DEBUG - Line 2: '2.93cm' (conf: 1.000)
2025-07-14 17:28:10 - root - DEBUG - Line 3: '1' (conf: 0.988)
2025-07-14 17:28:10 - root - DEBUG - Line 4: '-' (conf: 0.722)
2025-07-14 17:28:10 - root - DEBUG - Line 5: '2' (conf: 0.794)
2025-07-14 17:28:10 - root - DEBUG - Line 6: 'D2' (conf: 0.998)
2025-07-14 17:28:10 - root - DEBUG - Line 7: '1.52cm' (conf: 1.000)
2025-07-14 17:28:10 - root - DEBUG - Line 8: 'D3' (conf: 1.000)
2025-07-14 17:28:10 - root - DEBUG - Line 9: '2.54cm' (conf: 1.000)
2025-07-14 17:28:10 - root - DEBUG - Line 10: 'Vol 5.923cm' (conf: 0.994)
2025-07-14 17:28:10 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:10 - root - DEBUG - Number of text lines detected: 10
2025-07-14 17:28:10 - root - DEBUG - Text extraction completed - Lines processed: 10
2025-07-14 17:28:10 - root - DEBUG - Combined text: 'd1 2.93cm 1 - 2 d2 1.52cm d3 2.54cm vol 5.923cm'
2025-07-14 17:28:10 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:10 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:10 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:10 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:10 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:10 - root - DEBUG - Pattern 1 matches: 4
2025-07-14 17:28:10 - root - DEBUG - Pattern 1 found matches: ['2.93cm', '1.52cm', '2.54cm', '5.923cm']
2025-07-14 17:28:10 - root - DEBUG - Pattern 2 matches: 3
2025-07-14 17:28:10 - root - DEBUG - Pattern 2 found matches: ['d1', 'd2', 'vol']
2025-07-14 17:28:10 - root - DEBUG - Base score from pattern matching: 7
2025-07-14 17:28:10 - root - DEBUG - 'cm' occurrences: 4, bonus added: 8
2025-07-14 17:28:10 - root - DEBUG - 'vol' occurrences: 1, bonus added: 2
2025-07-14 17:28:10 - root - INFO - Final measurement score: 17
2025-07-14 17:28:12 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:28:12 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:12 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:12 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:12 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:28:12 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:12 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:12 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:12 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:12 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:12 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:12 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:12 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:12 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:12 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:12 - root - INFO - Final measurement score: 0
2025-07-14 17:28:12 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:28:12 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:28:12 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-14 17:28:12 - root - DEBUG - Rank 1: Index 0, Score 17.000000
2025-07-14 17:28:12 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-14 17:28:12 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-14 17:28:12 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-14 17:28:12 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-14 17:28:12 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-14 17:28:12 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-14 17:28:12 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:28:12 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:28:12 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:28:12 - root - INFO - Best candidate meets threshold (>= 4). Score: 17.000000
2025-07-14 17:28:12 - root - DEBUG - All top 10 scores:
2025-07-14 17:28:12 - root - DEBUG - Score index 0: 17.000000
2025-07-14 17:28:12 - root - DEBUG - Score index 1: 0.000000
2025-07-14 17:28:12 - root - DEBUG - Score index 2: 0.000000
2025-07-14 17:28:12 - root - DEBUG - Score index 3: 0.000000
2025-07-14 17:28:12 - root - DEBUG - Score index 4: 0.000000
2025-07-14 17:28:12 - root - DEBUG - Score index 5: 0.000000
2025-07-14 17:28:12 - root - DEBUG - Score index 6: 0.000000
2025-07-14 17:28:12 - root - DEBUG - Score index 7: 0.000000
2025-07-14 17:28:12 - root - DEBUG - Score index 8: 0.000000
2025-07-14 17:28:12 - root - DEBUG - Score index 9: 0.000000
2025-07-14 17:28:12 - root - INFO - Measurement table detection completed successfully
2025-07-14 17:28:12 - root - DEBUG - Table detection completed. Candidates found: 235
2025-07-14 17:28:12 - root - INFO - Identifying organ name from the image
2025-07-14 17:28:12 - root - INFO - Starting organ name identification
2025-07-14 17:28:12 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:28:12 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:28:12 - root - INFO - Starting organ label identification
2025-07-14 17:28:12 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:28:12 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:28:15 - root - DEBUG - Line 1: '64/21Hz' (conf: 1.000)
2025-07-14 17:28:15 - root - DEBUG - Line 2: 'Abdomen' (conf: 0.999)
2025-07-14 17:28:15 - root - DEBUG - Line 3: 'Voluson' (conf: 0.999)
2025-07-14 17:28:15 - root - DEBUG - Line 4: 'Voluson' (conf: 1.000)
2025-07-14 17:28:15 - root - DEBUG - Line 5: 'S8' (conf: 0.786)
2025-07-14 17:28:15 - root - DEBUG - Line 6: '58' (conf: 0.891)
2025-07-14 17:28:15 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.941)
2025-07-14 17:28:15 - root - DEBUG - Line 8: 'AO100%' (conf: 0.999)
2025-07-14 17:28:15 - root - DEBUG - Line 9: 'Gn -19' (conf: 0.938)
2025-07-14 17:28:15 - root - DEBUG - Line 10: 'C6/M4' (conf: 0.977)
2025-07-14 17:28:15 - root - DEBUG - Line 11: 'FF1/E2' (conf: 0.996)
2025-07-14 17:28:15 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.942)
2025-07-14 17:28:15 - root - DEBUG - Line 13: 'LT OVARY' (conf: 0.999)
2025-07-14 17:28:15 - root - DEBUG - Line 14: '1' (conf: 0.546)
2025-07-14 17:28:15 - root - DEBUG - Line 15: 'D1' (conf: 0.999)
2025-07-14 17:28:15 - root - DEBUG - Line 16: '2.93cm' (conf: 1.000)
2025-07-14 17:28:15 - root - DEBUG - Line 17: '2' (conf: 0.822)
2025-07-14 17:28:15 - root - DEBUG - Line 18: 'D2' (conf: 0.998)
2025-07-14 17:28:15 - root - DEBUG - Line 19: '1.52cm' (conf: 1.000)
2025-07-14 17:28:15 - root - DEBUG - Line 20: 'D3' (conf: 0.997)
2025-07-14 17:28:15 - root - DEBUG - Line 21: '2.54cm' (conf: 1.000)
2025-07-14 17:28:15 - root - DEBUG - Line 22: '3' (conf: 0.999)
2025-07-14 17:28:15 - root - DEBUG - Line 23: 'Vol 5.923cma' (conf: 0.936)
2025-07-14 17:28:15 - root - DEBUG - OCR completed. Processing 23 text lines for organ keywords
2025-07-14 17:28:15 - root - DEBUG - Line 0 text: '64/21Hz'
2025-07-14 17:28:15 - root - DEBUG - Line 1 text: 'Abdomen'
2025-07-14 17:28:15 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-14 17:28:15 - root - DEBUG - Line 3 text: 'Voluson'
2025-07-14 17:28:15 - root - DEBUG - Line 4 text: 'S8'
2025-07-14 17:28:15 - root - DEBUG - Line 5 text: '58'
2025-07-14 17:28:15 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:28:15 - root - DEBUG - Line 7 text: 'AO100%'
2025-07-14 17:28:15 - root - DEBUG - Line 8 text: 'Gn -19'
2025-07-14 17:28:15 - root - DEBUG - Line 9 text: 'C6/M4'
2025-07-14 17:28:15 - root - DEBUG - Line 10 text: 'FF1/E2'
2025-07-14 17:28:15 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-14 17:28:15 - root - DEBUG - Line 12 text: 'LT OVARY'
2025-07-14 17:28:15 - root - DEBUG - Line 13 text: '1'
2025-07-14 17:28:15 - root - DEBUG - Line 14 text: 'D1'
2025-07-14 17:28:15 - root - DEBUG - Line 15 text: '2.93cm'
2025-07-14 17:28:15 - root - DEBUG - Line 16 text: '2'
2025-07-14 17:28:15 - root - DEBUG - Line 17 text: 'D2'
2025-07-14 17:28:15 - root - DEBUG - Line 18 text: '1.52cm'
2025-07-14 17:28:15 - root - DEBUG - Line 19 text: 'D3'
2025-07-14 17:28:15 - root - DEBUG - Line 20 text: '2.54cm'
2025-07-14 17:28:15 - root - DEBUG - Line 21 text: '3'
2025-07-14 17:28:15 - root - DEBUG - Line 22 text: 'Vol 5.923cma'
2025-07-14 17:28:15 - root - DEBUG - Combined text for keyword search: '64/21hz abdomen voluson voluson s8 58 hm pi 7.70 - 2.10 ao100% gn -19 c6/m4 ff1/e2 sri ii 2 / cri 2 lt ovary 1 d1 2.93cm 2 d2 1.52cm d3 2.54cm 3 vol 5.923cma'
2025-07-14 17:28:15 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:28:15 - root - DEBUG - Found organ keyword: 'lt ovary'
2025-07-14 17:28:15 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-14 17:28:15 - root - INFO - Identified organs: ['lt ovary']
2025-07-14 17:28:15 - root - INFO - Organ identification completed successfully: ['lt ovary']
2025-07-14 17:28:15 - root - DEBUG - Organ identified: ['lt ovary']
2025-07-14 17:28:15 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-14 17:28:15 - root - DEBUG - Number of scored candidates: 10
2025-07-14 17:28:15 - root - DEBUG - Best score index: 0
2025-07-14 17:28:15 - root - INFO - Extracting structured data from detected table
2025-07-14 17:28:15 - root - INFO - Starting table content extraction
2025-07-14 17:28:15 - root - DEBUG - Bounding box coordinates: (3019, 2008, 385, 296)
2025-07-14 17:28:15 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-14 17:28:15 - root - DEBUG - Delegating to content extractor for table processing
2025-07-14 17:28:15 - root - INFO - Starting table content extraction
2025-07-14 17:28:15 - root - DEBUG - Bounding box coordinates: (3019, 2008, 385, 296)
2025-07-14 17:28:15 - root - INFO - Performing OCR on extracted table region
2025-07-14 17:28:16 - root - DEBUG - Line 1: 'D1' (conf: 1.000)
2025-07-14 17:28:16 - root - DEBUG - Line 2: '2.93cm' (conf: 1.000)
2025-07-14 17:28:16 - root - DEBUG - Line 3: '1' (conf: 0.988)
2025-07-14 17:28:16 - root - DEBUG - Line 4: '-' (conf: 0.722)
2025-07-14 17:28:16 - root - DEBUG - Line 5: '2' (conf: 0.794)
2025-07-14 17:28:16 - root - DEBUG - Line 6: 'D2' (conf: 0.998)
2025-07-14 17:28:16 - root - DEBUG - Line 7: '1.52cm' (conf: 1.000)
2025-07-14 17:28:16 - root - DEBUG - Line 8: 'D3' (conf: 1.000)
2025-07-14 17:28:16 - root - DEBUG - Line 9: '2.54cm' (conf: 1.000)
2025-07-14 17:28:16 - root - DEBUG - Line 10: 'Vol 5.923cm' (conf: 0.994)
2025-07-14 17:28:16 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-14 17:28:16 - root - INFO - Extracted 10 text elements from table region
2025-07-14 17:28:16 - root - INFO - Structuring extracted text data
2025-07-14 17:28:16 - root - INFO - Starting table data structuring
2025-07-14 17:28:16 - root - DEBUG - Element 1: text='D1', x=110.00, y=41.50, conf=1.000
2025-07-14 17:28:16 - root - DEBUG - Element 2: text='2.93cm', x=301.00, y=42.00, conf=1.000
2025-07-14 17:28:16 - root - DEBUG - Element 3: text='1', x=36.00, y=49.00, conf=0.988
2025-07-14 17:28:16 - root - DEBUG - Element 4: text='-', x=38.00, y=67.50, conf=0.722
2025-07-14 17:28:16 - root - DEBUG - Element 5: text='2', x=37.00, y=116.00, conf=0.794
2025-07-14 17:28:16 - root - DEBUG - Element 6: text='D2', x=110.50, y=111.50, conf=0.998
2025-07-14 17:28:16 - root - DEBUG - Element 7: text='1.52cm', x=301.50, y=111.50, conf=1.000
2025-07-14 17:28:16 - root - DEBUG - Element 8: text='D3', x=110.00, y=181.50, conf=1.000
2025-07-14 17:28:16 - root - DEBUG - Element 9: text='2.54cm', x=301.50, y=182.00, conf=1.000
2025-07-14 17:28:16 - root - DEBUG - Element 10: text='Vol 5.923cm', x=228.50, y=247.50, conf=0.994
2025-07-14 17:28:16 - root - DEBUG - Processing element 1/10: 'D1' at (110.00, 41.50)
2025-07-14 17:28:16 - root - DEBUG - Processing element 2/10: '2.93cm' at (301.00, 42.00)
2025-07-14 17:28:16 - root - DEBUG - Processing element 3/10: '1' at (36.00, 49.00)
2025-07-14 17:28:16 - root - DEBUG - Processing element 4/10: '-' at (38.00, 67.50)
2025-07-14 17:28:16 - root - DEBUG - Processing element 5/10: 'D2' at (110.50, 111.50)
2025-07-14 17:28:16 - root - DEBUG - Processing element 6/10: '1.52cm' at (301.50, 111.50)
2025-07-14 17:28:16 - root - DEBUG - Processing element 7/10: '2' at (37.00, 116.00)
2025-07-14 17:28:16 - root - DEBUG - Processing element 8/10: 'D3' at (110.00, 181.50)
2025-07-14 17:28:16 - root - DEBUG - Processing element 9/10: '2.54cm' at (301.50, 182.00)
2025-07-14 17:28:16 - root - DEBUG - Processing element 10/10: 'Vol 5.923cm' at (228.50, 247.50)
2025-07-14 17:28:16 - root - INFO - Line grouping completed - Total lines: 5
2025-07-14 17:28:16 - root - DEBUG - Processing line 1/5 with 3 elements
2025-07-14 17:28:16 - root - DEBUG - Processing word 1/3: '1'
2025-07-14 17:28:16 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:16 - root - DEBUG - Input text: '1'
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:28:16 - root - DEBUG - No patterns matched for text: '1'
2025-07-14 17:28:16 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:28:16 - root - DEBUG - Split measurement result: None
2025-07-14 17:28:16 - root - DEBUG - Processing word 2/3: 'D1'
2025-07-14 17:28:16 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:16 - root - DEBUG - Input text: 'D1'
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:28:16 - root - DEBUG - No patterns matched for text: 'D1'
2025-07-14 17:28:16 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:28:16 - root - DEBUG - Split measurement result: None
2025-07-14 17:28:16 - root - DEBUG - Processing word 3/3: '2.93cm'
2025-07-14 17:28:16 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:16 - root - DEBUG - Input text: '2.93cm'
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:28:16 - root - DEBUG - No patterns matched for text: '2.93cm'
2025-07-14 17:28:16 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:28:16 - root - DEBUG - Split measurement result: None
2025-07-14 17:28:16 - root - DEBUG - Processing line 2/5 with 1 elements
2025-07-14 17:28:16 - root - DEBUG - Processing word 1/1: '-'
2025-07-14 17:28:16 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:16 - root - DEBUG - Input text: '-'
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:28:16 - root - DEBUG - No patterns matched for text: '-'
2025-07-14 17:28:16 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:28:16 - root - DEBUG - Split measurement result: None
2025-07-14 17:28:16 - root - DEBUG - Processing line 3/5 with 3 elements
2025-07-14 17:28:16 - root - DEBUG - Processing word 1/3: '2'
2025-07-14 17:28:16 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:16 - root - DEBUG - Input text: '2'
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:28:16 - root - DEBUG - No patterns matched for text: '2'
2025-07-14 17:28:16 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:28:16 - root - DEBUG - Split measurement result: None
2025-07-14 17:28:16 - root - DEBUG - Processing word 2/3: 'D2'
2025-07-14 17:28:16 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:16 - root - DEBUG - Input text: 'D2'
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:28:16 - root - DEBUG - No patterns matched for text: 'D2'
2025-07-14 17:28:16 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:28:16 - root - DEBUG - Split measurement result: None
2025-07-14 17:28:16 - root - DEBUG - Processing word 3/3: '1.52cm'
2025-07-14 17:28:16 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:16 - root - DEBUG - Input text: '1.52cm'
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:28:16 - root - DEBUG - No patterns matched for text: '1.52cm'
2025-07-14 17:28:16 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:28:16 - root - DEBUG - Split measurement result: None
2025-07-14 17:28:16 - root - DEBUG - Processing line 4/5 with 2 elements
2025-07-14 17:28:16 - root - DEBUG - Processing word 1/2: 'D3'
2025-07-14 17:28:16 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:16 - root - DEBUG - Input text: 'D3'
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:28:16 - root - DEBUG - No patterns matched for text: 'D3'
2025-07-14 17:28:16 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:28:16 - root - DEBUG - Split measurement result: None
2025-07-14 17:28:16 - root - DEBUG - Processing word 2/2: '2.54cm'
2025-07-14 17:28:16 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:16 - root - DEBUG - Input text: '2.54cm'
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:28:16 - root - DEBUG - No patterns matched for text: '2.54cm'
2025-07-14 17:28:16 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:28:16 - root - DEBUG - Split measurement result: None
2025-07-14 17:28:16 - root - DEBUG - Processing line 5/5 with 1 elements
2025-07-14 17:28:16 - root - DEBUG - Processing word 1/1: 'Vol 5.923cm'
2025-07-14 17:28:16 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:16 - root - DEBUG - Input text: 'Vol 5.923cm'
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:16 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:16 - root - DEBUG - Pattern 2 matched successfully
2025-07-14 17:28:16 - root - DEBUG - Pattern 2 groups: ('Vol', '5.923cm')
2025-07-14 17:28:16 - root - DEBUG - Pattern 2 result: ('Vol', '5.923cm')
2025-07-14 17:28:16 - root - INFO - Text split successful using pattern 2: ('Vol', '5.923cm')
2025-07-14 17:28:16 - root - DEBUG - Split measurement result: ('Vol', '5.923cm')
2025-07-14 17:28:16 - root - DEBUG - Final structured data:
2025-07-14 17:28:16 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D1', '2.93cm']}'
2025-07-14 17:28:16 - root - DEBUG - Item 2 (text): '{'Value2': ['-']}'
2025-07-14 17:28:16 - root - DEBUG - Item 3 (text): '{'Value3': ['2', 'D2', '1.52cm']}'
2025-07-14 17:28:16 - root - DEBUG - Item 4 (text): '{'Value4': ['D3', '2.54cm']}'
2025-07-14 17:28:16 - root - DEBUG - Item 5 (text): '{'Value5': ['Vol', '5.923cm']}'
2025-07-14 17:28:16 - root - INFO - Table content extraction completed successfully
2025-07-14 17:28:16 - root - DEBUG - Structured data keys: [{'organLabel': ['lt ovary']}, {'Value1': ['1', 'D1', '2.93cm']}, {'Value2': ['-']}, {'Value3': ['2', 'D2', '1.52cm']}, {'Value4': ['D3', '2.54cm']}, {'Value5': ['Vol', '5.923cm']}]
2025-07-14 17:28:16 - root - DEBUG - Organ identified: ['lt ovary']
2025-07-14 17:28:16 - root - INFO - Table extraction successful for file: API\extracted\TestingDicomZip\I0000080_20250417_103454
2025-07-14 17:28:16 - root - INFO - Organ identified: ['lt ovary']
2025-07-14 17:28:16 - root - DEBUG - Structured data extracted: [{'organLabel': ['lt ovary']}, {'Value1': ['1', 'D1', '2.93cm']}, {'Value2': ['-']}, {'Value3': ['2', 'D2', '1.52cm']}, {'Value4': ['D3', '2.54cm']}, {'Value5': ['Vol', '5.923cm']}]
2025-07-14 17:28:16 - root - INFO - Processing DICOM file 8/11: API\extracted\TestingDicomZip\I0000090_20250417_103454
2025-07-14 17:28:16 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:28:16 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000090_20250417_103454
2025-07-14 17:28:16 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:28:16 - root - INFO - DICOM file loaded successfully
2025-07-14 17:28:16 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:28:16 - root - INFO - Processing RGB format DICOM
2025-07-14 17:28:16 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:28:16 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:28:16 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:28:16 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:28:16 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:28:16 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:28:16 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:28:16 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-14 17:28:16 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:28:16 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-14 17:28:16 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:28:16 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:28:16 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:28:16 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:28:16 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:28:16 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:28:16 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:28:16 - root - INFO - Initializing OCRHandler
2025-07-14 17:28:16 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:28:16 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:28:16 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:28:16 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:28:16 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:28:16 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:28:16 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:28:17 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:28:17 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:28:17 - root - INFO - Initializing TableDetector
2025-07-14 17:28:17 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:28:17 - root - DEBUG - Default detection parameters:
2025-07-14 17:28:17 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:28:17 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:28:17 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:28:17 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:28:17 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:28:17 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:28:17 - root - INFO - TableDetector initialization completed
2025-07-14 17:28:17 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:28:17 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:28:17 - root - DEBUG - Text analysis configuration:
2025-07-14 17:28:17 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:28:17 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:28:17 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:28:17 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:28:17 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:28:17 - root - INFO - Initializing ContentExtractor
2025-07-14 17:28:17 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:28:17 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:28:17 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:28:17 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:28:17 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:28:17 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:28:17 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:28:17 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:28:17 - root - DEBUG - Edge detection completed
2025-07-14 17:28:17 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:28:17 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 601096
2025-07-14 17:28:17 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:28:17 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:28:17 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:28:17 - root - DEBUG - Line enhancement completed
2025-07-14 17:28:17 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:28:17 - root - DEBUG - Line thickening completed
2025-07-14 17:28:17 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:28:17 - root - DEBUG - Line combination completed
2025-07-14 17:28:17 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:28:17 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:28:17 - root - INFO - Found 1062 contours
2025-07-14 17:28:17 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:28:17 - root - DEBUG - Contours drawn successfully
2025-07-14 17:28:17 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:28:17 - root - INFO - Rectangular region detection completed
2025-07-14 17:28:17 - root - INFO - Total candidate regions found: 381
2025-07-14 17:28:17 - root - DEBUG - Found 381 candidate regions
2025-07-14 17:28:17 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:28:17 - root - DEBUG - Line 1: '60' (conf: 0.849)
2025-07-14 17:28:17 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:17 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:17 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:17 - root - DEBUG - Combined text: '60'
2025-07-14 17:28:17 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:17 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:17 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:17 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:17 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:17 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:17 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:17 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:17 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:17 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:17 - root - INFO - Final measurement score: 0
2025-07-14 17:28:18 - root - DEBUG - Line 1: '1 D 1.65cm' (conf: 0.998)
2025-07-14 17:28:18 - root - DEBUG - Line 2: '2 ' (conf: 0.943)
2025-07-14 17:28:18 - root - DEBUG - Line 3: 'D 1.56cm' (conf: 0.999)
2025-07-14 17:28:18 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:18 - root - DEBUG - Number of text lines detected: 3
2025-07-14 17:28:18 - root - DEBUG - Text extraction completed - Lines processed: 3
2025-07-14 17:28:18 - root - DEBUG - Combined text: '1 d 1.65cm 2  d 1.56cm'
2025-07-14 17:28:18 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:18 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:18 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:18 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:18 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:18 - root - DEBUG - Pattern 1 matches: 2
2025-07-14 17:28:18 - root - DEBUG - Pattern 1 found matches: ['1.65cm', '1.56cm']
2025-07-14 17:28:18 - root - DEBUG - Pattern 2 matches: 2
2025-07-14 17:28:18 - root - DEBUG - Pattern 2 found matches: ['d', 'd']
2025-07-14 17:28:18 - root - DEBUG - Base score from pattern matching: 4
2025-07-14 17:28:18 - root - DEBUG - 'cm' occurrences: 2, bonus added: 4
2025-07-14 17:28:18 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:18 - root - INFO - Final measurement score: 8
2025-07-14 17:28:19 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:28:19 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:19 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:19 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:19 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:28:19 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:19 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:19 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:19 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:19 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:19 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:19 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:19 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:19 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:19 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:19 - root - INFO - Final measurement score: 0
2025-07-14 17:28:20 - root - DEBUG - Line 1: 'HM' (conf: 0.941)
2025-07-14 17:28:20 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:20 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:20 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:20 - root - DEBUG - Combined text: 'hm'
2025-07-14 17:28:20 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:20 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:20 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:20 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:20 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:20 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:20 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:20 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:20 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:20 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:20 - root - INFO - Final measurement score: 0
2025-07-14 17:28:20 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:28:20 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:28:20 - root - DEBUG - Top 10 score indices: [6, 0, 1, 2, 3, 4, 5, 7, 8, 9]
2025-07-14 17:28:20 - root - DEBUG - Rank 1: Index 6, Score 8.000000
2025-07-14 17:28:20 - root - DEBUG - Rank 2: Index 0, Score 0.000000
2025-07-14 17:28:20 - root - DEBUG - Rank 3: Index 1, Score 0.000000
2025-07-14 17:28:20 - root - DEBUG - Rank 4: Index 2, Score 0.000000
2025-07-14 17:28:20 - root - DEBUG - Rank 5: Index 3, Score 0.000000
2025-07-14 17:28:20 - root - DEBUG - Rank 6: Index 4, Score 0.000000
2025-07-14 17:28:20 - root - DEBUG - Rank 7: Index 5, Score 0.000000
2025-07-14 17:28:20 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:28:20 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:28:20 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:28:20 - root - INFO - Best candidate meets threshold (>= 4). Score: 8.000000
2025-07-14 17:28:20 - root - DEBUG - All top 10 scores:
2025-07-14 17:28:20 - root - DEBUG - Score index 6: 8.000000
2025-07-14 17:28:20 - root - DEBUG - Score index 0: 0.000000
2025-07-14 17:28:20 - root - DEBUG - Score index 1: 0.000000
2025-07-14 17:28:20 - root - DEBUG - Score index 2: 0.000000
2025-07-14 17:28:20 - root - DEBUG - Score index 3: 0.000000
2025-07-14 17:28:20 - root - DEBUG - Score index 4: 0.000000
2025-07-14 17:28:20 - root - DEBUG - Score index 5: 0.000000
2025-07-14 17:28:20 - root - DEBUG - Score index 7: 0.000000
2025-07-14 17:28:20 - root - DEBUG - Score index 8: 0.000000
2025-07-14 17:28:20 - root - DEBUG - Score index 9: 0.000000
2025-07-14 17:28:20 - root - INFO - Measurement table detection completed successfully
2025-07-14 17:28:20 - root - DEBUG - Table detection completed. Candidates found: 381
2025-07-14 17:28:20 - root - INFO - Identifying organ name from the image
2025-07-14 17:28:20 - root - INFO - Starting organ name identification
2025-07-14 17:28:20 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:28:20 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:28:20 - root - INFO - Starting organ label identification
2025-07-14 17:28:20 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:28:20 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:28:22 - root - DEBUG - Line 1: '64/21Hz' (conf: 1.000)
2025-07-14 17:28:22 - root - DEBUG - Line 2: 'Abdomen' (conf: 1.000)
2025-07-14 17:28:22 - root - DEBUG - Line 3: 'Voluson' (conf: 0.999)
2025-07-14 17:28:22 - root - DEBUG - Line 4: 'Voluson' (conf: 1.000)
2025-07-14 17:28:22 - root - DEBUG - Line 5: 'S8' (conf: 0.786)
2025-07-14 17:28:22 - root - DEBUG - Line 6: '58' (conf: 0.891)
2025-07-14 17:28:22 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.973)
2025-07-14 17:28:22 - root - DEBUG - Line 8: 'AO100%' (conf: 0.999)
2025-07-14 17:28:22 - root - DEBUG - Line 9: 'Gn-19' (conf: 0.986)
2025-07-14 17:28:22 - root - DEBUG - Line 10: 'C6/M4' (conf: 0.980)
2025-07-14 17:28:22 - root - DEBUG - Line 11: 'FF1/E2' (conf: 0.994)
2025-07-14 17:28:22 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.957)
2025-07-14 17:28:22 - root - DEBUG - Line 13: 'D 1.65cm' (conf: 0.999)
2025-07-14 17:28:22 - root - DEBUG - Line 14: '2 D 1.56cm' (conf: 0.997)
2025-07-14 17:28:22 - root - DEBUG - OCR completed. Processing 14 text lines for organ keywords
2025-07-14 17:28:22 - root - DEBUG - Line 0 text: '64/21Hz'
2025-07-14 17:28:22 - root - DEBUG - Line 1 text: 'Abdomen'
2025-07-14 17:28:22 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-14 17:28:22 - root - DEBUG - Line 3 text: 'Voluson'
2025-07-14 17:28:22 - root - DEBUG - Line 4 text: 'S8'
2025-07-14 17:28:22 - root - DEBUG - Line 5 text: '58'
2025-07-14 17:28:22 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:28:22 - root - DEBUG - Line 7 text: 'AO100%'
2025-07-14 17:28:22 - root - DEBUG - Line 8 text: 'Gn-19'
2025-07-14 17:28:22 - root - DEBUG - Line 9 text: 'C6/M4'
2025-07-14 17:28:22 - root - DEBUG - Line 10 text: 'FF1/E2'
2025-07-14 17:28:22 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-14 17:28:22 - root - DEBUG - Line 12 text: 'D 1.65cm'
2025-07-14 17:28:22 - root - DEBUG - Line 13 text: '2 D 1.56cm'
2025-07-14 17:28:22 - root - DEBUG - Combined text for keyword search: '64/21hz abdomen voluson voluson s8 58 hm pi 7.70 - 2.10 ao100% gn-19 c6/m4 ff1/e2 sri ii 2 / cri 2 d 1.65cm 2 d 1.56cm'
2025-07-14 17:28:22 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:28:22 - root - INFO - Organ identification completed. Found 0 organ keywords
2025-07-14 17:28:22 - root - INFO - Identified organs: []
2025-07-14 17:28:22 - root - WARNING - No organ name identified from the image
2025-07-14 17:28:22 - root - DEBUG - Organ identified: []
2025-07-14 17:28:22 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-14 17:28:22 - root - DEBUG - Number of scored candidates: 10
2025-07-14 17:28:22 - root - DEBUG - Best score index: 6
2025-07-14 17:28:22 - root - INFO - Extracting structured data from detected table
2025-07-14 17:28:22 - root - INFO - Starting table content extraction
2025-07-14 17:28:22 - root - DEBUG - Bounding box coordinates: (3109, 2141, 295, 162)
2025-07-14 17:28:22 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-14 17:28:22 - root - DEBUG - Delegating to content extractor for table processing
2025-07-14 17:28:22 - root - INFO - Starting table content extraction
2025-07-14 17:28:22 - root - DEBUG - Bounding box coordinates: (3109, 2141, 295, 162)
2025-07-14 17:28:22 - root - INFO - Performing OCR on extracted table region
2025-07-14 17:28:22 - root - DEBUG - Line 1: '1 D 1.65cm' (conf: 0.998)
2025-07-14 17:28:22 - root - DEBUG - Line 2: '2 ' (conf: 0.943)
2025-07-14 17:28:22 - root - DEBUG - Line 3: 'D 1.56cm' (conf: 0.999)
2025-07-14 17:28:22 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-14 17:28:22 - root - INFO - Extracted 3 text elements from table region
2025-07-14 17:28:22 - root - INFO - Structuring extracted text data
2025-07-14 17:28:22 - root - INFO - Starting table data structuring
2025-07-14 17:28:22 - root - DEBUG - Element 1: text='1 D 1.65cm', x=154.50, y=43.00, conf=0.998
2025-07-14 17:28:22 - root - DEBUG - Element 2: text='2 ', x=53.50, y=129.50, conf=0.943
2025-07-14 17:28:22 - root - DEBUG - Element 3: text='D 1.56cm', x=182.00, y=125.50, conf=0.999
2025-07-14 17:28:22 - root - DEBUG - Processing element 1/3: '1 D 1.65cm' at (154.50, 43.00)
2025-07-14 17:28:22 - root - DEBUG - Processing element 2/3: 'D 1.56cm' at (182.00, 125.50)
2025-07-14 17:28:22 - root - DEBUG - Processing element 3/3: '2 ' at (53.50, 129.50)
2025-07-14 17:28:22 - root - INFO - Line grouping completed - Total lines: 2
2025-07-14 17:28:22 - root - DEBUG - Processing line 1/2 with 1 elements
2025-07-14 17:28:22 - root - DEBUG - Processing word 1/1: '1 D 1.65cm'
2025-07-14 17:28:22 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:22 - root - DEBUG - Input text: '1 D 1.65cm'
2025-07-14 17:28:22 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:22 - root - DEBUG - Pattern 1 matched successfully
2025-07-14 17:28:22 - root - DEBUG - Pattern 1 groups: ('1', 'D', '1.65cm')
2025-07-14 17:28:22 - root - DEBUG - Pattern 1 result: ('1', 'D', '1.65cm')
2025-07-14 17:28:22 - root - INFO - Text split successful using pattern 1: ('1', 'D', '1.65cm')
2025-07-14 17:28:22 - root - DEBUG - Split measurement result: ('1', 'D', '1.65cm')
2025-07-14 17:28:22 - root - DEBUG - Processing line 2/2 with 2 elements
2025-07-14 17:28:22 - root - DEBUG - Processing word 1/2: '2 '
2025-07-14 17:28:22 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:22 - root - DEBUG - Input text: '2 '
2025-07-14 17:28:22 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:22 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:22 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:22 - root - DEBUG - Pattern 2 did not match
2025-07-14 17:28:22 - root - DEBUG - No patterns matched for text: '2 '
2025-07-14 17:28:22 - root - INFO - Text split failed - no matching patterns found
2025-07-14 17:28:22 - root - DEBUG - Split measurement result: None
2025-07-14 17:28:22 - root - DEBUG - Processing word 2/2: 'D 1.56cm'
2025-07-14 17:28:22 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:22 - root - DEBUG - Input text: 'D 1.56cm'
2025-07-14 17:28:22 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:22 - root - DEBUG - Pattern 1 did not match
2025-07-14 17:28:22 - root - DEBUG - Trying pattern 2: (\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:22 - root - DEBUG - Pattern 2 matched successfully
2025-07-14 17:28:22 - root - DEBUG - Pattern 2 groups: ('D', '1.56cm')
2025-07-14 17:28:22 - root - DEBUG - Pattern 2 result: ('D', '1.56cm')
2025-07-14 17:28:22 - root - INFO - Text split successful using pattern 2: ('D', '1.56cm')
2025-07-14 17:28:22 - root - DEBUG - Split measurement result: ('D', '1.56cm')
2025-07-14 17:28:22 - root - DEBUG - Final structured data:
2025-07-14 17:28:22 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D', '1.65cm']}'
2025-07-14 17:28:22 - root - DEBUG - Item 2 (text): '{'Value2': ['2 ', 'D', '1.56cm']}'
2025-07-14 17:28:22 - root - INFO - Table content extraction completed successfully
2025-07-14 17:28:22 - root - DEBUG - Structured data keys: [{'organLabel': []}, {'Value1': ['1', 'D', '1.65cm']}, {'Value2': ['2 ', 'D', '1.56cm']}]
2025-07-14 17:28:22 - root - DEBUG - Organ identified: []
2025-07-14 17:28:22 - root - INFO - Table extraction successful for file: API\extracted\TestingDicomZip\I0000090_20250417_103454
2025-07-14 17:28:22 - root - INFO - Organ identified: []
2025-07-14 17:28:22 - root - DEBUG - Structured data extracted: [{'organLabel': []}, {'Value1': ['1', 'D', '1.65cm']}, {'Value2': ['2 ', 'D', '1.56cm']}]
2025-07-14 17:28:22 - root - INFO - Processing DICOM file 9/11: API\extracted\TestingDicomZip\I0000100_20250417_103454
2025-07-14 17:28:22 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:28:22 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000100_20250417_103454
2025-07-14 17:28:22 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:28:22 - root - INFO - DICOM file loaded successfully
2025-07-14 17:28:22 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:28:22 - root - INFO - Processing RGB format DICOM
2025-07-14 17:28:22 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:28:22 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:28:22 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:28:22 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:28:22 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:28:22 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:28:22 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:28:22 - root - DEBUG - Raw coordinates - minx0: [0], miny0: [66], maxx1: [1136], maxy1: [852]
2025-07-14 17:28:22 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:28:22 - root - INFO - Single region detected, using direct coordinates
2025-07-14 17:28:22 - root - DEBUG - Single region bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:28:22 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:28:22 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:28:22 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:28:22 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:28:22 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:28:22 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:28:22 - root - INFO - Initializing OCRHandler
2025-07-14 17:28:22 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:28:22 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:28:22 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:28:22 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:28:22 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:28:22 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:28:22 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:28:23 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:28:23 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:28:23 - root - INFO - Initializing TableDetector
2025-07-14 17:28:23 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:28:23 - root - DEBUG - Default detection parameters:
2025-07-14 17:28:23 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:28:23 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:28:23 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:28:23 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:28:23 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:28:23 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:28:23 - root - INFO - TableDetector initialization completed
2025-07-14 17:28:23 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:28:23 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:28:23 - root - DEBUG - Text analysis configuration:
2025-07-14 17:28:23 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:28:23 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:28:23 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:28:23 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:28:23 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:28:23 - root - INFO - Initializing ContentExtractor
2025-07-14 17:28:23 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:28:23 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:28:23 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:28:23 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:28:23 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:28:23 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:28:23 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:28:23 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:28:23 - root - DEBUG - Edge detection completed
2025-07-14 17:28:23 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:28:23 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 203485
2025-07-14 17:28:23 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:28:23 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:28:23 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:28:23 - root - DEBUG - Line enhancement completed
2025-07-14 17:28:23 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:28:23 - root - DEBUG - Line thickening completed
2025-07-14 17:28:23 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:28:23 - root - DEBUG - Line combination completed
2025-07-14 17:28:23 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:28:23 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:28:23 - root - INFO - Found 500 contours
2025-07-14 17:28:23 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:28:23 - root - DEBUG - Contours drawn successfully
2025-07-14 17:28:23 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:28:23 - root - INFO - Rectangular region detection completed
2025-07-14 17:28:23 - root - INFO - Total candidate regions found: 63
2025-07-14 17:28:23 - root - DEBUG - Found 63 candidate regions
2025-07-14 17:28:23 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:28:23 - root - DEBUG - Line 1: '1 D 0.57cm' (conf: 0.990)
2025-07-14 17:28:23 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:23 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:23 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:23 - root - DEBUG - Combined text: '1 d 0.57cm'
2025-07-14 17:28:23 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:23 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:23 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:23 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:23 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:23 - root - DEBUG - Pattern 1 matches: 1
2025-07-14 17:28:23 - root - DEBUG - Pattern 1 found matches: ['0.57cm']
2025-07-14 17:28:23 - root - DEBUG - Pattern 2 matches: 1
2025-07-14 17:28:23 - root - DEBUG - Pattern 2 found matches: ['d']
2025-07-14 17:28:23 - root - DEBUG - Base score from pattern matching: 2
2025-07-14 17:28:23 - root - DEBUG - 'cm' occurrences: 1, bonus added: 2
2025-07-14 17:28:23 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:23 - root - INFO - Final measurement score: 4
2025-07-14 17:28:24 - root - DEBUG - Line 1: 'E2' (conf: 0.998)
2025-07-14 17:28:24 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:24 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:24 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:24 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:28:24 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:24 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:24 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:24 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:24 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:24 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:24 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:24 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:24 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:24 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:24 - root - INFO - Final measurement score: 0
2025-07-14 17:28:24 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:28:24 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:28:24 - root - DEBUG - Top 10 score indices: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
2025-07-14 17:28:24 - root - DEBUG - Rank 1: Index 0, Score 4.000000
2025-07-14 17:28:24 - root - DEBUG - Rank 2: Index 1, Score 0.000000
2025-07-14 17:28:24 - root - DEBUG - Rank 3: Index 2, Score 0.000000
2025-07-14 17:28:24 - root - DEBUG - Rank 4: Index 3, Score 0.000000
2025-07-14 17:28:24 - root - DEBUG - Rank 5: Index 4, Score 0.000000
2025-07-14 17:28:24 - root - DEBUG - Rank 6: Index 5, Score 0.000000
2025-07-14 17:28:24 - root - DEBUG - Rank 7: Index 6, Score 0.000000
2025-07-14 17:28:24 - root - DEBUG - Rank 8: Index 7, Score 0.000000
2025-07-14 17:28:24 - root - DEBUG - Rank 9: Index 8, Score 0.000000
2025-07-14 17:28:24 - root - DEBUG - Rank 10: Index 9, Score 0.000000
2025-07-14 17:28:24 - root - INFO - Best candidate meets threshold (>= 4). Score: 4.000000
2025-07-14 17:28:24 - root - DEBUG - All top 10 scores:
2025-07-14 17:28:24 - root - DEBUG - Score index 0: 4.000000
2025-07-14 17:28:24 - root - DEBUG - Score index 1: 0.000000
2025-07-14 17:28:24 - root - DEBUG - Score index 2: 0.000000
2025-07-14 17:28:24 - root - DEBUG - Score index 3: 0.000000
2025-07-14 17:28:24 - root - DEBUG - Score index 4: 0.000000
2025-07-14 17:28:24 - root - DEBUG - Score index 5: 0.000000
2025-07-14 17:28:24 - root - DEBUG - Score index 6: 0.000000
2025-07-14 17:28:24 - root - DEBUG - Score index 7: 0.000000
2025-07-14 17:28:24 - root - DEBUG - Score index 8: 0.000000
2025-07-14 17:28:24 - root - DEBUG - Score index 9: 0.000000
2025-07-14 17:28:24 - root - INFO - Measurement table detection completed successfully
2025-07-14 17:28:24 - root - DEBUG - Table detection completed. Candidates found: 63
2025-07-14 17:28:24 - root - INFO - Identifying organ name from the image
2025-07-14 17:28:24 - root - INFO - Starting organ name identification
2025-07-14 17:28:24 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:28:24 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:28:24 - root - INFO - Starting organ label identification
2025-07-14 17:28:24 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:28:24 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:28:26 - root - DEBUG - Line 1: '64/21Hz' (conf: 1.000)
2025-07-14 17:28:26 - root - DEBUG - Line 2: 'Voluson' (conf: 1.000)
2025-07-14 17:28:26 - root - DEBUG - Line 3: 'Abdomen' (conf: 0.933)
2025-07-14 17:28:26 - root - DEBUG - Line 4: '58' (conf: 0.768)
2025-07-14 17:28:26 - root - DEBUG - Line 5: 'HM PI 7.70 - 2.10' (conf: 0.927)
2025-07-14 17:28:26 - root - DEBUG - Line 6: 'AO 100%' (conf: 0.938)
2025-07-14 17:28:26 - root - DEBUG - Line 7: 'Gn -20' (conf: 0.938)
2025-07-14 17:28:26 - root - DEBUG - Line 8: 'C6 / M4' (conf: 0.878)
2025-07-14 17:28:26 - root - DEBUG - Line 9: 'FF1/E2' (conf: 0.997)
2025-07-14 17:28:26 - root - DEBUG - Line 10: 'SRI II 2 / CRI 2' (conf: 0.964)
2025-07-14 17:28:26 - root - DEBUG - Line 11: '1' (conf: 0.750)
2025-07-14 17:28:26 - root - DEBUG - Line 12: '--' (conf: 0.573)
2025-07-14 17:28:26 - root - DEBUG - Line 13: '1 D 0.57cm' (conf: 0.994)
2025-07-14 17:28:26 - root - DEBUG - OCR completed. Processing 13 text lines for organ keywords
2025-07-14 17:28:26 - root - DEBUG - Line 0 text: '64/21Hz'
2025-07-14 17:28:26 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-14 17:28:26 - root - DEBUG - Line 2 text: 'Abdomen'
2025-07-14 17:28:26 - root - DEBUG - Line 3 text: '58'
2025-07-14 17:28:26 - root - DEBUG - Line 4 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:28:26 - root - DEBUG - Line 5 text: 'AO 100%'
2025-07-14 17:28:26 - root - DEBUG - Line 6 text: 'Gn -20'
2025-07-14 17:28:26 - root - DEBUG - Line 7 text: 'C6 / M4'
2025-07-14 17:28:26 - root - DEBUG - Line 8 text: 'FF1/E2'
2025-07-14 17:28:26 - root - DEBUG - Line 9 text: 'SRI II 2 / CRI 2'
2025-07-14 17:28:26 - root - DEBUG - Line 10 text: '1'
2025-07-14 17:28:26 - root - DEBUG - Line 11 text: '--'
2025-07-14 17:28:26 - root - DEBUG - Line 12 text: '1 D 0.57cm'
2025-07-14 17:28:26 - root - DEBUG - Combined text for keyword search: '64/21hz voluson abdomen 58 hm pi 7.70 - 2.10 ao 100% gn -20 c6 / m4 ff1/e2 sri ii 2 / cri 2 1 -- 1 d 0.57cm'
2025-07-14 17:28:26 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:28:26 - root - INFO - Organ identification completed. Found 0 organ keywords
2025-07-14 17:28:26 - root - INFO - Identified organs: []
2025-07-14 17:28:26 - root - WARNING - No organ name identified from the image
2025-07-14 17:28:26 - root - DEBUG - Organ identified: []
2025-07-14 17:28:26 - root - INFO - Table(s) detected successfully. Processing best candidate...
2025-07-14 17:28:26 - root - DEBUG - Number of scored candidates: 10
2025-07-14 17:28:26 - root - DEBUG - Best score index: 0
2025-07-14 17:28:26 - root - INFO - Extracting structured data from detected table
2025-07-14 17:28:26 - root - INFO - Starting table content extraction
2025-07-14 17:28:26 - root - DEBUG - Bounding box coordinates: (3110, 2228, 294, 79)
2025-07-14 17:28:26 - root - DEBUG - Image shape: (2358, 3404, 3)
2025-07-14 17:28:26 - root - DEBUG - Delegating to content extractor for table processing
2025-07-14 17:28:26 - root - INFO - Starting table content extraction
2025-07-14 17:28:26 - root - DEBUG - Bounding box coordinates: (3110, 2228, 294, 79)
2025-07-14 17:28:26 - root - INFO - Performing OCR on extracted table region
2025-07-14 17:28:26 - root - DEBUG - Line 1: '1 D 0.57cm' (conf: 0.990)
2025-07-14 17:28:26 - root - INFO - OCR completed successfully. Processing text elements...
2025-07-14 17:28:26 - root - INFO - Extracted 1 text elements from table region
2025-07-14 17:28:26 - root - INFO - Structuring extracted text data
2025-07-14 17:28:26 - root - INFO - Starting table data structuring
2025-07-14 17:28:26 - root - DEBUG - Element 1: text='1 D 0.57cm', x=154.50, y=39.00, conf=0.990
2025-07-14 17:28:26 - root - DEBUG - Processing element 1/1: '1 D 0.57cm' at (154.50, 39.00)
2025-07-14 17:28:26 - root - INFO - Line grouping completed - Total lines: 1
2025-07-14 17:28:26 - root - DEBUG - Processing line 1/1 with 1 elements
2025-07-14 17:28:26 - root - DEBUG - Processing word 1/1: '1 D 0.57cm'
2025-07-14 17:28:26 - root - DEBUG - Starting measurement text splitting
2025-07-14 17:28:26 - root - DEBUG - Input text: '1 D 0.57cm'
2025-07-14 17:28:26 - root - DEBUG - Trying pattern 1: (\d+)\s+(\d*[a-zA-Z]+\d*)\s*[.\s]*\s*(\d+(?:\.\d+)?\s*cm)
2025-07-14 17:28:26 - root - DEBUG - Pattern 1 matched successfully
2025-07-14 17:28:26 - root - DEBUG - Pattern 1 groups: ('1', 'D', '0.57cm')
2025-07-14 17:28:26 - root - DEBUG - Pattern 1 result: ('1', 'D', '0.57cm')
2025-07-14 17:28:26 - root - INFO - Text split successful using pattern 1: ('1', 'D', '0.57cm')
2025-07-14 17:28:26 - root - DEBUG - Split measurement result: ('1', 'D', '0.57cm')
2025-07-14 17:28:26 - root - DEBUG - Final structured data:
2025-07-14 17:28:26 - root - DEBUG - Item 1 (text): '{'Value1': ['1', 'D', '0.57cm']}'
2025-07-14 17:28:26 - root - INFO - Table content extraction completed successfully
2025-07-14 17:28:26 - root - DEBUG - Structured data keys: [{'organLabel': []}, {'Value1': ['1', 'D', '0.57cm']}]
2025-07-14 17:28:26 - root - DEBUG - Organ identified: []
2025-07-14 17:28:26 - root - INFO - Table extraction successful for file: API\extracted\TestingDicomZip\I0000100_20250417_103454
2025-07-14 17:28:26 - root - INFO - Organ identified: []
2025-07-14 17:28:26 - root - DEBUG - Structured data extracted: [{'organLabel': []}, {'Value1': ['1', 'D', '0.57cm']}]
2025-07-14 17:28:26 - root - INFO - Processing DICOM file 10/11: API\extracted\TestingDicomZip\I0000110_20250417_103454
2025-07-14 17:28:26 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:28:26 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000110_20250417_103454
2025-07-14 17:28:26 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:28:26 - root - INFO - DICOM file loaded successfully
2025-07-14 17:28:26 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:28:26 - root - INFO - Processing RGB format DICOM
2025-07-14 17:28:26 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:28:26 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:28:26 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:28:26 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:28:26 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:28:26 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:28:26 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:28:26 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-14 17:28:26 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:28:26 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-14 17:28:26 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:28:26 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:28:26 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:28:26 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:28:26 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:28:26 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:28:26 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:28:26 - root - INFO - Initializing OCRHandler
2025-07-14 17:28:26 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:28:26 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:28:26 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:28:26 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:28:26 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:28:26 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:28:26 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:28:27 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:28:27 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:28:27 - root - INFO - Initializing TableDetector
2025-07-14 17:28:27 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:28:27 - root - DEBUG - Default detection parameters:
2025-07-14 17:28:27 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:28:27 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:28:27 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:28:27 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:28:27 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:28:27 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:28:27 - root - INFO - TableDetector initialization completed
2025-07-14 17:28:27 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:28:27 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:28:27 - root - DEBUG - Text analysis configuration:
2025-07-14 17:28:27 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:28:27 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:28:27 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:28:27 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:28:27 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:28:27 - root - INFO - Initializing ContentExtractor
2025-07-14 17:28:27 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:28:27 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:28:27 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:28:27 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:28:27 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:28:27 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:28:27 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:28:27 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:28:27 - root - DEBUG - Edge detection completed
2025-07-14 17:28:27 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:28:27 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 589058
2025-07-14 17:28:27 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:28:27 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:28:27 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:28:27 - root - DEBUG - Line enhancement completed
2025-07-14 17:28:27 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:28:27 - root - DEBUG - Line thickening completed
2025-07-14 17:28:27 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:28:27 - root - DEBUG - Line combination completed
2025-07-14 17:28:27 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:28:27 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:28:27 - root - INFO - Found 1055 contours
2025-07-14 17:28:27 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:28:27 - root - DEBUG - Contours drawn successfully
2025-07-14 17:28:27 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:28:27 - root - INFO - Rectangular region detection completed
2025-07-14 17:28:27 - root - INFO - Total candidate regions found: 386
2025-07-14 17:28:27 - root - DEBUG - Found 386 candidate regions
2025-07-14 17:28:27 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:28:29 - root - DEBUG - Line 1: 'LT OVARY' (conf: 0.964)
2025-07-14 17:28:29 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:29 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:29 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:29 - root - DEBUG - Combined text: 'lt ovary'
2025-07-14 17:28:29 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:29 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:29 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:29 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:29 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:29 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:29 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:29 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:29 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:29 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:29 - root - INFO - Final measurement score: 0
2025-07-14 17:28:29 - root - DEBUG - Line 1: 'E2' (conf: 0.997)
2025-07-14 17:28:29 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:29 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:29 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:29 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:28:29 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:29 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:29 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:29 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:29 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:29 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:29 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:29 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:29 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:29 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:29 - root - INFO - Final measurement score: 0
2025-07-14 17:28:29 - root - DEBUG - Line 1: 'Voluson' (conf: 0.999)
2025-07-14 17:28:29 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:29 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:29 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:29 - root - DEBUG - Combined text: 'voluson'
2025-07-14 17:28:29 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:29 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:29 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:29 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:29 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:29 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:29 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:29 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:29 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:29 - root - DEBUG - 'vol' occurrences: 1, bonus added: 2
2025-07-14 17:28:29 - root - INFO - Final measurement score: 2
2025-07-14 17:28:30 - root - DEBUG - Line 1: 'HMI' (conf: 0.846)
2025-07-14 17:28:30 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:30 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:30 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:30 - root - DEBUG - Combined text: 'hmi'
2025-07-14 17:28:30 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:30 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:30 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:30 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:30 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:30 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:30 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:30 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:30 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:30 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:30 - root - INFO - Final measurement score: 0
2025-07-14 17:28:30 - root - DEBUG - Line 1: 'Voluson' (conf: 0.998)
2025-07-14 17:28:30 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:30 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:30 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:30 - root - DEBUG - Combined text: 'voluson'
2025-07-14 17:28:30 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:30 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:30 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:30 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:30 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:30 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:30 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:30 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:30 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:30 - root - DEBUG - 'vol' occurrences: 1, bonus added: 2
2025-07-14 17:28:30 - root - INFO - Final measurement score: 2
2025-07-14 17:28:30 - root - DEBUG - Line 1: '64' (conf: 1.000)
2025-07-14 17:28:30 - root - DEBUG - Line 2: 'A' (conf: 0.999)
2025-07-14 17:28:30 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:30 - root - DEBUG - Number of text lines detected: 2
2025-07-14 17:28:30 - root - DEBUG - Text extraction completed - Lines processed: 2
2025-07-14 17:28:30 - root - DEBUG - Combined text: '64 a'
2025-07-14 17:28:30 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:30 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:30 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:30 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:30 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:30 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:30 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:30 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:30 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:30 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:30 - root - INFO - Final measurement score: 0
2025-07-14 17:28:30 - root - DEBUG - Line 1: '2' (conf: 0.817)
2025-07-14 17:28:30 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:30 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:30 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:30 - root - DEBUG - Combined text: '2'
2025-07-14 17:28:30 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:30 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:30 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:30 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:30 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:30 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:30 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:30 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:30 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:30 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:30 - root - INFO - Final measurement score: 0
2025-07-14 17:28:30 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:28:30 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:28:30 - root - DEBUG - Top 10 score indices: [348, 360, 0, 1, 2, 3, 4, 5, 6, 7]
2025-07-14 17:28:30 - root - DEBUG - Rank 1: Index 348, Score 2.000000
2025-07-14 17:28:30 - root - DEBUG - Rank 2: Index 360, Score 2.000000
2025-07-14 17:28:30 - root - DEBUG - Rank 3: Index 0, Score 0.000000
2025-07-14 17:28:30 - root - DEBUG - Rank 4: Index 1, Score 0.000000
2025-07-14 17:28:30 - root - DEBUG - Rank 5: Index 2, Score 0.000000
2025-07-14 17:28:30 - root - DEBUG - Rank 6: Index 3, Score 0.000000
2025-07-14 17:28:30 - root - DEBUG - Rank 7: Index 4, Score 0.000000
2025-07-14 17:28:30 - root - DEBUG - Rank 8: Index 5, Score 0.000000
2025-07-14 17:28:30 - root - DEBUG - Rank 9: Index 6, Score 0.000000
2025-07-14 17:28:30 - root - DEBUG - Rank 10: Index 7, Score 0.000000
2025-07-14 17:28:30 - root - WARNING - No candidates meet the minimum threshold of 4. Best score: 2.000000
2025-07-14 17:28:30 - root - INFO - Measurement table detection completed - no valid tables found
2025-07-14 17:28:30 - root - DEBUG - Table detection completed. Candidates found: 386
2025-07-14 17:28:30 - root - INFO - Identifying organ name from the image
2025-07-14 17:28:30 - root - INFO - Starting organ name identification
2025-07-14 17:28:30 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:28:30 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:28:30 - root - INFO - Starting organ label identification
2025-07-14 17:28:30 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:28:30 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:28:32 - root - DEBUG - Line 1: '64/ 21Hz' (conf: 0.945)
2025-07-14 17:28:32 - root - DEBUG - Line 2: 'Voluson' (conf: 0.918)
2025-07-14 17:28:32 - root - DEBUG - Line 3: 'Voluson' (conf: 1.000)
2025-07-14 17:28:32 - root - DEBUG - Line 4: 'Abdomen' (conf: 0.999)
2025-07-14 17:28:32 - root - DEBUG - Line 5: 'S8' (conf: 0.787)
2025-07-14 17:28:32 - root - DEBUG - Line 6: 'S8' (conf: 0.832)
2025-07-14 17:28:32 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.906)
2025-07-14 17:28:32 - root - DEBUG - Line 8: 'AO100%' (conf: 0.999)
2025-07-14 17:28:32 - root - DEBUG - Line 9: 'Gn-18' (conf: 0.970)
2025-07-14 17:28:32 - root - DEBUG - Line 10: 'C6/M4' (conf: 0.982)
2025-07-14 17:28:32 - root - DEBUG - Line 11: 'FF1/E2' (conf: 0.996)
2025-07-14 17:28:32 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.925)
2025-07-14 17:28:32 - root - DEBUG - Line 13: 'LT OVARY' (conf: 0.999)
2025-07-14 17:28:32 - root - DEBUG - OCR completed. Processing 13 text lines for organ keywords
2025-07-14 17:28:32 - root - DEBUG - Line 0 text: '64/ 21Hz'
2025-07-14 17:28:32 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-14 17:28:32 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-14 17:28:32 - root - DEBUG - Line 3 text: 'Abdomen'
2025-07-14 17:28:32 - root - DEBUG - Line 4 text: 'S8'
2025-07-14 17:28:32 - root - DEBUG - Line 5 text: 'S8'
2025-07-14 17:28:32 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:28:32 - root - DEBUG - Line 7 text: 'AO100%'
2025-07-14 17:28:32 - root - DEBUG - Line 8 text: 'Gn-18'
2025-07-14 17:28:32 - root - DEBUG - Line 9 text: 'C6/M4'
2025-07-14 17:28:32 - root - DEBUG - Line 10 text: 'FF1/E2'
2025-07-14 17:28:32 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-14 17:28:32 - root - DEBUG - Line 12 text: 'LT OVARY'
2025-07-14 17:28:32 - root - DEBUG - Combined text for keyword search: '64/ 21hz voluson voluson abdomen s8 s8 hm pi 7.70 - 2.10 ao100% gn-18 c6/m4 ff1/e2 sri ii 2 / cri 2 lt ovary'
2025-07-14 17:28:32 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:28:32 - root - DEBUG - Found organ keyword: 'lt ovary'
2025-07-14 17:28:32 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-14 17:28:32 - root - INFO - Identified organs: ['lt ovary']
2025-07-14 17:28:32 - root - INFO - Organ identification completed successfully: ['lt ovary']
2025-07-14 17:28:32 - root - DEBUG - Organ identified: ['lt ovary']
2025-07-14 17:28:32 - root - WARNING - No measurement tables detected in the ultrasound image
2025-07-14 17:28:32 - root - WARNING - No structured data extracted from file: API\extracted\TestingDicomZip\I0000110_20250417_103454
2025-07-14 17:28:32 - root - INFO - Processing DICOM file 11/11: API\extracted\TestingDicomZip\I0000120_20250417_103454
2025-07-14 17:28:32 - root - DEBUG - Converting DICOM to PNG format
2025-07-14 17:28:32 - root - INFO - Starting DICOM to PNG conversion: API\extracted\TestingDicomZip\I0000120_20250417_103454
2025-07-14 17:28:32 - root - DEBUG - Reading DICOM file with pydicom
2025-07-14 17:28:32 - root - INFO - DICOM file loaded successfully
2025-07-14 17:28:32 - root - DEBUG - Original photometric interpretation: RGB
2025-07-14 17:28:32 - root - INFO - Processing RGB format DICOM
2025-07-14 17:28:32 - root - DEBUG - Converting RGB to BGR for OpenCV compatibility
2025-07-14 17:28:32 - root - DEBUG - RGB to BGR conversion completed. New shape: (852, 1136, 3)
2025-07-14 17:28:32 - root - INFO - DICOM to PNG conversion completed successfully
2025-07-14 17:28:32 - root - DEBUG - DICOM conversion successful. Pixel array shape: (852, 1136, 3)
2025-07-14 17:28:32 - root - DEBUG - Cropping ultrasound image area
2025-07-14 17:28:32 - root - DEBUG - Initializing USRegionLocation detector
2025-07-14 17:28:32 - root - INFO - Getting ultrasound region coordinates
2025-07-14 17:28:32 - root - DEBUG - Raw coordinates - minx0: [0, 569], miny0: [66, 66], maxx1: [567, 1136], maxy1: [852, 852]
2025-07-14 17:28:32 - root - DEBUG - Study type identified: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:28:32 - root - INFO - Multiple regions detected (2 regions), calculating combined bounds
2025-07-14 17:28:32 - root - DEBUG - Combined bounds - minX: 0, minY: 66, maxX: 1136, maxY: 852
2025-07-14 17:28:32 - root - DEBUG - Cropping region: [66:852, 0:1136]
2025-07-14 17:28:32 - root - INFO - Ultrasound image area extraction completed successfully
2025-07-14 17:28:32 - root - DEBUG - Image cropping completed. Study type: (0008, 1030) Study Description                   LO: 'PELVIS/US'
2025-07-14 17:28:32 - root - INFO - Analyzing cropped image for measurement tables
2025-07-14 17:28:32 - root - INFO - Starting table detection in ultrasound image
2025-07-14 17:28:32 - root - INFO - Initializing UltrasoundTableDetector
2025-07-14 17:28:32 - root - INFO - Initializing OCRHandler
2025-07-14 17:28:32 - root - DEBUG - Setting up PaddleOCR with optimized parameters
2025-07-14 17:28:32 - root - DEBUG - Configuring PaddleOCR parameters:
2025-07-14 17:28:32 - root - DEBUG - - use_angle_cls: True (enables angle classification)
2025-07-14 17:28:32 - root - DEBUG - - lang: 'en' (English language)
2025-07-14 17:28:32 - root - DEBUG - - det_db_thresh: 0.3 (lower threshold for text detection)
2025-07-14 17:28:32 - root - DEBUG - - det_db_box_thresh: 0.5 (lower box threshold)
2025-07-14 17:28:32 - root - DEBUG - - det_db_unclip_ratio: 2.0 (text region expansion ratio)
2025-07-14 17:28:33 - root - INFO - OCRHandler initialized successfully
2025-07-14 17:28:33 - root - DEBUG - PaddleOCR instance created with optimized parameters
2025-07-14 17:28:33 - root - INFO - Initializing TableDetector
2025-07-14 17:28:33 - root - DEBUG - TableDetector instance created successfully
2025-07-14 17:28:33 - root - DEBUG - Default detection parameters:
2025-07-14 17:28:33 - root - DEBUG - - Image upscale factor: 3x
2025-07-14 17:28:33 - root - DEBUG - - Edge threshold: 50
2025-07-14 17:28:33 - root - DEBUG - - Horizontal kernel size: (30, 1)
2025-07-14 17:28:33 - root - DEBUG - - Vertical kernel size: (1, 10)
2025-07-14 17:28:33 - root - DEBUG - - Minimum area threshold: 2 pixels
2025-07-14 17:28:33 - root - DEBUG - - Minimum X position: 100 pixels
2025-07-14 17:28:33 - root - INFO - TableDetector initialization completed
2025-07-14 17:28:33 - root - INFO - Initializing TextAnalyzer
2025-07-14 17:28:33 - root - DEBUG - TextAnalyzer instance created successfully
2025-07-14 17:28:33 - root - DEBUG - Text analysis configuration:
2025-07-14 17:28:33 - root - DEBUG - - Same line threshold: 15 pixels
2025-07-14 17:28:33 - root - DEBUG - - Measurement pattern types: 2 (unit patterns, key patterns)
2025-07-14 17:28:33 - root - DEBUG - - Bonus scoring: cm (2x), vol (2x)
2025-07-14 17:28:33 - root - DEBUG - - Split measurement patterns: 2 (detailed, simple)
2025-07-14 17:28:33 - root - INFO - TextAnalyzer initialization completed
2025-07-14 17:28:33 - root - INFO - Initializing ContentExtractor
2025-07-14 17:28:33 - root - INFO - ContentExtractor initialized successfully
2025-07-14 17:28:33 - root - INFO - UltrasoundTableDetector initialization completed successfully
2025-07-14 17:28:33 - root - INFO - Detecting measurement tables in the image
2025-07-14 17:28:33 - root - DEBUG - Upscaling to: 3408x2358 (factor: 3x)
2025-07-14 17:28:33 - root - DEBUG - Cropping rightmost 4 pixels to remove artifacts
2025-07-14 17:28:33 - root - DEBUG - Converting upscaled image to grayscale
2025-07-14 17:28:33 - root - DEBUG - Grayscale conversion completed
2025-07-14 17:28:33 - root - INFO - Applying edge detection to grayscale image
2025-07-14 17:28:33 - root - DEBUG - Edge detection completed
2025-07-14 17:28:33 - root - DEBUG - Applying threshold to create binary image
2025-07-14 17:28:33 - root - DEBUG - Threshold applied - Value: 50, Non-zero pixels: 589058
2025-07-14 17:28:33 - root - DEBUG - Creating morphological kernels for line enhancement
2025-07-14 17:28:33 - root - DEBUG - Kernels created - Horizontal: (30,1), Vertical: (1,10)
2025-07-14 17:28:33 - root - INFO - Enhancing horizontal and vertical lines
2025-07-14 17:28:33 - root - DEBUG - Line enhancement completed
2025-07-14 17:28:33 - root - DEBUG - Applying dilation to make lines thicker
2025-07-14 17:28:33 - root - DEBUG - Line thickening completed
2025-07-14 17:28:33 - root - DEBUG - Combining horizontal and vertical lines
2025-07-14 17:28:33 - root - DEBUG - Line combination completed
2025-07-14 17:28:33 - root - DEBUG - Created copy for contour visualization
2025-07-14 17:28:33 - root - INFO - Finding contours in enhanced lines
2025-07-14 17:28:33 - root - INFO - Found 1055 contours
2025-07-14 17:28:33 - root - DEBUG - Drawing contours for visualization
2025-07-14 17:28:33 - root - DEBUG - Contours drawn successfully
2025-07-14 17:28:33 - root - INFO - Processing contours to find rectangular regions
2025-07-14 17:28:33 - root - INFO - Rectangular region detection completed
2025-07-14 17:28:33 - root - INFO - Total candidate regions found: 386
2025-07-14 17:28:33 - root - DEBUG - Found 386 candidate regions
2025-07-14 17:28:33 - root - INFO - Processing candidate regions for measurement content
2025-07-14 17:28:35 - root - DEBUG - Line 1: 'LT OVARY' (conf: 0.964)
2025-07-14 17:28:35 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:35 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:35 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:35 - root - DEBUG - Combined text: 'lt ovary'
2025-07-14 17:28:35 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:35 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:35 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:35 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:35 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:35 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:35 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:35 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:35 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:35 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:35 - root - INFO - Final measurement score: 0
2025-07-14 17:28:35 - root - DEBUG - Line 1: 'E2' (conf: 0.997)
2025-07-14 17:28:35 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:35 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:35 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:35 - root - DEBUG - Combined text: 'e2'
2025-07-14 17:28:35 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:35 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:35 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:35 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:35 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:35 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:35 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:35 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:35 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:35 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:35 - root - INFO - Final measurement score: 0
2025-07-14 17:28:36 - root - DEBUG - Line 1: 'Voluson' (conf: 0.999)
2025-07-14 17:28:36 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:36 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:36 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:36 - root - DEBUG - Combined text: 'voluson'
2025-07-14 17:28:36 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:36 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:36 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:36 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:36 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:36 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:36 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:36 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:36 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:36 - root - DEBUG - 'vol' occurrences: 1, bonus added: 2
2025-07-14 17:28:36 - root - INFO - Final measurement score: 2
2025-07-14 17:28:36 - root - DEBUG - Line 1: 'HMI' (conf: 0.846)
2025-07-14 17:28:36 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:36 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:36 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:36 - root - DEBUG - Combined text: 'hmi'
2025-07-14 17:28:36 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:36 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:36 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:36 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:36 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:36 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:36 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:36 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:36 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:36 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:36 - root - INFO - Final measurement score: 0
2025-07-14 17:28:36 - root - DEBUG - Line 1: 'Voluson' (conf: 0.998)
2025-07-14 17:28:36 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:36 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:36 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:36 - root - DEBUG - Combined text: 'voluson'
2025-07-14 17:28:36 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:36 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:36 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:36 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:36 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:36 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:36 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:36 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:36 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:36 - root - DEBUG - 'vol' occurrences: 1, bonus added: 2
2025-07-14 17:28:36 - root - INFO - Final measurement score: 2
2025-07-14 17:28:36 - root - DEBUG - Line 1: '64' (conf: 1.000)
2025-07-14 17:28:36 - root - DEBUG - Line 2: 'A' (conf: 0.999)
2025-07-14 17:28:36 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:36 - root - DEBUG - Number of text lines detected: 2
2025-07-14 17:28:36 - root - DEBUG - Text extraction completed - Lines processed: 2
2025-07-14 17:28:36 - root - DEBUG - Combined text: '64 a'
2025-07-14 17:28:36 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:36 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:36 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:36 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:36 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:36 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:36 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:36 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:36 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:36 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:36 - root - INFO - Final measurement score: 0
2025-07-14 17:28:36 - root - DEBUG - Line 1: '2' (conf: 0.817)
2025-07-14 17:28:36 - root - INFO - OCR results found, processing text for measurement scoring
2025-07-14 17:28:36 - root - DEBUG - Number of text lines detected: 1
2025-07-14 17:28:36 - root - DEBUG - Text extraction completed - Lines processed: 1
2025-07-14 17:28:36 - root - DEBUG - Combined text: '2'
2025-07-14 17:28:36 - root - DEBUG - Defining measurement patterns for scoring
2025-07-14 17:28:36 - root - DEBUG - Measurement patterns defined:
2025-07-14 17:28:36 - root - DEBUG - Pattern 1: \d*\.?\d+\s*(?:mm|cm(?:\^?3)?|ml)
2025-07-14 17:28:36 - root - DEBUG - Pattern 2: \b(?:cm|vol|d1|d2|d|l|l1|l2)\b
2025-07-14 17:28:36 - root - INFO - Analyzing text for measurement patterns
2025-07-14 17:28:36 - root - DEBUG - Pattern 1 matches: 0
2025-07-14 17:28:36 - root - DEBUG - Pattern 2 matches: 0
2025-07-14 17:28:36 - root - DEBUG - Base score from pattern matching: 0
2025-07-14 17:28:36 - root - DEBUG - 'cm' occurrences: 0, bonus added: 0
2025-07-14 17:28:36 - root - DEBUG - 'vol' occurrences: 0, bonus added: 0
2025-07-14 17:28:36 - root - INFO - Final measurement score: 0
2025-07-14 17:28:36 - root - DEBUG - Storing measurement scores and ROI data in candidate structure
2025-07-14 17:28:36 - root - INFO - Identifying top 10 candidates based on measurement scores
2025-07-14 17:28:36 - root - DEBUG - Top 10 score indices: [348, 360, 0, 1, 2, 3, 4, 5, 6, 7]
2025-07-14 17:28:36 - root - DEBUG - Rank 1: Index 348, Score 2.000000
2025-07-14 17:28:36 - root - DEBUG - Rank 2: Index 360, Score 2.000000
2025-07-14 17:28:36 - root - DEBUG - Rank 3: Index 0, Score 0.000000
2025-07-14 17:28:36 - root - DEBUG - Rank 4: Index 1, Score 0.000000
2025-07-14 17:28:36 - root - DEBUG - Rank 5: Index 2, Score 0.000000
2025-07-14 17:28:36 - root - DEBUG - Rank 6: Index 3, Score 0.000000
2025-07-14 17:28:36 - root - DEBUG - Rank 7: Index 4, Score 0.000000
2025-07-14 17:28:36 - root - DEBUG - Rank 8: Index 5, Score 0.000000
2025-07-14 17:28:36 - root - DEBUG - Rank 9: Index 6, Score 0.000000
2025-07-14 17:28:36 - root - DEBUG - Rank 10: Index 7, Score 0.000000
2025-07-14 17:28:36 - root - WARNING - No candidates meet the minimum threshold of 4. Best score: 2.000000
2025-07-14 17:28:36 - root - INFO - Measurement table detection completed - no valid tables found
2025-07-14 17:28:36 - root - DEBUG - Table detection completed. Candidates found: 386
2025-07-14 17:28:36 - root - INFO - Identifying organ name from the image
2025-07-14 17:28:36 - root - INFO - Starting organ name identification
2025-07-14 17:28:36 - root - DEBUG - Image shape: (786, 1136, 3)
2025-07-14 17:28:36 - root - DEBUG - Delegating to content extractor for organ identification
2025-07-14 17:28:36 - root - INFO - Starting organ label identification
2025-07-14 17:28:36 - root - DEBUG - Input image shape: (786, 1136, 3)
2025-07-14 17:28:36 - root - DEBUG - Performing OCR on full image for organ identification
2025-07-14 17:28:38 - root - DEBUG - Line 1: '64/ 21Hz' (conf: 0.945)
2025-07-14 17:28:38 - root - DEBUG - Line 2: 'Voluson' (conf: 0.918)
2025-07-14 17:28:38 - root - DEBUG - Line 3: 'Voluson' (conf: 1.000)
2025-07-14 17:28:38 - root - DEBUG - Line 4: 'Abdomen' (conf: 0.999)
2025-07-14 17:28:38 - root - DEBUG - Line 5: 'S8' (conf: 0.787)
2025-07-14 17:28:38 - root - DEBUG - Line 6: 'S8' (conf: 0.832)
2025-07-14 17:28:38 - root - DEBUG - Line 7: 'HM PI 7.70 - 2.10' (conf: 0.906)
2025-07-14 17:28:38 - root - DEBUG - Line 8: 'AO100%' (conf: 0.999)
2025-07-14 17:28:38 - root - DEBUG - Line 9: 'Gn-18' (conf: 0.970)
2025-07-14 17:28:38 - root - DEBUG - Line 10: 'C6/M4' (conf: 0.982)
2025-07-14 17:28:38 - root - DEBUG - Line 11: 'FF1/E2' (conf: 0.996)
2025-07-14 17:28:38 - root - DEBUG - Line 12: 'SRI II 2 / CRI 2' (conf: 0.925)
2025-07-14 17:28:38 - root - DEBUG - Line 13: 'LT OVARY' (conf: 0.999)
2025-07-14 17:28:38 - root - DEBUG - OCR completed. Processing 13 text lines for organ keywords
2025-07-14 17:28:38 - root - DEBUG - Line 0 text: '64/ 21Hz'
2025-07-14 17:28:38 - root - DEBUG - Line 1 text: 'Voluson'
2025-07-14 17:28:38 - root - DEBUG - Line 2 text: 'Voluson'
2025-07-14 17:28:38 - root - DEBUG - Line 3 text: 'Abdomen'
2025-07-14 17:28:38 - root - DEBUG - Line 4 text: 'S8'
2025-07-14 17:28:38 - root - DEBUG - Line 5 text: 'S8'
2025-07-14 17:28:38 - root - DEBUG - Line 6 text: 'HM PI 7.70 - 2.10'
2025-07-14 17:28:38 - root - DEBUG - Line 7 text: 'AO100%'
2025-07-14 17:28:38 - root - DEBUG - Line 8 text: 'Gn-18'
2025-07-14 17:28:38 - root - DEBUG - Line 9 text: 'C6/M4'
2025-07-14 17:28:38 - root - DEBUG - Line 10 text: 'FF1/E2'
2025-07-14 17:28:38 - root - DEBUG - Line 11 text: 'SRI II 2 / CRI 2'
2025-07-14 17:28:38 - root - DEBUG - Line 12 text: 'LT OVARY'
2025-07-14 17:28:38 - root - DEBUG - Combined text for keyword search: '64/ 21hz voluson voluson abdomen s8 s8 hm pi 7.70 - 2.10 ao100% gn-18 c6/m4 ff1/e2 sri ii 2 / cri 2 lt ovary'
2025-07-14 17:28:38 - root - DEBUG - Searching for organ keywords: ['right kidney', 'left kidney', 'kidney', 'renal', 'nephron', 'ureter', 'bladder', 'rt ovary', 'lt ovary', 'uterus']
2025-07-14 17:28:38 - root - DEBUG - Found organ keyword: 'lt ovary'
2025-07-14 17:28:38 - root - INFO - Organ identification completed. Found 1 organ keywords
2025-07-14 17:28:38 - root - INFO - Identified organs: ['lt ovary']
2025-07-14 17:28:38 - root - INFO - Organ identification completed successfully: ['lt ovary']
2025-07-14 17:28:38 - root - DEBUG - Organ identified: ['lt ovary']
2025-07-14 17:28:38 - root - WARNING - No measurement tables detected in the ultrasound image
2025-07-14 17:28:38 - root - WARNING - No structured data extracted from file: API\extracted\TestingDicomZip\I0000120_20250417_103454
2025-07-14 17:28:38 - root - INFO - === DICOM Processing Session Completed === {'slice1': [None], 'slice2': [[{'organLabel': ['uterus']}, {'Value1': ['1', 'D', '8.60cm']}, {'Value2': ['2', 'D', '4.17cm']}, {'Value3': ['3 ', 'D', '3.63cm']}]], 'slice3': [[{'organLabel': []}, {'Value1': ['1', 'D', '0.65cm']}]], 'slice4': [None], 'slice5': [[{'organLabel': []}, {'Value1': ['1', 'D', '5.87cm']}, {'Value2': ['2 ', 'D', '4.37cm']}]], 'slice6': [None], 'slice7': [[{'organLabel': ['lt ovary']}, {'Value1': ['1', 'D1', '2.93cm']}, {'Value2': ['-']}, {'Value3': ['2', 'D2', '1.52cm']}, {'Value4': ['D3', '2.54cm']}, {'Value5': ['Vol', '5.923cm']}]], 'slice8': [[{'organLabel': []}, {'Value1': ['1', 'D', '1.65cm']}, {'Value2': ['2 ', 'D', '1.56cm']}]], 'slice9': [[{'organLabel': []}, {'Value1': ['1', 'D', '0.57cm']}]], 'slice10': [None], 'slice11': [None]} {'PatientName': 'DHIBANA.C.K', 'PatientID': 'CICPL13880', 'PatientAge': '19921017', 'PatientGender': 'F', 'HospitalName': 'CLARITY IMAGING CENTRE', 'PhysicianName': '^Dr.^Geetha^Raj.^M.B.B.S.,^DNB^(', 'scanType': 'PELVIS/US', 'scanDate': '20250417', 'scanTime': '103454', 'scanModality': 'US'}
